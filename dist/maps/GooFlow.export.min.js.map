{"version":3,"sources":["GooFlow.export.js"],"names":["global","factory","define","amd","module","exports","require","$","GooFlow","window","this","prototype","exportDiagram","Cmder","initBg","width","height","bgColor","canvas","document","createElement","ctx","getContext","fillStyle","fillRect","save","_toNum","str","parseInt","split","undefined","_analyseLabel","labelDom","tagName","offsetLeft","offsetTop","children","lineHeight","css","fontSize","font","text","color","offsetWidth","offsetHeight","lineNum","Math","ceil","_analyseIcon","iconDom","bgImg","property","replace","backgroundImage","substr","length","pX","parseFloat","pY","extend","opacity","content","getComputedStyle","getPropertyValue","_analyseArea","areaDom","bg","top","style","left","outerWidth","outerHeight","borderColor","icon","label","_analyseNode","nodeDom","borderWidth","borderRadius","boxShadow","find","hasClass","_fillIcon","bgLeft","bgTop","bgImage","indexOf","textAlign","textBaseline","fillText","tmpX","tmpY","drawImage","_fillLabel","lineWidth","lastSubStrIndex","hack","ActiveXObject","x","y","navigator","userAgent","i","measureText","substring","renderAreas","areas","iconBgImage","key","area","strokeStyle","rect","fill","stroke","renderNodes","nodes","node","sd","tmp","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","roundRect","_analyseLine","lineDom","fontFamily","path","childNodes","getAttribute","lineCap","strokeDasharray","lineDash","fontColor","textContent","d","points","xy","push","len","angle","atan2","renderLines","lines","line","setLineDash","p","beginPath","moveTo","lineTo","closePath","translate","rotate","restore","ctx2","CanvasRenderingContext2D","w","h","r","arcTo","fileName","areaEl","iconImage","bgUrl","k1","$areaDom","nodeEl","k2","$nodeDom","max","_suitSize","$scale","Goo","Image","setAttribute","src","tempFunc","lineEl","$lineDom","blob","msToBlob","msSaveBlob","e","base64","toDataURL","append","oPop","open","readyState","write","strSvg","$id","html","image","encodeURIComponent","onload","a","createElementNS","href","download","body","appendChild","click","removeChild","complete"],"mappings":"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","file":"../GooFlow.export.min.js","sourcesContent":["/*\r\n * 专门负责导出流程图文件并让用户下载的扩展包方法\r\n */\r\n;(function ( global, factory ) {\r\n\t'use strict';\r\n\tif ( typeof define !== 'undefined' && define.amd ) { // export as AMD...\r\n\t\tdefine( ['jquery','GooFlow'], factory );\r\n\t}\r\n\telse if ( typeof module !== 'undefined' && module.exports ) { // ...or as browserify\r\n\t\tfactory( require('jquery'), require('GooFlow') );\r\n\t}else\r\n\t\tfactory( global.$, global.GooFlow );\r\n\r\n}( typeof window !== 'undefined' ? window : this, function ( $,GooFlow ) {\r\n\tif(GooFlow.prototype.exportDiagram && typeof GooFlow.prototype.exportDiagram==='function'){\r\n\t\treturn;//防止多次载入\r\n\t}\r\n    var Cmder = {\r\n        //构建背景\r\n        initBg : function(width,height,bgColor){\r\n            var canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            var ctx = canvas.getContext('2d');\r\n            if(bgColor) ctx.fillStyle = bgColor;\r\n            ctx.fillRect(0,0,canvas.width,canvas.height);\r\n            ctx.save();\r\n            return canvas;\r\n        },\r\n        _toNum: function(str){\r\n            return str!==null&&str!==''? parseInt(str.split('px')[0],10):undefined;\r\n        },\r\n        _analyseLabel: function(labelDom){\r\n            var tagName = labelDom[0].tagName;\r\n            var offsetLeft = labelDom[0].offsetLeft;\r\n            var offsetTop = labelDom[0].offsetTop;\r\n            if(tagName==='TD'){\r\n                offsetLeft += labelDom.children(\"div\")[0].offsetLeft;\r\n                offsetTop += labelDom.children(\"div\")[0].offsetTop;\r\n            }\r\n\r\n            var lineHeight = this._toNum(labelDom.css(\"line-height\"));\r\n            var fontSize = labelDom.css('font-size');\r\n            return {\r\n                font: fontSize+' '+labelDom.css('font-family'),\r\n                fontSize: this._toNum(fontSize.split(\"px\")[0]),\r\n                text: labelDom.text(),//文字内容\r\n                color: labelDom.css('color'),//文字颜色\r\n                width: labelDom[0].offsetWidth,//文字容器宽度\r\n                height: labelDom[0].offsetHeight,//文字容器高度\r\n                lineHeight:lineHeight,\r\n                offsetLeft:offsetLeft,\r\n                offsetTop:offsetTop,\r\n                lineNum: Math.ceil(labelDom[0].offsetHeight/lineHeight)//文字要分几行？\r\n            };\r\n        },\r\n        _analyseIcon: function(iconDom){\r\n        \tvar bgImg = iconDom.css(\"background-image\");\r\n            var property={\r\n                // top: this._toNum(iconDom[0].style.top),//\r\n                // left: this._toNum(iconDom[0].style.left),//\r\n                offsetLeft:iconDom[0].offsetLeft,\r\n                offsetTop:iconDom[0].offsetTop,\r\n                width: iconDom.width(),\r\n                height: iconDom.height()\r\n            };\r\n\r\n            if(bgImg && bgImg!=='none'){//CSS SPITE背景图式\r\n                bgImg = bgImg.replace(/\"/g,\"\").split(\"url(\")[1];\r\n\t\t\t\tproperty.backgroundImage=bgImg.substr(0,bgImg.length-1);//图标背景图\r\n                bgImg = iconDom.css(\"background-position\").split(\" \");\r\n                property.pX = parseFloat(bgImg[0].split(\"px\")[0])*-1;//图标背景定位X\r\n                property.pY = parseFloat(bgImg[1].split(\"px\")[0])*-1;//图标背景定位Y\r\n\t\t\t}else{//矢量图标字体式\r\n\t\t\t\t$.extend(property,{\r\n\t\t\t\t\tfont: iconDom.css('font-size')+' '+iconDom.css('font-family').split(' ')[0],//图标矢量字体库\r\n\t\t\t\t\tlineHeight : this._toNum(iconDom.css('line-height')),//图标矢量字体行高\r\n\t\t\t\t\tcolor: iconDom.css('color'),//图标矢量字体颜色\r\n\t\t\t\t\topacity: parseFloat(iconDom.css(\"opacity\")),//图标矢量透明度\r\n\t\t\t\t\tcontent:window.getComputedStyle(iconDom[0],'::before').getPropertyValue('content')\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n            return property;\r\n        },\r\n        _analyseArea : function(areaDom){\r\n            var bg=areaDom.children(\".bg\");\r\n            return {\r\n                top: this._toNum(areaDom[0].style.top),\r\n                left: this._toNum(areaDom[0].style.left),\r\n                width: areaDom.outerWidth(),\r\n                height: areaDom.outerHeight(),\r\n                borderColor: bg.css('border-top-color'),//区域边框颜色\r\n                bgColor: bg.css('background-color'),//区域块背景色\r\n                opacity: parseFloat(bg.css(\"opacity\")),//区域块透明度\r\n                icon: this._analyseIcon(areaDom.children('i')),\r\n                label: this._analyseLabel(areaDom.children(\"label\"))\r\n            };\r\n        },\r\n        _analyseNode : function(nodeDom){\r\n            var property={\r\n                top: this._toNum(nodeDom[0].style.top),//\r\n                left: this._toNum(nodeDom[0].style.left),//\r\n                width: nodeDom.outerWidth(),//\r\n                height: nodeDom.outerHeight(),//\r\n                borderColor: nodeDom.css('border-top-color'),//节点边框颜色\r\n                borderWidth: this._toNum(nodeDom.css('border-top-width')),//节点边框宽度\r\n                bgColor: nodeDom.css('background-color'),//节点背景色\r\n                borderRadius: this._toNum(nodeDom.css(\"border-top-left-radius\")),//节点圆角半径\r\n                boxShadow: nodeDom.css(\"box-shadow\"),//节点阴影\r\n                icon: this._analyseIcon(nodeDom.find('i'))\r\n            };\r\n            if(nodeDom.hasClass(\"item_round\")){\r\n                property.label = this._analyseLabel(nodeDom.children(\".span\"));\r\n            }else{\r\n                property.label = this._analyseLabel(nodeDom.children(\"table\").find(\"td:eq(1)\"));\r\n            }\r\n            return property;\r\n        },\r\n        _fillIcon:function(canvas, bgLeft,bgTop,icon, bgImage){\r\n            var ctx = canvas.getContext('2d');\r\n            if(icon.backgroundImage===undefined){//矢量字体图标\r\n                if(icon.content.indexOf('\"')===0){\r\n                    icon.content = icon.content.split('\"')[1];\r\n                }\r\n                icon.color = icon.color.replace('rgb', 'rgba').replace(')', ', ' + icon.opacity + ')');\r\n                ctx.fillStyle = icon.color;\r\n                ctx.font = icon.font;\r\n                ctx.textAlign='center';\r\n                ctx.textBaseline='middle';\r\n                //  绘制内容\r\n                ctx.fillText(icon.content, bgLeft+icon.offsetLeft+4+icon.width/2, bgTop+icon.offsetTop+4+icon.height/2);\r\n                return null;\r\n            }else{//css spite背景定位图标\r\n\t\t\t\tvar tmpX=0,tmpY=0;\r\n\t\t\t\tif(icon.pX<0){\r\n\t\t\t\t\ttmpX-=icon.pX;\ticon.pX=0;\r\n\t\t\t\t}\r\n\t\t\t\tif(icon.pY<0){\r\n\t\t\t\t\ttmpY-=icon.pY;\ticon.pY=0;\r\n\t\t\t\t}\r\n\t\t\t\t//console.log(icon.pX+','+icon.pY);\r\n\t\t\t\tctx.drawImage(bgImage, icon.pX, icon.pY, icon.width, icon.height,\r\n\t\t\t\t\tbgLeft+icon.offsetLeft+4+tmpX, bgTop+icon.offsetTop+4+tmpY, icon.width, icon.height );\r\n            }\r\n        },\r\n        _fillLabel: function(canvas, bgLeft, bgTop, label) {\r\n            var ctx = canvas.getContext('2d');\r\n            ctx.fillStyle = label.color;\r\n            ctx.textAlign='center';\r\n            ctx.font = label.font;\r\n            ctx.textBaseline='top';\r\n\r\n            var str=label.text;\r\n            var lineWidth = 0;//某一行字的实际宽度\r\n            var lastSubStrIndex= 0; //每次开始截取的字符串的索引\r\n            var hack = (window.ActiveXObject || \"ActiveXObject\" in window)? 1:0;\r\n            var x = bgLeft+label.offsetLeft+label.width/2+hack/2;//文字（可能有多行）的x坐标\r\n            var y = bgTop+label.offsetTop+hack;//某一行文字（可能有多行）的y坐标\r\n\t\t\tif(navigator.userAgent.indexOf('Firefox')>=0){\r\n\t\t\t\ty += (label.lineHeight-label.fontSize);\r\n\t\t\t}\r\n            for(var i=0;i<str.length;i++){\r\n                lineWidth += ctx.measureText(str[i]).width;\r\n                if(i!==str.length-1){\r\n                    if( lineWidth  >= label.width ){\r\n                        ctx.fillText(str.substring(lastSubStrIndex,i),x,y);//绘制截取部分\r\n                        y+=label.lineHeight;\r\n                        lineWidth=0;\r\n                        lastSubStrIndex=i;\r\n                    }\r\n                }else{//绘制剩余部分\r\n                    ctx.fillText(str.substring(lastSubStrIndex,i+1),x,y);\r\n                }\r\n            }\r\n        },\r\n        //根据区域组信息在背景上画一堆区域组泳道（传参areas为要绘制的区域组详细json信息）\r\n        renderAreas:function(canvas,areas, iconBgImage){\r\n            var ctx = canvas.getContext('2d');\r\n            for(var key in areas) {\r\n                var area = areas[key];\r\n                //填充半透明矩形\r\n                area.bgColor = area.bgColor.replace('rgb', 'rgba').replace(')', ', ' + area.opacity + ')');\r\n                area.borderColor = area.borderColor.replace('rgb', 'rgba').replace(')', ', ' + area.opacity + ')');\r\n                ctx.fillStyle = area.bgColor;\r\n                ctx.strokeStyle = area.borderColor;\r\n                ctx.rect(area.left, area.top, area.width, area.height);\r\n                ctx.fill();\r\n                ctx.stroke();\r\n                this._fillIcon(canvas, area.left-3, area.top-3, area.icon, iconBgImage);\r\n                this._fillLabel(canvas, area.left, area.top, area.label);\r\n            }\r\n        },\r\n\r\n        //根据节点信息在背景上画一组节点（传参nodes为要绘制的节点详细json信息）\r\n        renderNodes:function(canvas,nodes,iconBgImage){\r\n            var ctx = canvas.getContext('2d');\r\n            var imgLoadFuncs=[];\r\n            for(var key in nodes){\r\n                var node = nodes[key];\r\n                //渲染阴影\r\n                var sd = node.boxShadow.split(\") \");\r\n                if(sd.length===1){\r\n                    var tmp = node.boxShadow.split(\"rgba\");\r\n                    sd[0]='rgba'+tmp[1];\r\n                    sd[1]=tmp[0];\r\n                }\r\n                ctx.shadowColor = sd[0];\r\n                sd=sd[1].split(\" \");\r\n                ctx.shadowOffsetX=this._toNum(sd[0])+(node.borderWidth>1? 1:0);\r\n                ctx.shadowOffsetY=this._toNum(sd[1])+(node.borderWidth>1? 1:0);\r\n                ctx.shadowBlur=this._toNum(sd[2]);\r\n                //填充圆角矩形\r\n                ctx.fillStyle=node.bgColor;\r\n                ctx.roundRect( node.left+node.borderWidth/2, node.top+node.borderWidth/2,\r\n                    node.width-node.borderWidth, node.height-node.borderWidth, node.borderRadius).fill();\r\n                //加边框\r\n                ctx.shadowBlur=0;\r\n                ctx.shadowColor='';\r\n                ctx.shadowOffsetX=0;\r\n                ctx.shadowOffsetY=0;\r\n                ctx.strokeStyle = node.borderColor;\r\n                ctx.lineWidth = (node.borderWidth===0? 0.01:node.borderWidth);\r\n                ctx.stroke();\r\n                this._fillIcon(canvas, node.left, node.top+(node.borderRadius>6? 1:0), node.icon, iconBgImage);\r\n                this._fillLabel(canvas, node.left, node.top, node.label);\r\n            }\r\n            return imgLoadFuncs;\r\n        },\r\n\r\n        _analyseLine:function(lineDom){ //only for IE\r\n            var fontFamily = $(\".GooFlow\").css(\"font-family\");\r\n            //基本样式\r\n            var path = lineDom.childNodes[1];\r\n            var property={\r\n                color: path.getAttribute(\"stroke\"),//箭头则用fill\r\n                lineWidth: path.getAttribute(\"stroke-width\"),//线条宽度箭头的strokeWidth为0\r\n                lineCap: 'round'\r\n            };\r\n            var style = path.style.strokeDasharray;\r\n            property.lineDash=(style && style!=null);\r\n            //文字\r\n            var text=lineDom.childNodes[2];\r\n            var fontColor = text.getAttribute(\"fill\");\r\n            if(!fontColor||fontColor===null||fontColor===''){\r\n                fontColor='#777';\r\n            }\r\n            property.label={\r\n                text: text.textContent,\r\n                font: text.style.fontSize+' '+fontFamily,\r\n                color: fontColor,\r\n                left:text.getAttribute(\"x\"),\r\n                top:text.getAttribute(\"y\")\r\n            };\r\n\r\n            //获取连线从首至尾各个点的坐标值\r\n            var d = path.getAttribute(\"d\");\r\n            var tmp = d.substring(2,d.length).split(\"L\");\r\n            var points=[];//连线中各点集合\r\n            for(var i=0;i<tmp.length;++i){\r\n                tmp[i] = tmp[i].replace(/^\\s+|\\s+$/gm,'');//去掉首尾空格\r\n                var xy=tmp[i].split(\" \");\r\n                points.push({ x: parseFloat(xy[0]), y:parseFloat(xy[1]) });\r\n            }\r\n            property.points=points;\r\n\r\n            //箭头默认参数：两边到线垂直距离为3，从线至箭头顶端为6,如果为mark ，则:具体值*(2.4/1.4)=x*1.71\r\n            //画箭头攻略：1、先在原点附近画好一个正的；2、旋转到与连线最后一段的斜率；3、移动到连线最后一点；4、渲染出来\r\n\r\n            //计算连线最后一段与X轴的角度\r\n            var len=points.length;\r\n            var x = points[len-1].x-points[len-2].x, y = points[len-1].y-points[len-2].y;\r\n            property.angle=Math.atan2(y,x);\r\n\r\n            return property;\r\n        },\r\n        renderLines:function(canvas, lines){\r\n            var ctx = canvas.getContext('2d');\r\n            for(var key in lines){\r\n                var line = lines[key];\r\n                ctx.save();\r\n                ctx.setLineDash(line.lineDash?[4,6]:[]);\r\n                ctx.strokeStyle = line.color;\r\n                ctx.lineWidth = line.lineWidth;\r\n                ctx.lineCap = line.lineCap;\r\n                var p = line.points;\r\n                ctx.beginPath();\r\n                ctx.moveTo(p[0].x,p[0].y);\r\n                for(var i=1;i<p.length;++i){\r\n                    ctx.lineTo(p[i].x,p[i].y);\r\n                    if(i!==p.length-1){\r\n                        ctx.moveTo(p[i].x,p[i].y);\r\n                    }\r\n                }\r\n                ctx.closePath();\r\n                ctx.stroke();\r\n                ctx.save();\r\n\r\n                //箭头的渲染\r\n                //画箭头攻略：1、先在原点附近画好一个正的；2、旋转到与连线最后一段的斜率；3、移动到连线最后一点；4、渲染出来\r\n                ctx.translate( p[p.length-1].x, p[p.length-1].y );\r\n                ctx.rotate(line.angle);\r\n                ctx.fillStyle = line.color;\r\n                ctx.beginPath();\r\n                ctx.moveTo(1*line.lineWidth,0);\r\n                ctx.lineTo(-6*line.lineWidth,-3*line.lineWidth);\r\n                ctx.lineTo(-6*line.lineWidth,3*line.lineWidth);\r\n                ctx.lineTo(1*line.lineWidth,0);\r\n                ctx.closePath();\r\n                ctx.fill();\r\n                ctx.restore();\r\n\r\n                //文字渲染\r\n                var ctx2 = canvas.getContext('2d');\r\n                var label = line.label;\r\n                ctx2.fillStyle = label.color;\r\n                ctx2.textAlign='center';\r\n                ctx2.font = label.font;\r\n                ctx2.fillText(label.text,label.left,label.top);\r\n            }\r\n\r\n        }\r\n    };\r\n\t//扩展canvas画圆角矩形的方法\r\n\tCanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {\r\n\t\tif (w < 2 * r) {r = w / 2;}\r\n\t\tif (h < 2 * r){ r = h / 2;}\r\n\t\tthis.beginPath();\r\n\t\tthis.moveTo(x+r, y);\r\n\t\tthis.arcTo(x+w, y, x+w, y+h, r);\r\n\t\tthis.arcTo(x+w, y+h, x, y+h, r);\r\n\t\tthis.arcTo(x, y+h, x, y, r);\r\n\t\tthis.arcTo(x, y, x+w, y, r);\r\n\t\tthis.closePath();\r\n\t\treturn this;\r\n\t};\r\n\r\n\t//扩展定义导出流程图文件功能的方法\r\n\tGooFlow.prototype.exportDiagram=function(fileName) {\r\n\t\tvar areaEl={};\r\n\t\tvar iconImage = undefined;\r\n\t\tvar bgUrl = null;\r\n\t\tfor(var k1 in this.$areaDom){\r\n\t\t\tareaEl[k1]=Cmder._analyseArea(this.$areaDom[k1]);\r\n\t\t\tif(areaEl[k1].icon.backgroundImage && bgUrl===null){\r\n                bgUrl=areaEl[k1].icon.backgroundImage;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(areaEl);\r\n\t\tvar nodeEl={};\r\n\t\tfor(var k2 in this.$nodeDom){\r\n\t\t\tnodeEl[k2]=Cmder._analyseNode(this.$nodeDom[k2]);\r\n            if(nodeEl[k2].icon.backgroundImage && bgUrl===null){\r\n                bgUrl=nodeEl[k2].icon.backgroundImage;\r\n            }\r\n\t\t}\r\n\t\t//console.log(nodeEl);\r\n\r\n        var max = this._suitSize();\r\n        var width = (max.width+100)*this.$scale;\r\n        var height = (max.height+100)*this.$scale;\r\n        var canvas = Cmder.initBg(width,height,'#ffffff');//canvas背景元素\r\n        var Goo=this;\r\n\r\n        if(bgUrl!==null){\r\n            iconImage = new Image();\r\n            iconImage.setAttribute('crossOrigin', 'anonymous');\r\n            iconImage.src = bgUrl;\r\n        }\r\n\r\n\t\tvar tempFunc=function(){\r\n            Cmder.renderAreas(canvas,areaEl,iconImage);\r\n            Cmder.renderNodes(canvas,nodeEl,iconImage);\r\n\r\n            //处理连线\r\n            var ctx = canvas.getContext('2d');//取得画布的2d绘图上下文\r\n            ctx.restore();\r\n            if(window.ActiveXObject || \"ActiveXObject\" in window || navigator.userAgent.indexOf(\"Edge\")>-1){//当为IE11及以下版本浏览器时，使用Canvg第三方工具\r\n                var lineEl={};\r\n                for(var key in Goo.$lineDom){\r\n                    lineEl[key]=Cmder._analyseLine(Goo.$lineDom[key]);\r\n                }\r\n                //console.log(lineEl);\r\n                Cmder.renderLines(canvas,lineEl);\r\n                try{\r\n                    var blob = canvas.msToBlob();\r\n                    navigator.msSaveBlob(blob, fileName+\".png\");\r\n                }\r\n                catch(e){\r\n                    //生成一个下载链接并点击\r\n                    var base64 = canvas.toDataURL('image/png');  //将画布内的信息导出为png图片数据\r\n                    $('body').append('<img src=\"'+base64+'\" id=\"aaaa\" name=\"fileName\">');\r\n                    var oPop=window.open(\"\",'_blank');\r\n                    for (; oPop.document.readyState !== \"complete\";) {\r\n                        if (oPop.document.readyState === \"complete\") break;\r\n                    }\r\n                    oPop.document.write('<html><head><title>'+fileName+'.png</title></head><body><img src=\"'+base64+'\" border=\"1\" title=\"'+fileName+'.png\"></body></html>');\r\n                }\r\n            }else{\r\n                var strSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"'+width+'\" height=\"'+height+'\">'\r\n                    +'<defs><style type=\"text/css\">text{font-size:14px;line-height:1.42857143;'\r\n                    +'font-family:\"Microsoft Yahei\", \"Helvetica Neue\", Helvetica, Hiragino Sans GB, WenQuanYi Micro Hei, Arial, sans-serif;'\r\n                    +'}</style></defs>' + $(\"#draw_\"+Goo.$id).html() +'</svg>'; //COPY连线内容\r\n                var image = new Image();\r\n                image.src='data:image/svg+xml,'+ encodeURIComponent(strSvg);\r\n                image.onload=function(){\r\n                    ctx.drawImage(image, 0, 0);\r\n                    var a = document.createElementNS(\"http://www.w3.org/1999/xhtml\", \"a\");\r\n                    a.href = canvas.toDataURL('image/png');  //将画布内的信息导出为png图片数据\r\n                    a.download = fileName+\".png\";  //设定下载名称\r\n                    document.body.appendChild(a);\r\n                    a.click(); //点击触发下载\r\n                    document.body.removeChild(a);\r\n                };\r\n            }\r\n\t\t};\r\n\t\t// 如果图片已经存在于浏览器缓存，直接调用回调函数\r\n        if(!iconImage || iconImage.complete|| (!!window.ActiveXObject||\"ActiveXObject\" in window) ) {\r\n            tempFunc();\r\n            return;// 直接返回，不用再处理onload事件\r\n        }\r\n        iconImage.onload=function(){\r\n            tempFunc();\r\n        };\r\n\r\n\t}\r\n}));"]}