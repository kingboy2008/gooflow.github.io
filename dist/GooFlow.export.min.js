/**
 * GooFlow - Web端流程设计器
 * @author foolegg126 (sdlddr)
 * @version v1.3.2
 * @license MIT
 **/
!function(t,e){"use strict";"undefined"!=typeof define&&define.amd?define(["jquery","GooFlow"],e):"undefined"!=typeof module&&module.exports?e(require("jquery"),require("GooFlow")):e(t.$,t.GooFlow)}("undefined"!=typeof window?window:this,function(b,t){if(!t.prototype.exportDiagram||"function"!=typeof t.prototype.exportDiagram){var m={initBg:function(t,e,o){var i=document.createElement("canvas");i.width=t,i.height=e;var r=i.getContext("2d");return o&&(r.fillStyle=o),r.fillRect(0,0,i.width,i.height),r.save(),i},_toNum:function(t){return null!==t&&""!==t?parseInt(t.split("px")[0],10):void 0},_analyseLabel:function(t){var e=t[0].tagName,o=t[0].offsetLeft,i=t[0].offsetTop;"TD"===e&&(o+=t.children("div")[0].offsetLeft,i+=t.children("div")[0].offsetTop);var r=this._toNum(t.css("line-height")),n=t.css("font-size");return{font:n+" "+t.css("font-family"),fontSize:this._toNum(n.split("px")[0]),text:t.text(),color:t.css("color"),width:t[0].offsetWidth,height:t[0].offsetHeight,lineHeight:r,offsetLeft:o,offsetTop:i,lineNum:Math.ceil(t[0].offsetHeight/r)}},_analyseIcon:function(t){var e=t.css("background-image"),o={offsetLeft:t[0].offsetLeft,offsetTop:t[0].offsetTop,width:t.width(),height:t.height()};return e&&"none"!==e?(e=e.replace(/"/g,"").split("url(")[1],o.backgroundImage=e.substr(0,e.length-1),e=t.css("background-position").split(" "),o.pX=-1*parseFloat(e[0].split("px")[0]),o.pY=-1*parseFloat(e[1].split("px")[0])):b.extend(o,{font:t.css("font-size")+" "+t.css("font-family").split(" ")[0],lineHeight:this._toNum(t.css("line-height")),color:t.css("color"),opacity:parseFloat(t.css("opacity")),content:window.getComputedStyle(t[0],"::before").getPropertyValue("content")}),o},_analyseArea:function(t){var e=t.children(".bg");return{top:this._toNum(t[0].style.top),left:this._toNum(t[0].style.left),width:t.outerWidth(),height:t.outerHeight(),borderColor:e.css("border-top-color"),bgColor:e.css("background-color"),opacity:parseFloat(e.css("opacity")),icon:this._analyseIcon(t.children("i")),label:this._analyseLabel(t.children("label"))}},_analyseNode:function(t){var e={top:this._toNum(t[0].style.top),left:this._toNum(t[0].style.left),width:t.outerWidth(),height:t.outerHeight(),borderColor:t.css("border-top-color"),borderWidth:this._toNum(t.css("border-top-width")),bgColor:t.css("background-color"),borderRadius:this._toNum(t.css("border-top-left-radius")),boxShadow:t.css("box-shadow"),icon:this._analyseIcon(t.find("i"))};return t.hasClass("item_round")?e.label=this._analyseLabel(t.children(".span")):e.label=this._analyseLabel(t.children("table").find("td:eq(1)")),e},_fillIcon:function(t,e,o,i,r){var n=t.getContext("2d");if(void 0===i.backgroundImage)return 0===i.content.indexOf('"')&&(i.content=i.content.split('"')[1]),i.color=i.color.replace("rgb","rgba").replace(")",", "+i.opacity+")"),n.fillStyle=i.color,n.font=i.font,n.textAlign="center",n.textBaseline="middle",n.fillText(i.content,e+i.offsetLeft+4+i.width/2,o+i.offsetTop+4+i.height/2),null;var l=0,a=0;i.pX<0&&(l-=i.pX,i.pX=0),i.pY<0&&(a-=i.pY,i.pY=0),n.drawImage(r,i.pX,i.pY,i.width,i.height,e+i.offsetLeft+4+l,o+i.offsetTop+4+a,i.width,i.height)},_fillLabel:function(t,e,o,i){var r=t.getContext("2d");r.fillStyle=i.color,r.textAlign="center",r.font=i.font,r.textBaseline="top";var n=i.text,l=0,a=0,s=window.ActiveXObject||"ActiveXObject"in window?1:0,d=e+i.offsetLeft+i.width/2+s/2,h=o+i.offsetTop+s;0<=navigator.userAgent.indexOf("Firefox")&&(h+=i.lineHeight-i.fontSize);for(var f=0;f<n.length;f++)l+=r.measureText(n[f]).width,f!==n.length-1?l>=i.width&&(r.fillText(n.substring(a,f),d,h),h+=i.lineHeight,l=0,a=f):r.fillText(n.substring(a,f+1),d,h)},renderAreas:function(t,e,o){var i=t.getContext("2d");for(var r in e){var n=e[r];n.bgColor=n.bgColor.replace("rgb","rgba").replace(")",", "+n.opacity+")"),n.borderColor=n.borderColor.replace("rgb","rgba").replace(")",", "+n.opacity+")"),i.fillStyle=n.bgColor,i.strokeStyle=n.borderColor,i.rect(n.left,n.top,n.width,n.height),i.fill(),i.stroke(),this._fillIcon(t,n.left-3,n.top-3,n.icon,o),this._fillLabel(t,n.left,n.top,n.label)}},renderNodes:function(t,e,o){var i=t.getContext("2d");for(var r in e){var n=e[r],l=n.boxShadow.split(") ");if(1===l.length){var a=n.boxShadow.split("rgba");l[0]="rgba"+a[1],l[1]=a[0]}i.shadowColor=l[0],l=l[1].split(" "),i.shadowOffsetX=this._toNum(l[0])+(1<n.borderWidth?1:0),i.shadowOffsetY=this._toNum(l[1])+(1<n.borderWidth?1:0),i.shadowBlur=this._toNum(l[2]),i.fillStyle=n.bgColor,i.roundRect(n.left+n.borderWidth/2,n.top+n.borderWidth/2,n.width-n.borderWidth,n.height-n.borderWidth,n.borderRadius).fill(),i.shadowBlur=0,i.shadowColor="",i.shadowOffsetX=0,i.shadowOffsetY=0,i.strokeStyle=n.borderColor,i.lineWidth=0===n.borderWidth?.01:n.borderWidth,i.stroke(),this._fillIcon(t,n.left,n.top+(6<n.borderRadius?1:0),n.icon,o),this._fillLabel(t,n.left,n.top,n.label)}return[]},_analyseLine:function(t){var e=b(".GooFlow").css("font-family"),o=t.childNodes[1],i={color:o.getAttribute("stroke"),lineWidth:o.getAttribute("stroke-width"),lineCap:"round"},r=o.style.strokeDasharray;i.lineDash=r&&null!=r;var n=t.childNodes[2],l=n.getAttribute("fill");l&&null!==l&&""!==l||(l="#777"),i.label={text:n.textContent,font:n.style.fontSize+" "+e,color:l,left:n.getAttribute("x"),top:n.getAttribute("y")};for(var a=o.getAttribute("d"),s=a.substring(2,a.length).split("L"),d=[],h=0;h<s.length;++h){s[h]=s[h].replace(/^\s+|\s+$/gm,"");var f=s[h].split(" ");d.push({x:parseFloat(f[0]),y:parseFloat(f[1])})}var c=(i.points=d).length,g=d[c-1].x-d[c-2].x,p=d[c-1].y-d[c-2].y;return i.angle=Math.atan2(p,g),i},renderLines:function(t,e){var o=t.getContext("2d");for(var i in e){var r=e[i];o.save(),o.setLineDash(r.lineDash?[4,6]:[]),o.strokeStyle=r.color,o.lineWidth=r.lineWidth,o.lineCap=r.lineCap;var n=r.points;o.beginPath(),o.moveTo(n[0].x,n[0].y);for(var l=1;l<n.length;++l)o.lineTo(n[l].x,n[l].y),l!==n.length-1&&o.moveTo(n[l].x,n[l].y);o.closePath(),o.stroke(),o.save(),o.translate(n[n.length-1].x,n[n.length-1].y),o.rotate(r.angle),o.fillStyle=r.color,o.beginPath(),o.moveTo(1*r.lineWidth,0),o.lineTo(-6*r.lineWidth,-3*r.lineWidth),o.lineTo(-6*r.lineWidth,3*r.lineWidth),o.lineTo(1*r.lineWidth,0),o.closePath(),o.fill(),o.restore();var a=t.getContext("2d"),s=r.label;a.fillStyle=s.color,a.textAlign="center",a.font=s.font,a.fillText(s.text,s.left,s.top)}}};CanvasRenderingContext2D.prototype.roundRect=function(t,e,o,i,r){return o<2*r&&(r=o/2),i<2*r&&(r=i/2),this.beginPath(),this.moveTo(t+r,e),this.arcTo(t+o,e,t+o,e+i,r),this.arcTo(t+o,e+i,t,e+i,r),this.arcTo(t,e+i,t,e,r),this.arcTo(t,e,t+o,e,r),this.closePath(),this},t.prototype.exportDiagram=function(s){var d={},h=void 0,t=null;for(var e in this.$areaDom)d[e]=m._analyseArea(this.$areaDom[e]),d[e].icon.backgroundImage&&null===t&&(t=d[e].icon.backgroundImage);var f={};for(var o in this.$nodeDom)f[o]=m._analyseNode(this.$nodeDom[o]),f[o].icon.backgroundImage&&null===t&&(t=f[o].icon.backgroundImage);var i=this._suitSize(),c=(i.width+100)*this.$scale,g=(i.height+100)*this.$scale,p=m.initBg(c,g,"#ffffff"),u=this;null!==t&&((h=new Image).setAttribute("crossOrigin","anonymous"),h.src=t);var r=function(){m.renderAreas(p,d,h),m.renderNodes(p,f,h);var e=p.getContext("2d");if(e.restore(),window.ActiveXObject||"ActiveXObject"in window||-1<navigator.userAgent.indexOf("Edge")){var t={};for(var o in u.$lineDom)t[o]=m._analyseLine(u.$lineDom[o]);m.renderLines(p,t);try{var i=p.msToBlob();navigator.msSaveBlob(i,s+".png")}catch(t){var r=p.toDataURL("image/png");b("body").append('<img src="'+r+'" id="aaaa" name="fileName">');for(var n=window.open("","_blank");"complete"!==n.document.readyState&&"complete"!==n.document.readyState;);n.document.write("<html><head><title>"+s+'.png</title></head><body><img src="'+r+'" border="1" title="'+s+'.png"></body></html>')}}else{var l='<svg xmlns="http://www.w3.org/2000/svg" width="'+c+'" height="'+g+'"><defs><style type="text/css">text{font-size:14px;line-height:1.42857143;font-family:"Microsoft Yahei", "Helvetica Neue", Helvetica, Hiragino Sans GB, WenQuanYi Micro Hei, Arial, sans-serif;}</style></defs>'+b("#draw_"+u.$id).html()+"</svg>",a=new Image;a.src="data:image/svg+xml,"+encodeURIComponent(l),a.onload=function(){e.drawImage(a,0,0);var t=document.createElementNS("http://www.w3.org/1999/xhtml","a");t.href=p.toDataURL("image/png"),t.download=s+".png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}};!h||h.complete||window.ActiveXObject||"ActiveXObject"in window?r():h.onload=function(){r()}}}});
//# sourceMappingURL=maps/GooFlow.export.min.js.map
